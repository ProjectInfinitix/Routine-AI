try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="2b89cb64-a9e8-4922-b8ed-d26857d776e0",e._sentryDebugIdIdentifier="sentry-dbid-2b89cb64-a9e8-4922-b8ed-d26857d776e0")}catch(e){}(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4982],{8808:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var a=s(31218),n=s(42427),i=s(60129),l=s.n(i),r=s(20444);function o(e){let{app:t,className:s,children:i,...o}=e,{props:d}=(0,n.getImageProps)({src:t.iconUrl?t.iconUrl:"/assets/ph".concat(l()(t.id)%4,".webp"),width:128,height:128,alt:"App icon"});return(0,a.jsxs)("div",{...o,className:(0,r.cn)("relative",s),children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-10 opacity-50",style:{backgroundSize:"cover",backgroundImage:"url(/assets/icon-mask-border.svg)"}}),(0,a.jsx)("div",{className:"absolute top-0 left-0 w-full h-full z-0",style:{backgroundImage:"url(".concat(d.src,")"),backgroundSize:"cover",backgroundPosition:"center",maskImage:"url(/assets/icon-mask.svg)",maskSize:"cover"}}),i]})}},64210:(e,t,s)=>{Promise.resolve().then(s.bind(s,96038))},96038:(e,t,s)=>{"use strict";s.d(t,{AC1OS:()=>an});var a=s(31218),n=s(35712),i=s(48005),l=s.n(i),r=s(57275),o=s(32286),d=s(93877),c=s(82997),u=s(752),m=s(88218),p=s(59133),h=s(6300);let x=()=>{let e=(0,m.useRef)(null),[t,s]=(0,m.useState)(0),[n,i]=(0,m.useState)(!0);return(0,m.useEffect)(()=>{let t=e.current;if(!t)return;let a=t.getContext("2d");if(!a)return;t.width=700,t.height=348;let n=e=>{a.clearRect(0,0,700,348),a.fillStyle="#ffffff";let t=document.createElement("canvas");t.width=700,t.height=348;let s=t.getContext("2d");if(s&&a){s.fillStyle="#ffffff",["M530.512 39.5V21L642.012 0.5V283.5C642.012 321 658.012 324.5 699.012 324.5V344H539.512V324.5H550.512C586.012 324.5 595.012 307.5 595.012 283.5V63C595.012 47.5 582.512 39.5 559.012 39.5H530.512Z","M272.031 224.5C272.031 147.5 324.531 90 393.531 90C436.531 90 469.531 112.5 469.531 141.5C469.531 158 459.031 168 442.031 168C428.031 168 422.031 161.5 422.031 146.5V136.5C422.031 118.5 415.031 112.5 396.531 112.5C349.031 112.5 322.031 151 322.031 215.5C322.031 280.5 349.531 324 390.031 324C413.031 324 436.531 309 458.031 279.5L474.031 293C454.531 327 420.531 348 379.031 348C316.531 348 272.031 295.5 272.031 224.5Z","M0.535156 256C0.535156 166 69.0352 90 136.535 90C159.035 90 177.035 98.5 185.535 112H186.535L191.035 94H236.535L197.535 281C196.535 285 194.035 299 194.035 308.5C194.035 316.5 196.035 322.5 204.035 322.5C211.035 322.5 219.535 318.5 226.035 312L234.035 323C222.035 336.5 199.035 348 178.035 348C160.535 348 149.035 337.5 149.035 323.5C149.035 314 154.535 278 156.535 271C141.535 314.5 110.035 348 72.5352 348C32.0352 348 0.535156 315.5 0.535156 256ZM47.5352 256C47.5352 297 67.5352 321 85.0352 321C123.035 321 174.035 231 174.035 168C174.035 128 161.035 114.5 137.035 114.5C93.0352 114.5 47.5352 178 47.5352 256Z"].forEach(e=>{let t=new Path2D(e);s.fill(t)});for(let t=0;t<348;t+=e)for(let n=0;n<700;n+=e)s.getImageData(n,t,1,1).data[3]>0&&a.fillRect(n,t,e,e)}},l=()=>{let e=[32,16,8,4,2,1],t=0,a=()=>{t<e.length?(n(e[t]),s(t),t++,setTimeout(a,400)):setTimeout(l,1e3)};a()};l();let r=setInterval(()=>{i(e=>!e)},530);return()=>clearInterval(r)},[]),(0,a.jsxs)("div",{className:"relative w-[300px] h-[130px] flex items-center justify-center",children:[(0,a.jsx)("canvas",{className:"w-full h-full",ref:e,style:{imageRendering:"pixelated",transform:"scale(0.3)",transformOrigin:"center"}}),(0,a.jsx)("div",{className:"absolute w-5 h-[50px] bg-white transition-opacity duration-100 ".concat(n?"opacity-100":"opacity-0"),style:{right:"75px",top:"50%",transform:"translateY(-50%)"}})]})};var v=s(79977),g=s(334),f=s(70819),j=s(18662),b=s(7548),w=s(22223),y=s(943),N=s(39666),k=s(34431),A=s(88289),C=s(62571),S=s(63422),E=s(67457),I=s(43496),L=s(63850),M=s(73123),R=s(11231),F=s(50192),z=s(53337),P=s(45417),D=s(23293),T=s(68328),U=s(87826),V=s(10094),O=s(28235),H=s(99265),_=s(54452),$=function(e){return e.Home="HOME",e.App="APP",e}({});let B={HOME:{allowScreenshot:!1,allowDrag:!1,allowMinimize:!1,allowHideGoonbar:!1,showVersionControl:!1,showAutoRepair:!1,keyboardShortcuts:!1,contentPanel:{initiallyVisible:!1,showToggle:!1},allowShare:!1},APP:{allowScreenshot:!0,allowDrag:!0,allowMinimize:!0,allowHideGoonbar:!0,showVersionControl:!0,showAutoRepair:!0,keyboardShortcuts:!0,contentPanel:{initiallyVisible:!1,showToggle:!0},allowShare:!0}};function W(e){return e?"peek":"tools"}let J=(0,_.vt)()(e=>({isMinimized:!1,isGoonbarHidden:!1,isContentPanelVisible:!1,showOpenGoonbarButton:!1,draftMessage:"",appEditor:{isOpen:!1,versionId:void 0,tab:"db"},lastActiveTab:"App.tsx",isGeneratingScreenshot:!1,fileUploads:[],isUploading:!1,openEditor:!1,attachScreenshot:!0,quote:null,isAutoVersionSwitchingLocked:!1,searchResults:null,setIsMinimized:function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e(e=>{let a="function"==typeof t?t(e.isMinimized):t,{preserveContentPanelState:n=!1}=s;return{isMinimized:a,...!a&&!n&&{isContentPanelVisible:!0}}})},setIsGoonbarHidden:(t,s)=>e(e=>{let a="function"==typeof t?t(e.isGoonbarHidden):t,{preserveContentPanelState:n=!1,keepMinimized:i=!1}=null!=s?s:{};return a&&!e.isGoonbarHidden?{isGoonbarHidden:!0,showOpenGoonbarButton:!0,draftMessage:e.draftMessage}:!a&&e.isGoonbarHidden?{isGoonbarHidden:!1,showOpenGoonbarButton:!1,isMinimized:!!i&&e.isMinimized,...n?{}:{isContentPanelVisible:!0},draftMessage:e.draftMessage}:{isGoonbarHidden:a}}),setShowOpenGoonbarButton:t=>e({showOpenGoonbarButton:t}),setIsContentPanelVisible:t=>e({isContentPanelVisible:t}),setContentPanelVisibilityFromViewType:t=>{let s=B[t],a=window.matchMedia("(max-width: 640px)").matches;t===$.App?e({isMinimized:a,isGoonbarHidden:!a,showOpenGoonbarButton:!a,isContentPanelVisible:s.contentPanel.initiallyVisible}):e({isMinimized:!1,isGoonbarHidden:!1,showOpenGoonbarButton:!1,isContentPanelVisible:s.contentPanel.initiallyVisible})},closeAppEditor:()=>e({appEditor:{isOpen:!1}}),openAppEditor:t=>e(e=>({appEditor:{...e.appEditor,isOpen:!0,...t}})),setLastActiveTab:t=>e({lastActiveTab:t}),setIsGeneratingScreenshot:t=>e({isGeneratingScreenshot:t}),setFileUploads:t=>e(e=>({fileUploads:"function"==typeof t?t(e.fileUploads):t})),setIsUploading:t=>e({isUploading:t}),setOpenEditor:t=>e({openEditor:t}),setAttachScreenshot:t=>e({attachScreenshot:t}),setQuote:t=>e({quote:t}),setAutoVersionSwitchingLock:t=>e({isAutoVersionSwitchingLocked:t}),setDraftMessage:t=>e({draftMessage:t}),showGoonbar:function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e(e=>{let s={isGoonbarHidden:!1,showOpenGoonbarButton:!1,isMinimized:!1};return t&&(s.isContentPanelVisible=!0),s})},setSearchResults:t=>e({searchResults:t})})),Q={newMessage:"Finished working",snag:"Action required",autofix:"Run into an issue"},G={newMessage:{background:"bg-[hsl(var(--success))]",backgroundPing:"bg-[hsl(var(--success))]"},snag:{background:"bg-[hsl(var(--error))]",backgroundPing:"bg-[hsl(var(--error))]"},autofix:{background:"bg-[hsl(var(--error))]",backgroundPing:"bg-[hsl(var(--error))]"}};var q=s(87998),Y=s(64388),K=s(20444);let Z={...Y.RJ,db:"Database",infra:"App Setup"};function X(e){var t,s,n,i,l,r,o,d,c,p,h,x;let{versionId:v,tab:g,className:f,onClose:j,editingItem:b,...w}=e,y=(0,u.usePathname)(),A=(0,u.useRouter)(),[C,S]=(0,m.useState)(v),{toast:E}=(0,O.dj)(),I=q.F.getVersionSource.useQuery({versionId:C},{enabled:!!C});(0,m.useEffect)(()=>{v&&(S(v),I.refetch())},[v]);let L=(0,m.useRef)({}),[R,F]=(0,m.useState)(null),[_,$]=(0,m.useState)(!1),[B,W]=(0,m.useState)(!1),Q=J(e=>e.openAppEditor);(0,m.useEffect)(()=>{F("db"!=g&&"infra"!=g?Y.JL[null!=g?g:"api.ts"]:g)},[g]);let G=q.F.createNewVersion.useMutation({onSuccess:async e=>{(0,J.getState().openAppEditor)({versionId:e.id,tab:g}),A.push("".concat(y,"?_evid=").concat(e.id)),A.refresh(),await Promise.all([I.refetch(),X.refetch()])},onError:e=>{E({title:"Failed to save",description:e.message})}}),X=q.F.getAppById.useQuery({id:null===(t=I.data)||void 0===t?void 0:t.appId},{enabled:!!(null===(s=I.data)||void 0===s?void 0:s.appId)}),ee=null===(n=X.data)||void 0===n?void 0:n.latestVersionId,et=!!(ee&&ee!==C),es=(0,m.useCallback)(async()=>{if(!C)return;let e=await G.mutateAsync({versionId:C,...L.current});$(!1),A.push("".concat(y,"?_evid=").concat(e.id))},[L,y,A,G,C]),ea=(0,H.al)(),en=(0,H.ZT)(),{resolvedTheme:ei}=(0,M.D)(),el=null===(i=I.data)||void 0===i?void 0:i[R],er=(0,m.useRef)(null);if(!v)return null;let eo=Object.entries(Y.JL);return(0,a.jsxs)("div",{className:f,...w,children:[(0,a.jsxs)("div",{className:"flex flex-row w-full p-2 border-b gap-4 items-center",children:[(0,a.jsx)("div",{className:"flex-1 overflow-x-auto",children:ea||en?(0,a.jsxs)(O.rI,{children:[(0,a.jsx)(O.ty,{asChild:!0,children:(0,a.jsxs)(O.$n,{className:"flex h-7 gap-2 text-xs shadow-button",size:"sm",type:"button",variant:"outline",children:[Z[null!=R?R:"frontendSource"],(0,a.jsx)(P.A,{className:"h-3.5 w-3.5"})]})}),(0,a.jsx)(O.SQ,{children:(0,a.jsxs)(O.I,{children:[eo.map(e=>{let[t,s]=e;return(0,a.jsx)(O._2,{onClick:()=>{F(s),Q({versionId:C,tab:Y.RJ[s]})},children:t},s)}),(0,a.jsx)(O._2,{onClick:()=>{F("db"),Q({versionId:C,tab:"db"})},children:"Database"}),(0,a.jsx)(O._2,{onClick:()=>{F("infra"),Q({versionId:C,tab:"infra"})},children:"App Setup"})]})})]}):(0,a.jsx)(O.tU,{defaultValue:null!=R?R:"db"!=g&&"infra"!=g?Y.JL[null!=g?g:"api.ts"]:g,value:null!=R?R:"db"!=g&&"infra"!=g?Y.JL[null!=g?g:"api.ts"]:g,onValueChange:e=>{F(e),Q({versionId:C,tab:"db"===e||"infra"===e?e:Y.RJ[e]})},children:(0,a.jsxs)(O.j7,{className:"bg-transparent",children:[eo.map(e=>{let[t,s]=e;return(0,a.jsx)(O.Xi,{className:(0,K.cn)("text-xs font-normal transition-all","data-[state=active]:bg-background data-[state=active]:rounded-md data-[state=active]:border data-[state=active]:border-border","data-[state=inactive]:text-muted-foreground"),value:s,children:t},s)}),(0,a.jsx)(O.Xi,{className:(0,K.cn)("text-xs font-normal transition-all","data-[state=active]:bg-background data-[state=active]:rounded-md data-[state=active]:border data-[state=active]:border-border","data-[state=inactive]:text-muted-foreground"),value:"db",children:"Database"}),(0,a.jsx)(O.Xi,{className:(0,K.cn)("text-xs font-normal transition-all","data-[state=active]:bg-background data-[state=active]:rounded-md data-[state=active]:border data-[state=active]:border-border","data-[state=inactive]:text-muted-foreground"),value:"infra",children:"App Setup"})]})})}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[et?(0,a.jsx)(O.Bc,{children:(0,a.jsxs)(O.m_,{children:[(0,a.jsx)(O.k$,{asChild:!0,children:(0,a.jsxs)(O.$n,{className:"gap-2",variant:"outline",onClick:()=>S(ee),children:[(0,a.jsx)(N.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),"Latest Version"]})}),(0,a.jsx)(O.ZI,{children:(0,a.jsx)("p",{children:"Switch to the latest version to make and apply changes"})})]})}):R&&!["db","infra"].includes(R)&&(0,a.jsxs)(O.$n,{className:"gap-1",disabled:G.isLoading||!_||!Object.keys(L.current).length,size:"sm",variant:"primary",onClick:es,children:[G.isLoading?(0,a.jsx)(k.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 animate-spin"}):(0,a.jsx)(D.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 text-xs"})," ","Save"]}),(0,a.jsx)(O.$n,{size:"iconSm",variant:"outline",onClick:()=>{_?W(!0):(Q({versionId:C,tab:"db"===R||"infra"===R?R:Y.RJ[R]}),j())},children:(0,a.jsx)(T.A,{className:"h-3.5 w-3.5"})})]})]}),"db"==R&&(0,a.jsx)(U.J,{editingItem:b,versionId:null!=C?C:""},"DebugDbTab-".concat(C)),"infra"==R&&(0,a.jsx)(V.nl,{versionId:null!=C?C:""},"DebugInfraTab-".concat(C)),null!=R&&"db"!=R&&"infra"!=R&&null!=el&&(0,a.jsx)(z.Ay,{beforeMount:e=>{(()=>{let e=document.createElement("style");e.textContent="\n                  .monaco-editor.vs-dark .sticky-widget {\n                    backdrop-filter: blur(24px) !important;\n                    -webkit-backdrop-filter: blur(24px) !important;\n                    background-color: rgba(31, 41, 54, 0.5) !important;\n                    box-shadow: none !important;\n                  }\n                  \n                  .monaco-editor.vs .sticky-widget {\n                    backdrop-filter: blur(24px) !important;\n                    -webkit-backdrop-filter: blur(24px) !important;\n                    background-color: rgba(255, 255, 255, 0.5) !important;\n                    box-shadow: none !important;\n                  }\n                ",document.head.appendChild(e)})(),e.editor.defineTheme("vs-dark-transparent",{base:"vs-dark",inherit:!0,rules:[],colors:{"editor.background":"#00000000",focusBorder:"#00000000"}}),e.editor.defineTheme("vs-light-transparent",{base:"vs",inherit:!0,rules:[],colors:{"editor.background":"#00000000",focusBorder:"#00000000"}}),e.languages.typescript.typescriptDefaults.setCompilerOptions({jsx:e.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",reactNamespace:"React",allowNonTsExtensions:!0,allowJs:!0,target:e.languages.typescript.ScriptTarget.Latest}),e.languages.typescript.javascriptDefaults.setCompilerOptions({jsx:e.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",reactNamespace:"React",allowNonTsExtensions:!0,allowJs:!0,target:e.languages.typescript.ScriptTarget.Latest})},language:(null===(l=Y.RJ[R])||void 0===l?void 0:l.endsWith(".tsx"))?"typescript":(null===(r=Y.RJ[R])||void 0===r?void 0:r.endsWith(".jsx"))?"javascript":(null===(o=Y.RJ[R])||void 0===o?void 0:o.endsWith(".ts"))?"typescript":(null===(d=Y.RJ[R])||void 0===d?void 0:d.endsWith(".js"))?"javascript":(null===(c=Y.RJ[R])||void 0===c?void 0:c.endsWith(".css"))?"css":(null===(p=Y.RJ[R])||void 0===p?void 0:p.endsWith(".prisma"))?"prisma":(null===(h=Y.RJ[R])||void 0===h?void 0:h.endsWith(".md"))?"markdown":"typescript",options:{minimap:{enabled:!1},automaticLayout:!0,fontSize:14,wordWrap:"on",lineNumbers:"on",scrollBeyondLastLine:!1,folding:!0,tabSize:2,renderWhitespace:"boundary",renderLineHighlight:"line",matchBrackets:"always",formatOnPaste:!0,scrollbar:{verticalScrollbarSize:12},smoothScrolling:!0,cursorBlinking:"smooth",cursorSmoothCaretAnimation:"on",stickyScroll:{enabled:!0}},path:Y.RJ[R],theme:"dark"===ei?"vs-dark-transparent":"vs-light-transparent",value:null!==(x=null==el?void 0:el.toString())&&void 0!==x?x:"",onChange:e=>{if(e&&!et){var t;let s=null===(t=er.current)||void 0===t?void 0:t.getScrollTop();L.current={...L.current,[R]:e},$(!0),void 0!==s&&setTimeout(()=>{var e;null===(e=er.current)||void 0===e||e.setScrollTop(s)},0)}},onMount:e=>{er.current=e}}),(0,a.jsx)(O.Lt,{open:B,onOpenChange:W,children:(0,a.jsxs)(O.EO,{children:[(0,a.jsxs)(O.wd,{children:[(0,a.jsx)(O.r7,{children:"You have unsaved changes"}),(0,a.jsx)(O.$v,{children:"Are you sure you want to close? Your changes will be lost."})]}),(0,a.jsxs)(O.ck,{children:[(0,a.jsx)(O.Zr,{children:"Cancel"}),(0,a.jsx)(O.Rx,{onClick:j,children:"Discard Changes"})]})]})})]})}var ee=s(25537),et=s(1408);function es(e){let{appId:t}=e,{toast:s}=(0,et.dj)(),a=q.F.requestAutoRepair.useMutation(),n=q.F.useUtils();return{autoRepair:async()=>{if(t&&!a.isLoading)try{let e=n.getAppChatMessages.getData();e&&(n.getAppChatMessages.cancel({id:t}),n.getAppChatMessages.setData({id:t},{...e,areAgentsIdle:!1})),await a.mutateAsync({id:t}),n.getAppChatMessages.invalidate({id:t})}catch(t){let e=t instanceof Error?t.message:"Unknown error.";console.error("Error in autoRepair:",e),s({title:"Error initiating auto-repair",description:"".concat(e," Please try again."),variant:"destructive"})}},isFixing:a.isLoading}}function ea(e){let{description:t,onClose:s,className:n,containerClassName:i,appId:l}=e,{isFixing:r,autoRepair:o}=es({appId:null!=l?l:null}),d=async()=>{await o()};return(0,a.jsx)(ee.Kq,{children:(0,a.jsx)("div",{className:(0,K.cn)("flex gap-2",i),children:(0,a.jsxs)("div",{className:(0,K.cn)("flex items-center px-3 py-2 gap-2 bg-[hsl(var(--error)/0.1)] backdrop-blur-xl border border-[hsl(var(--error)/0.2)] rounded-lg sm:rounded-2xl w-full",n),children:[s&&!r&&(0,a.jsxs)(ee.bL,{delayDuration:800,children:[(0,a.jsx)(ee.l9,{asChild:!0,children:(0,a.jsx)(O.$n,{className:"h-5 w-5 sm:h-5 sm:w-5 p-0 bg-[hsl(var(--error)/0.8)] border-none hover:bg-[hsl(var(--error))] !rounded-full shrink-0",size:"icon",variant:"outline",onClick:s,children:(0,a.jsx)(T.A,{className:"h-3 w-3 text-primary-foreground"})})}),(0,a.jsx)(ee.ZL,{children:(0,a.jsxs)(ee.UC,{className:"px-3 py-1.5 text-xs bg-black/80 backdrop-blur-xl text-white rounded-md shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 z-50",side:"right",sideOffset:5,children:["Dismiss",(0,a.jsx)(ee.i3,{className:"fill-black/80",height:6,width:10})]})})]}),(0,a.jsx)("div",{className:"flex flex-grow",children:(0,a.jsx)("div",{className:"text-xs text-[hsl(var(--error))] line-clamp-2 overflow-hidden",children:t})}),(0,a.jsx)(O.$n,{className:(0,K.cn)({"opacity-50 cursor-not-allowed":r}),disabled:r,size:"sm",variant:"outline",onClick:d,children:r?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(L.A,{className:"h-3 w-3 animate-spin"}),(0,a.jsx)("span",{children:"Initiating..."})]}):"Auto-repair"})]})})})}var en=s(91592);let ei=e=>{let{textAreaRef:t,triggerAutoSize:s,maxHeight:a=Number.MAX_SAFE_INTEGER,minHeight:n=0}=e;(0,m.useLayoutEffect)(()=>{if(t&&(t.style.height="".concat(n+2,"px"),s&&t.scrollHeight>n+2)){let e=Math.min(t.scrollHeight+2,a);t.style.height="".concat(e,"px")}},[s,null==t?void 0:t.value,a,n,t])},el=e=>{let{text:t,mentionSuggestions:s}=e,n=t.split(/(@\w+)(\s|$)/).filter(Boolean);return(0,a.jsx)("div",{className:"whitespace-pre-wrap break-words",children:n.map((e,t)=>{if(e.startsWith("@")){let n=e.substring(1),i=s.some(e=>{var t;return(null===(t=e.displayName)||void 0===t?void 0:t.toLowerCase().replace(/[^a-z0-9]/g,""))===n.toLowerCase()});return(0,a.jsx)("span",{className:(0,K.cn)("rounded-sm",i?"text-blue-600":""),children:e},t)}return(0,a.jsx)("span",{children:e},t)})})},er=m.forwardRef((e,t)=>{var s,n;let{className:i,value:l="",onQueueSubmit:r,showQueueButton:o,mentionSuggestions:d,...c}=e,u=(0,m.useRef)(null),p=(0,m.useRef)(null),[h,x]=(0,m.useState)(l);return(0,m.useEffect)(()=>{x(l)},[l]),ei({textAreaRef:u.current,triggerAutoSize:h,maxHeight:320,minHeight:56}),(0,m.useImperativeHandle)(t,()=>({textArea:u.current,focus:()=>{var e;return null===(e=u.current)||void 0===e?void 0:e.focus()},maxHeight:320,minHeight:56})),(0,a.jsxs)("div",{className:"relative flex w-full justify-end",children:[d&&(0,a.jsx)("div",{className:(0,K.cn)("absolute inset-0 z-0 pointer-events-none w-full pt-3.5 px-4 pb-1.5 resize-none py-2 text-sm overflow-hidden",i),ref:p,style:{...c.style,height:"".concat(null!==(n=null===(s=u.current)||void 0===s?void 0:s.clientHeight)&&void 0!==n?n:0,"px"),minHeight:"".concat(56,"px"),maxHeight:"".concat(320,"px"),lineHeight:"calc(1.25rem + 2px)"},children:(0,a.jsx)(el,{mentionSuggestions:d,text:l})}),(0,a.jsx)("textarea",{className:(0,K.cn)("relative z-10 flex w-full rounded-md border border-input bg-transparent pt-3.5 px-4 pb-1.5 resize-none py-2 text-sm ring-offset-background focus-visible:outline-none disabled:cursor-not-allowed disabled:opacity-50 caret-black dark:caret-white",i),enterKeyHint:"send",ref:(0,K.P)(u,t),...c,style:{...c.style,height:"".concat(56,"px"),minHeight:"".concat(56,"px"),maxHeight:"".concat(320,"px"),lineHeight:"calc(1.25rem + 2px)",color:"transparent"},value:l,onChange:e=>{var t,s;x(null!==(s=e.target.value)&&void 0!==s?s:""),null===(t=c.onChange)||void 0===t||t.call(c,e)},onScroll:e=>{var t;null===(t=p.current)||void 0===t||t.scrollTo({top:e.currentTarget.scrollTop})}}),o&&(0,a.jsxs)(O.$n,{className:"absolute bottom-0 right-2 -translate-y-1/2 flex items-center gap-1",disabled:!l||c.disabled,size:"sm",type:"button",variant:"ghost",onClick:e=>{e.preventDefault(),null==r||r()},children:[(0,a.jsx)(en.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sm:hidden",children:"Q"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Queue"})]})]})});er.displayName="ChatTextarea";var eo=s(55933);let ed=()=>(0,a.jsx)("div",{className:"flex w-full p-4 pb-1",children:(0,a.jsxs)("div",{className:"flex w-full items-center justify-center p-2 gap-2 border border-dashed border-border rounded-md",children:[(0,a.jsx)(eo.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Drop files here to add to the conversation"})]})});var ec=s(69891),eu=s(93129),em=s(52684),ep=s(19696),eh=s(49565),ex=s(99421),ev=s(58655),eg=s(39453),ef=s(32002),ej=s(44108),eb=s(69212),ew=s(74341),ey=s(42481),eN=s(84730),ek=s(314),eA=s.n(ek),eC=s(42427);let eS=["#00E6F6","#00E09E","#FD6AA1","#8B63B7","#3563B6"],eE=(0,m.forwardRef)((e,t)=>{var s,n;let{userId:i,user:l,avatarClassName:r,className:o}=e,d=q.F.getUser.useQuery({id:null!=i?i:void 0},{enabled:!!i&&!l}),c=null!=l?l:d.data,{props:u}=(0,eC.getImageProps)({src:null!==(s=null==c?void 0:c.image)&&void 0!==s?s:"/assets/ph.webp",width:128,height:128,alt:"User icon"});return(0,a.jsx)("div",{className:o,children:(0,a.jsxs)(O.eu,{className:(0,K.cn)("[&_svg]:h-full [&_svg]:w-full",r),ref:t,children:[(0,a.jsx)(O.BK,{alt:"@".concat(null==c?void 0:c.handle),src:(null==c?void 0:c.image)?u.src:void 0}),(0,a.jsx)(O.q5,{delayMs:300,children:(0,a.jsx)(eA(),{colors:eS,name:null!==(n=null==c?void 0:c.id)&&void 0!==n?n:"Anonymous",square:!0,variant:"marble"})})]})})});eE.displayName="UserAvatar";var eI=s(59683),eL=s(404),eM=s(40673);function eR(e){var t,s;let{appId:n,workspaceId:i,users:l,setUsers:r,className:o,...d}=e,c=q.F.useUtils(),{currentUser:u}=(0,eI.A)(),{toast:p}=(0,O.dj)(),[h,x]=(0,m.useState)(!1),[v,g]=(0,m.useState)(""),f=function(e,t){let[s,a]=(0,m.useState)(e);return(0,m.useEffect)(()=>{let t=setTimeout(()=>{a(e)},500);return()=>{clearTimeout(t)}},[e,500]),s}(v,500),j=!!n,b=q.F.searchUsers.useQuery({query:f,includeWorkspaces:j},{enabled:f.length>0}),w=!b.isLoading&&v.length>0&&null!==(s=null===(t=b.data)||void 0===t?void 0:t.filter(e=>!l.find(t=>e.id==t.id)))&&void 0!==s?s:[],y=q.F.inviteNewUser.useMutation({onError:e=>{p({title:"Could not invite user",description:e.message,variant:"destructive"})},onSuccess:()=>{p({title:"Invitation email sent to user"}),g(""),x(!1),c.getAppAcl.invalidate(),c.listWorkspaceUsers.invalidate(),c.searchUsers.invalidate()}});return(0,a.jsxs)("div",{className:(0,K.cn)("flex flex-col gap-6",o),...d,children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("h4",{className:"text-sm font-medium",children:["Invite users",j?" or add workspaces":""]}),(0,a.jsxs)(O.AM,{open:h,onOpenChange:x,children:[(0,a.jsx)(O.Wv,{asChild:!0,children:(0,a.jsxs)(O.$n,{"aria-expanded":h,className:"font-normal justify-start",role:"combobox",variant:"outline",children:[(0,a.jsx)(ey.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),"Invite"]})}),(0,a.jsx)(O.hl,{className:"-mt-11 w-full p-0",style:{width:"var(--radix-popover-trigger-width)"},children:(0,a.jsxs)(O.uB,{className:"w-full",shouldFilter:!1,children:[(0,a.jsx)(O.G7,{autoComplete:"off",name:"query",placeholder:"Name, email or @username...",onValueChange:e=>g(e)}),(0,a.jsxs)(O.oI,{children:[!(null==w?void 0:w.length)&&(0,a.jsx)("div",{className:"flex text-sm text-muted-foreground justify-center items-center py-6 pb-4 px-2",children:f.length>0?f!=(null==u?void 0:u.email)&&(0,eM.xf)(f)?(0,a.jsxs)(O.$n,{disabled:y.isLoading,size:"sm",variant:"ghost",onClick:()=>{y.mutate({email:f,...i&&{workspace:{id:i}},...n&&{app:{id:n}}})},children:[y.isLoading?(0,a.jsx)(k.A,{className:"animate-spin h-4 w-4 mr-2"}):(0,a.jsx)(eN.A,{className:"h-4 w-4 mr-2"}),"Invite ",f]}):"No results":"Search for a user"+(j?" or workspace":"")}),(0,a.jsx)(O.L$,{children:null==w?void 0:w.map(e=>(0,a.jsxs)(O.h_,{value:e.id,onSelect:e=>{let t=w.find(t=>t.id==e);t&&(r((0,ew.A)([...null!=l?l:[],{id:t.id,name:t.name,kind:t.kind,handle:"user"==t.kind?t.handle:"",image:"user"==t.kind?t.image:null,...n&&{appAclLevel:eL.AclLevel.VIEWER},...i&&{workspaceAclLevel:"user"}}])),x(!1))},children:[e.name,"user"==e.kind&&(0,a.jsxs)("span",{className:"ml-2 text-xs text-muted-foreground",children:["@",e.handle]})]},e.id))})]})]})})]})]}),(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:l.map(e=>{var t,s,n,i;return(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["user"==e.kind&&(0,a.jsx)(eE,{avatarClassName:"h-8 w-8",user:{id:e.id,name:e.name,image:e.image}}),"workspace"==e.kind&&(0,a.jsx)("div",{className:"flex items-center justify-center w-10 h-10 bg-primary text-primary-foreground rounded-lg",children:null===(t=null!==(s=e.name)&&void 0!==s?s:"P")||void 0===t?void 0:t.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-normal leading-none",children:null!==(n=e.name)&&void 0!==n?n:"Unknown user"}),"user"==e.kind&&(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["@",null!==(i=e.handle)&&void 0!==i?i:"unknown"]}),"workspace"==e.kind&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Workspace"})]})]}),e.workspaceAclLevel&&(0,a.jsxs)(O.l6,{defaultValue:e.workspaceAclLevel,disabled:"owner"==e.workspaceAclLevel,onValueChange:t=>{"NONE"==t?r(t=>t.filter(t=>t.id!=e.id)):r(s=>s.map(s=>s.id==e.id?{...s,workspaceAclLevel:t}:s))},children:[(0,a.jsx)(O.bq,{children:(0,a.jsx)(O.yv,{placeholder:"Select"})}),(0,a.jsxs)(O.gC,{children:[(0,a.jsx)(O.eb,{disabled:!0,value:"owner",children:"Owner"}),(0,a.jsx)(O.eb,{value:"user",children:"Member"}),(0,a.jsx)(O.eb,{value:"NONE",children:"Remove"})]})]}),e.appAclLevel&&(0,a.jsxs)(O.l6,{defaultValue:e.appAclLevel,disabled:e.appAclLevel==eL.AclLevel.OWNER,onValueChange:t=>{"NONE"==t?r(t=>t.filter(t=>t.id!=e.id)):r(s=>s.map(s=>s.id==e.id?{...s,appAclLevel:t}:s))},children:[(0,a.jsx)(O.bq,{children:(0,a.jsx)(O.yv,{placeholder:"Select"})}),(0,a.jsxs)(O.gC,{children:[(0,a.jsx)(O.eb,{disabled:!0,value:eL.AclLevel.OWNER,children:"Owner"}),(0,a.jsx)(O.eb,{value:eL.AclLevel.EDITOR,children:"Editor"}),(0,a.jsx)(O.eb,{value:eL.AclLevel.VIEWER,children:"User"}),(0,a.jsx)(O.eb,{value:"NONE",children:"Remove"})]})]})]},e.id)})})]})}let eF=F.z.object({_evid:F.z.string().optional()});function ez(){let e=(0,u.useRouter)(),t=J(e=>e.isAutoVersionSwitchingLocked),s=J(e=>e.setAutoVersionSwitchingLock),a=(0,u.useSearchParams)(),{_evid:n}=eF.parse(Object.fromEntries(a));return{currentVersionId:n,switchVersion:(0,m.useCallback)(a=>{let{versionId:n,replace:i,kind:l,clearLock:r}=a;if(!n||("manual"!==l||r||s(!0),r&&s(!1),"auto"===l&&t&&!0!=r))return;let o=new URL(window.location.href);o.searchParams.set("_evid",n),o.searchParams.delete("_vid"),i?e.replace(o.toString()):e.push(o.toString())},[t,e,s])}}var eP=s(31078);function eD(e){var t,s,n;let{appId:i,children:r,defaultOpen:o=!1}=e,d=q.F.useUtils(),{toast:c}=(0,O.dj)(),[u,p]=(0,m.useState)(o),[h,x]=(0,m.useState)(void 0),[v,g]=(0,m.useState)(void 0),[f,j]=(0,m.useState)(null),b=q.F.getAppSettings.useQuery({id:i},{onSettled:e=>{var t,s;x(null!==(t=null==e?void 0:e.isUnlisted)&&void 0!==t?t:void 0),g(null!==(s=null==e?void 0:e.isForkable)&&void 0!==s?s:void 0)}}),w=q.F.updateAppAcl.useMutation({onSuccess:()=>{d.getAppAcl.invalidate()}}),y=q.F.updateAppSettings.useMutation({onSuccess:()=>{d.getAppSettings.invalidate(),d.getAppChatMessages.invalidate()}}),N=q.F.getAppById.useQuery({id:i},{keepPreviousData:!0,onError:e=>{c({title:"Error",description:e.message,variant:"destructive"})},refetchInterval:5e3}),k=!!(null===(t=N.data)||void 0===t?void 0:t.publishedVersionId),A=(null===(s=N.data)||void 0===s?void 0:s.latestVersionId)==(null===(n=N.data)||void 0===n?void 0:n.publishedVersionId),[C,S]=(0,m.useState)([]);q.F.getAppAcl.useQuery({id:i},{onSettled:e=>{var t;S(null!==(t=null==e?void 0:e.map(e=>{var t,s,a,n,i,l,r,o,d,c,u;return{id:null!==(o=null!==(r=null===(t=e.workspace)||void 0===t?void 0:t.id)&&void 0!==r?r:null===(s=e.user)||void 0===s?void 0:s.id)&&void 0!==o?o:"unknown",name:null!==(c=null!==(d=null===(a=e.workspace)||void 0===a?void 0:a.name)&&void 0!==d?d:null===(n=e.user)||void 0===n?void 0:n.name)&&void 0!==c?c:"Unknown user",handle:null!==(u=null===(i=e.user)||void 0===i?void 0:i.handle)&&void 0!==u?u:"unknown",image:null===(l=e.user)||void 0===l?void 0:l.image,appAclLevel:e.level,kind:e.user?"user":"workspace"}}))&&void 0!==t?t:[])}});let{switchVersion:E}=ez(),I=q.F.publishAppVersion.useMutation({onError:e=>{c({title:"Could not publish",description:e.message,variant:"destructive"})},onSuccess:e=>{c({title:"publishedVersion"in e&&e.publishedVersion?"Share link updated to version ".concat(e.publishedVersion.rev):"Share link enabled"}),"publishedVersion"in e&&e.publishedVersion&&E({versionId:e.publishedVersion.id,replace:!0,kind:"manual"}),d.getAppById.invalidate(),d.getAppSettings.invalidate(),d.getAppChatMessages.invalidate()}}),L=q.F.getAppVersions.useQuery({id:i},{enabled:u&&h,onSuccess:()=>{var e;!f&&(null===(e=N.data)||void 0===e?void 0:e.publishedVersionId)&&j(N.data.publishedVersionId)}}),M=(0,m.useRef)(!0);return(0,a.jsx)(eb.R,{className:"max-w-lg",description:"Enable a share link to make your app accessible to others, or invite specific people directly.",forceOpen:u,render:e=>{var t,s,n,r,o,d,u,m,p,E,M,R;return(0,a.jsxs)("div",{className:"flex flex-col gap-8",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"mt-2 flex flex-col gap-4",children:[(0,a.jsx)("div",{className:"flex flex-row justify-between items-center gap-2",children:b.isLoading?(0,a.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,a.jsx)("div",{className:"h-5 w-32 bg-muted animate-pulse rounded"}),(0,a.jsx)("div",{className:"h-5 w-10 bg-muted animate-pulse rounded"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(O.JU,{htmlFor:"public",children:"Enable share link"}),(0,a.jsx)(O.Ex,{className:"flex-shrink-0 gap-1 cursor-default",variant:"outline",children:h?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ex.A,{className:"w-3 h-3"}),"Public"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev.A,{className:"w-3 h-3"}),"Private"]})})]}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)(O.dO,{checked:null!=h&&h,disabled:b.isLoading,id:"public",onCheckedChange:e=>{x(e),e&&I.mutate({id:i})}})]})}),h&&!b.isLoading&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[N.isLoading?(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("div",{className:"h-10 bg-muted animate-pulse rounded"})}):(null===(t=N.data)||void 0===t?void 0:t.subdomain)?(0,a.jsx)("div",{className:"flex-1 flex items-center",children:(0,a.jsx)(O.pd,{className:(0,K.cn)("font-mono text-muted-foreground focus-visible:outline-none focus-visible:ring-0 focus-visible:ring-offset-0 !ring-0",{"border-input":!(k&&!A)}),id:"public-url",readOnly:!0,value:null!==(M=null===(s=N.data)||void 0===s?void 0:s.customDomain)&&void 0!==M?M:(0,eP.MJ)(null===(n=N.data)||void 0===n?void 0:n.subdomain)})}):null,(0,a.jsx)(O.$n,{className:"shrink-0 shadow-button",disabled:N.isLoading,size:"icon",variant:"outline",onClick:()=>{try{var e,t,s,a,n;if(!(null===(e=N.data)||void 0===e?void 0:e.customDomain)&&!(null===(t=N.data)||void 0===t?void 0:t.subdomain))return;let i=null!==(n=null===(s=N.data)||void 0===s?void 0:s.customDomain)&&void 0!==n?n:(0,eP.MJ)(null===(a=N.data)||void 0===a?void 0:a.subdomain);l()(i),c({title:"Copied to clipboard"})}catch(e){c({title:"Failed to copy to clipboard",variant:"destructive"})}},children:(0,a.jsx)(eg.A,{className:"w-4 h-4"})})]}),N.isLoading?(0,a.jsxs)("div",{className:"space-y-3 p-3 border rounded-md bg-muted/20",children:[(0,a.jsx)("div",{className:"h-5 bg-muted animate-pulse rounded"}),(0,a.jsx)("div",{className:"h-10 bg-muted animate-pulse rounded"}),(0,a.jsx)("div",{className:"h-4 w-3/4 bg-muted animate-pulse rounded"})]}):(null===(o=N.data)||void 0===o?void 0:null===(r=o.publishedVersion)||void 0===r?void 0:r.rev)?(0,a.jsxs)("div",{className:"space-y-3 p-3 border rounded-md bg-muted/20",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Published version"}),!A&&(0,a.jsx)(O.Ex,{className:"bg-warning/20 text-warning-foreground border-warning/30",variant:"outline",children:"Newer version available"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)(O.rI,{children:[(0,a.jsx)(O.ty,{asChild:!0,children:(0,a.jsx)(O.$n,{className:"w-full justify-between font-normal",disabled:L.isLoading,variant:"outline",children:L.isLoading?"Loading versions...":(0,a.jsxs)(a.Fragment,{children:[(null===(d=L.data)||void 0===d?void 0:d.find(e=>{var t;return e.id===(null!=f?f:null===(t=N.data)||void 0===t?void 0:t.publishedVersionId)}))?"Version ".concat(null===(m=L.data)||void 0===m?void 0:null===(u=m.find(e=>{var t;return e.id===(null!=f?f:null===(t=N.data)||void 0===t?void 0:t.publishedVersionId)}))||void 0===u?void 0:u.rev).concat((null!=f?f:null===(p=N.data)||void 0===p?void 0:p.publishedVersionId)===(null===(E=N.data)||void 0===E?void 0:E.latestVersionId)?" (latest)":""):"Select version",(0,a.jsx)(ef.A,{className:"h-4 w-4 ml-2"})]})})}),(0,a.jsx)(O.SQ,{className:"w-[200px] max-h-[300px] overflow-y-auto",children:L.isLoading?(0,a.jsx)(O._2,{disabled:!0,children:"Loading versions..."}):[...null!==(R=L.data)&&void 0!==R?R:[]].sort((e,t)=>t.rev-e.rev).map(e=>{var t,s;return(0,a.jsxs)(O._2,{className:(0,K.cn)("flex items-center justify-between",(null!=f?f:null===(t=N.data)||void 0===t?void 0:t.publishedVersionId)===e.id&&"bg-accent/50 font-medium"),onClick:()=>j(e.id),children:[(0,a.jsxs)("span",{children:["Version ",e.rev]}),e.id===(null===(s=N.data)||void 0===s?void 0:s.latestVersionId)&&(0,a.jsx)(O.Ex,{className:"ml-1 text-[10px] h-4 px-1",variant:"outline",children:"latest"})]},e.id)})})]})}),(0,a.jsx)(O.$n,{disabled:I.isLoading||!f||f===N.data.publishedVersionId,size:"sm",variant:A?"secondary":"default",onClick:()=>{f&&I.mutate({id:i,versionId:f})},children:I.isLoading?"Updating...":"Update share link"})]}),!A&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Users with the share link are currently seeing version"," ",N.data.publishedVersion.rev,", not your latest changes."]})]}):null]})]}),(0,a.jsx)("div",{className:"mt-2 flex flex-row justify-between items-center gap-2",children:b.isLoading?(0,a.jsxs)("div",{className:"w-full flex justify-between items-center",children:[(0,a.jsx)("div",{className:"h-5 w-32 bg-muted animate-pulse rounded"}),(0,a.jsx)("div",{className:"h-5 w-10 bg-muted animate-pulse rounded"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(O.JU,{htmlFor:"remixable",children:"Allow remixing"}),(0,a.jsx)(O.Bc,{children:(0,a.jsxs)(O.m_,{children:[(0,a.jsx)(O.k$,{children:(0,a.jsx)(ej.A,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)(O.ZI,{children:"Allow others to remix this app"})]})})]}),(0,a.jsx)("div",{className:"flex-1"}),(0,a.jsx)(O.dO,{checked:null==v||v,disabled:b.isLoading,id:"remixable",onCheckedChange:e=>{g(e),y.mutate({id:i,isUnlisted:null!=h&&h,isForkable:e})}})]})})]}),(0,a.jsx)(eR,{appId:i,setUsers:S,users:C}),(0,a.jsxs)("div",{className:"flex flex-row justify-end items-center gap-2",children:[(0,a.jsx)(O.$n,{variant:"outline",onClick:()=>{e()},children:"Cancel"}),(0,a.jsx)(O.$n,{className:"shadow-button",disabled:b.isLoading||N.isLoading,onClick:()=>{w.mutate({id:i,acl:C.map(e=>{var t;return{userId:"user"===e.kind?e.id:void 0,workspaceId:"workspace"===e.kind?e.id:void 0,level:null!==(t=e.appAclLevel)&&void 0!==t?t:eL.AclLevel.VIEWER}})}),y.mutate({id:i,isUnlisted:null!=h&&h,isForkable:null==v||v}),e()},children:"Save"})]})]})},title:"Share",onOpenChange:e=>{if(p(e),!e){if(M.current){M.current=!1;return}S([]),d.getAppAcl.invalidate(),d.searchUsers.invalidate(),d.getAppAcl.invalidate(),d.getAppSettings.invalidate()}},children:"function"==typeof r?r({isUnlisted:h,isLoading:b.isLoading,open:()=>p(!0)}):(0,a.jsx)("div",{onClick:()=>p(!0),children:r})})}var eT=s(26017),eU=s(18964),eV=s(27485),eO=s(78804),eH=s(49523),e_=s(8738),e$=s(6698),eB=s(73580),eW=s(49649);function eJ(e){var t;let{children:s,content:n,side:i="top",...l}=e;return(0,a.jsxs)(ee.bL,{delayDuration:null!==(t=l.delayDuration)&&void 0!==t?t:800,children:[(0,a.jsx)(ee.l9,{asChild:!0,children:s}),(0,a.jsx)(ee.ZL,{children:(0,a.jsxs)(ee.UC,{className:"px-3 py-1.5 text-xs bg-black/80 backdrop-blur-xl text-white rounded-md shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 z-50",sideOffset:5,side:i,children:[n,(0,a.jsx)(ee.i3,{className:"fill-black/80",height:6,width:10})]})})]})}var eQ=s(75660),eG=s(53219).Buffer;async function eq(e){let{dataUrl:t,resize:s,crop:a}=e,n=await eQ._V.load(t),{width:i,height:l}=n,r=n;return a&&(r=r.crop(i<l?{x:0,y:(l-i)/2,width:i,height:i}:{x:(i-l)/2,y:0,width:l,height:l})),s&&s<(i<l?i:l)&&(r=r.resize({width:s})),eG.from(r.toBuffer())}async function eY(e){let{dataUrl:t,x:s,y:a}=e;if(!t)return"rgba(0, 0, 0, 0)";let n=await eQ._V.load(t),i=n.channels,l=[];for(let e=0;e<i;e++)l.push(n.data[(a*n.width+s)*i+e]);if(3==i)return"rgb(".concat(l.join(", "),")");if(4==i)return"rgba(".concat(l.join(", "),")");throw Error("Unsupported number of channels")}function eK(e){let t=e.toLowerCase();return t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png")||t.endsWith(".gif")||t.endsWith(".svg")||t.endsWith(".webp")||t.startsWith("data:image/")}function eZ(){return(0,a.jsx)(O.EA,{className:"flex-shrink-0 w-16 h-16 border-2 rounded-2xl"})}function eX(e){var t,s,n,i,l,r,o,d,c,u;let{url:p,onRemove:h,onUpdate:x,openEditor:v,onEditorClose:g}=e,f=(0,m.useRef)(null),[j,b]=(0,m.useState)(!1),w=q.F.getUpload.useQuery({url:p},{enabled:!p.startsWith("data:image")}),y=(0,eT.I)(["base64",p],async()=>{let e=await fetch(p),t=await e.blob();return await new Promise(e=>{let s=new FileReader;s.onloadend=()=>{e(s.result)},s.readAsDataURL(t)})},{enabled:!p.startsWith("data:")&&eK(p)}),N=(0,eT.I)(["bgColor",p],async()=>await eY({dataUrl:p,x:1,y:1}),{enabled:!!p}),[k,A]=(0,m.useState)(null!=v&&v);if(p.startsWith("data:")||eK(p))return p.startsWith("data:")||"loading"!==y.status?(0,a.jsx)(O.Bc,{delayDuration:400,disableHoverableContent:!0,children:(0,a.jsxs)("div",{className:"group w-16 h-16 flex-shrink-0 overflow-hidden relative rounded-2xl",children:[(0,a.jsxs)(O.lG,{open:k,onOpenChange:e=>{e||null==g||g(),A(e)},children:[(0,a.jsx)(O.zM,{asChild:!0,children:(0,a.jsx)("img",{alt:"attached",className:"w-full bg-white aspect-square object-cover cursor-pointer",src:p,onClick:()=>A(!0)})}),(0,a.jsxs)(O.Cf,{"aria-describedby":"Edit screenshot",className:"p-0 w-[100vw] max-w-[100vw] h-[100svh] max-h-[100svh] gap-0",showCloseButton:!1,children:[(0,a.jsx)(O.L3,{className:"sr-only",children:"Edit Screenshot"}),(0,a.jsxs)("div",{className:"flex flex-row items-center h-11 sm:h-9 gap-2 bg-background/90 backdrop-blur-xl border-b border-border/60 px-2 py-1",children:[(0,a.jsx)(O.HM,{asChild:!0,children:(0,a.jsxs)(O.$n,{className:"flex h-9 w-9 sm:h-7 sm:w-auto gap-1 rounded-xl sm:rounded-lg hover:bg-accent/80",size:"sm",type:"button",variant:"ghost",children:[(0,a.jsx)(T.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5"})," Cancel"]})}),(0,a.jsxs)("div",{className:"flex flex-1 text-xs justify-center",children:[(0,a.jsx)(eU.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 mr-2 text-indigo-400"}),"Drag to draw"]}),j&&(0,a.jsxs)(O.$n,{className:"flex h-9 w-9 sm:h-7 sm:w-auto gap-1 rounded-xl sm:rounded-lg hover:bg-accent/80",size:"sm",type:"button",variant:"ghost",onClick:()=>{var e;null===(e=f.current)||void 0===e||e.undo()},children:[(0,a.jsx)(eV.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5"})," Undo"]}),j&&(0,a.jsx)(O.HM,{asChild:!0,children:(0,a.jsxs)(O.$n,{className:"flex h-9 w-9 sm:h-7 sm:w-auto gap-1 rounded-xl sm:rounded-lg hover:bg-accent/80",size:"sm",type:"button",variant:"ghost",onClick:async()=>{var e;let t=await (null===(e=f.current)||void 0===e?void 0:e.exportImage("png"));t&&(null==x||x(t)),A(!1),null==g||g()},children:[(0,a.jsx)(eO.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5"})," Done"]})})]}),(0,a.jsx)(eW.K,{backgroundImage:null!==(i=y.data)&&void 0!==i?i:p,canvasColor:null!==(l=N.data)&&void 0!==l?l:"white",className:"w-100 h-[calc(100svh-2.5rem)] !border-0 !rounded-none cursor-crosshair",exportWithBackgroundImage:!0,height:"1024",preserveBackgroundImageAspectRatio:"xMidYMin meet",ref:f,strokeColor:"red",strokeWidth:4,svgStyle:{background:null!==(r=N.data)&&void 0!==r?r:"white"},width:"1024",onStroke:()=>{b(!0)}})]})]}),(0,a.jsx)(eJ,{content:"Remove file",children:(0,a.jsx)(O.$n,{className:"absolute top-1 right-1 h-6 w-6 sm:h-6 sm:w-6 border-2 !rounded-full",size:"iconSm",type:"button",variant:"default",onClick:()=>{null==h||h()},children:(0,a.jsx)(T.A,{className:"h-3 w-3"})})})]})}):(0,a.jsx)(eZ,{});if("loading"===w.status)return(0,a.jsx)(eZ,{});let C=null===(s=(null!==(o=null===(t=w.data)||void 0===t?void 0:t.originalName)&&void 0!==o?o:p).split(".").pop())||void 0===s?void 0:s.toLowerCase(),S="File";C&&(S=null!==(d=({xlsx:"Spreadsheet",xls:"Spreadsheet",csv:"Spreadsheet",docx:"Document",doc:"Document",pdf:"PDF",pptx:"Presentation",ppt:"Presentation",json:"JSON",md:"Markdown",tsx:"TSX",ts:"TS",js:"JS",txt:"Text",zip:"ZIP",rar:"RAR",xml:"XML",html:"HTML",css:"CSS",jpg:"Image",jpeg:"Image",png:"Image",gif:"Image",webp:"Image",svg:"Image"})[C])&&void 0!==d?d:C.toUpperCase());let E=null!==(c=C&&({xlsx:"bg-green-400",xls:"bg-green-400",csv:"bg-green-400",docx:"bg-blue-500",doc:"bg-blue-500",pdf:"bg-fuchsia-500",pptx:"bg-orange-400",ppt:"bg-orange-400",json:"bg-violet-400",md:"bg-violet-400",tsx:"bg-violet-400",ts:"bg-violet-400",js:"bg-violet-400",txt:"bg-gray-400",zip:"bg-yellow-400",rar:"bg-yellow-400",xml:"bg-violet-400",html:"bg-pink-400",css:"bg-blue-300",svg:"bg-teal-400"})[C])&&void 0!==c?c:"bg-muted",I={xlsx:eH.A,xls:eH.A,csv:eH.A,docx:e_.A,doc:e_.A,txt:e_.A,md:e_.A,pdf:e$.A,pptx:e_.A,ppt:e_.A,json:eh.A,tsx:eh.A,ts:eh.A,js:eh.A,html:eh.A,xml:eh.A,css:eh.A,zip:eB.A,rar:eB.A},L=C&&null!==(u=I[C])&&void 0!==u?u:e$.A;return(0,a.jsxs)("div",{className:"group relative flex items-center h-16 w-auto max-w-64 p-2 gap-2 bg-card/80 rounded-2xl text-muted-foreground",children:[(0,a.jsx)("div",{className:"flex-shrink-0 flex items-center justify-center w-10 h-10 rounded-xl ".concat(E),children:(0,a.jsx)(L,{className:"h-5 w-5 text-white"})}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0 pr-8",children:[(0,a.jsx)("span",{className:"text-xs font-medium truncate",children:null===(n=w.data)||void 0===n?void 0:n.originalName}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:S})]}),(0,a.jsx)(O.$n,{className:"absolute top-1 right-1 h-6 w-6 sm:h-6 sm:w-6 border-2 !rounded-full",size:"iconSm",type:"button",variant:"default",onClick:()=>{null==h||h()},children:(0,a.jsx)(T.A,{className:"h-3 w-3"})})]})}var e0=s(96323),e1=s(69487),e2=s(12206),e4=s(75569);function e5(e){var t,s,n;let{messages:i,appId:l,setIsContentPanelVisible:r}=e,o=J(e=>e.openAppEditor),[d,c]=(0,m.useState)(!1),[u,p]=(0,m.useState)(null),[h,x]=(0,m.useState)(!1),{currentVersionId:v,switchVersion:g}=ez(),{toast:f}=(0,et.dj)(),j=q.F.useUtils(),b=q.F.revertApp.useMutation({onSuccess:e=>{f({title:"Reverted to version from ".concat((0,e4.Pp)(e.createdAt))}),j.getAppById.invalidate(),j.getAppChatMessages.invalidate(),g({versionId:e.id,replace:!0,kind:"manual",clearLock:!0})},onError:e=>{f({title:"Could not revert",description:e.message,variant:"destructive"})}}),w=q.F.remixApp.useMutation({onSuccess:()=>{f({title:"Version cloned successfully"}),j.getAppById.invalidate(),j.getAppChatMessages.invalidate()}}),y=J(e=>e.setIsMinimized),N=i.find(e=>"version"===e.kind&&(null==e?void 0:e.version.id)===v),A=i.filter(e=>"version"===e.kind),C=null!==(n=null!==(s=null==N?void 0:N.version.rev)&&void 0!==s?s:null===(t=A[A.length-1])||void 0===t?void 0:t.version.rev)&&void 0!==n?n:"0";return((0,m.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)");x(e.matches);let t=e=>{x(e.matches)};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),0===A.length)?null:(0,a.jsxs)(e2.AM,{open:d,onOpenChange:c,children:[(0,a.jsx)(e2.Wv,{asChild:!0,children:(0,a.jsxs)(e1.$,{size:"sm",variant:"ghost",children:["v",C]})}),(0,a.jsx)(e2.hl,{align:"start",className:"p-0 bg-popover/80 border border-border/60 backdrop-blur-lg rounded-xl shadow-inner shadow-card overflow-y-auto",style:{maxHeight:"min(400px, var(--radix-popover-content-available-height))"},children:(0,a.jsx)("div",{className:"p-2 h-full",children:A.map(e=>(0,a.jsxs)("div",{className:(0,K.cn)("flex items-center px-2 py-1 rounded-lg group hover:bg-accent/40",v===e.version.id&&"bg-accent/60"),onMouseEnter:()=>p(e.version.id),onMouseLeave:()=>p(null),children:[(0,a.jsxs)(e1.$,{className:"flex-1 justify-start px-0 hover:bg-transparent",variant:"ghost",onClick:()=>{g({versionId:e.version.id,kind:"manual"}),c(!1)},children:["Version ",e.version.rev]}),(0,a.jsxs)("div",{className:(0,K.cn)("flex gap-1 transition-all",h?"":"duration-300 ease-in-out",v===e.version.id||u===e.version.id?"opacity-100":"opacity-0"),style:{transitionDelay:h||u!==e.version.id?"0ms":"150ms"},children:[(0,a.jsx)(eJ,{content:"Open code editor",children:(0,a.jsx)(e1.$,{className:"sm:h-6 sm:w-6 p-0 bg-secondary shadow-button hover:bg-accent",size:"iconSm",variant:"outline",onClick:t=>{t.stopPropagation(),y(!1),r(!0),o({versionId:e.version.id,tab:"App.tsx"}),c(!1)},children:(0,a.jsx)(eh.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"})})}),(0,a.jsx)(eJ,{content:"Revert to this version",children:(0,a.jsx)(e1.$,{className:"sm:h-6 sm:w-6 p-0 bg-secondary shadow-button hover:bg-accent",size:"iconSm",variant:"outline",onClick:t=>{t.stopPropagation(),window.confirm("Are you sure you want to undo everything after this message? You can not undo this.")&&(b.mutate({versionId:e.version.id}),c(!1))},children:(0,a.jsx)(eV.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"})})}),(0,a.jsx)(eJ,{content:"Remix this version",children:(0,a.jsx)(e1.$,{className:"sm:h-6 sm:w-6 p-0 bg-secondary shadow-button hover:bg-accent",disabled:w.isLoading,size:"iconSm",variant:"outline",onClick:t=>{t.stopPropagation(),w.mutate({id:l,versionId:e.version.id}),c(!1)},children:w.isLoading?(0,a.jsx)(k.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 animate-spin"}):(0,a.jsx)(e0.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"})})})]})]},e.version.id))})})]})}var e3=s(56797);let e6={initial:{opacity:0,y:20,scale:.9},animate:{opacity:1,y:0,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{opacity:0,y:20,scale:.9,transition:{duration:.15,ease:"easeIn"}}};function e8(e){let{variant:t="minimized",isSendingMessage:s,isViewingLatestVersion:n,canEditApp:i,latestVersionRev:l,app:r,currentVersionId:o,versionId:c,chatLog:u=[],capabilities:m,onChatClick:p,dropzoneOpen:h,handleAnnotateScreenshot:x,switchVersion:v,goonStatus:f,onTagApps:j}=e,b=(0,H.al)(),{isMinimized:w,isGeneratingScreenshot:y,fileUploads:N,isUploading:k,appEditor:A,setIsMinimized:C,setOpenEditor:I,setFileUploads:L,setAttachScreenshot:M,setIsContentPanelVisible:R,closeAppEditor:F,openAppEditor:z,setIsGoonbarHidden:P}=J(),D="",T=u.filter(e=>"status"===e.kind&&"object"==typeof e.status&&null!==e.status&&"kind"in e.status&&"tool"===e.status.kind&&"status"in e.status).sort((e,t)=>t.timestamp-e.timestamp);T.length>0&&(D=T[0].status.status||"");let U=s&&D;return"minimized"===t&&w?(0,a.jsx)(ee.Kq,{disableHoverableContent:!0,children:(0,a.jsxs)(d.P.div,{animate:"animate",className:(0,K.cn)("flex flex-row w-fit mx-auto items-center p-2 gap-0 bg-gradient-to-b from-background/80 to-secondary/80 backdrop-blur-2xl border border-border rounded-2xl shadow-2xl pointer-events-auto","color-flow-glow",s&&"is-loading !min-h-[46px]","cursor-pointer"),"data-chat-minimized":!0,exit:"exit",initial:"initial",variants:e6,onClick:e=>{e.stopPropagation(),s&&p&&p()},children:[U&&(0,a.jsxs)("div",{className:"flex items-center gap-1 px-1 py-0.5 text-xs text-primary/90 compact-shimmer-text",children:[(0,a.jsx)(e3.iN,{className:"h-4 w-4 shrink-0"}),(0,a.jsx)("span",{className:"truncate max-w-[180px] font-medium shimmer-text",children:D})]}),(k||N.length>0)&&(0,a.jsx)("div",{className:"hidden",children:N.map((e,t)=>(0,a.jsx)(eX,{openEditor:y&&eK(e),url:e,onEditorClose:()=>{I(!1),setTimeout(()=>{C(!1)},75)},onRemove:()=>{L(e=>e.filter((e,s)=>s!==t)),N.length-1==0&&M(!0)},onUpdate:e=>L(s=>(0,g.A)(s.map((s,a)=>a===t?e:s)))},"hidden-file-upload-".concat(t)))}),!s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eJ,{content:"Open chat",children:(0,a.jsx)(O.$n,{size:"iconSm",type:"button",variant:"ghost",onClick:()=>{p&&p()},children:(0,a.jsxs)("div",{className:"relative",children:[f&&(0,a.jsxs)("div",{className:"absolute -top-0.5 -right-0.5 flex h-2 w-2",children:[(0,a.jsx)("span",{className:(0,K.cn)("absolute inline-flex h-full w-full animate-ping rounded-full opacity-75",G[f.kind].backgroundPing)}),(0,a.jsx)("span",{className:(0,K.cn)("relative inline-flex h-2 w-2 rounded-full",G[f.kind].background)})]}),(0,a.jsx)(S.A,{className:"h-3.5 w-3.5"})]})})}),m.allowScreenshot&&(0,a.jsx)(eJ,{content:"Visual edit",children:(0,a.jsx)(O.$n,{className:(0,K.cn)(y&&"cursor-not-allowed"),disabled:y,size:"iconSm",type:"button",variant:"ghost",onClick:e=>{e.stopPropagation(),y||x()},children:(0,a.jsx)(e3.h,{className:"h-3.5 w-3.5"})})}),(null==r?void 0:r.id)&&m.allowShare&&(0,a.jsx)(eD,{appId:r.id,children:(0,a.jsx)(eJ,{content:"Share App",children:(0,a.jsx)(O.$n,{size:"iconSm",type:"button",variant:"ghost",children:(0,a.jsx)(ec.A,{className:"h-3.5 w-3.5"})})})}),(0,a.jsx)(eJ,{content:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{children:"Hide editor"}),(0,a.jsxs)("div",{className:"flex items-center gap-0.5 px-1 py-0 text-[10px] font-medium rounded border border-border",children:[(0,a.jsx)(eu.A,{className:"h-2.5 w-2.5"}),(0,a.jsx)("span",{children:"/"})]})]}),children:(0,a.jsx)(O.$n,{"aria-label":"Hide editor",size:"iconSm",type:"button",variant:"ghost",onClick:()=>P(!0),children:(0,a.jsx)(em.A,{className:"h-3.5 w-3.5"})})})]})]},"goontools")}):(0,a.jsx)(ee.Kq,{disableHoverableContent:!0,children:(0,a.jsxs)("div",{className:(0,K.cn)("flex w-full items-center justify-between pointer-events-auto","transition-colors duration-300","bg-transparent"),children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(eJ,{content:"Upload file",children:(0,a.jsx)(O.$n,{className:(0,K.cn)((!n||y)&&"!cursor-not-allowed"),disabled:!n||y,size:"iconSm",type:"button",variant:"ghost",onClick:()=>null==h?void 0:h(),children:(0,a.jsx)(ep.A,{className:"h-4 w-4"})})}),m.allowScreenshot&&(0,a.jsx)(eJ,{content:"Visual edit",children:(0,a.jsx)(O.$n,{className:(0,K.cn)((!n||y)&&"!cursor-not-allowed"),disabled:!n||y,size:"iconSm",type:"button",variant:"ghost",onClick:()=>{x()},children:(0,a.jsx)(e3.h,{className:"h-4 w-4"})})}),m.showVersionControl&&r&&i&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eJ,{content:A.isOpen?"View chat":"View code",children:(0,a.jsx)(O.$n,{"aria-label":A.isOpen?"View chat":"View code",size:"iconSm",type:"button",variant:"ghost",onClick:e=>{if(e.stopPropagation(),A.isOpen)F();else{if(!c){console.error("versionId is undefined. Cannot open editor.");return}I(!0),R(!0),z({versionId:c,tab:"App.tsx"})}},children:A.isOpen?(0,a.jsx)(S.A,{className:"h-4 w-4"}):(0,a.jsx)(eh.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(ee.bL,{delayDuration:800,children:[(0,a.jsx)(ee.l9,{asChild:!0,children:(0,a.jsx)("div",{children:(0,a.jsx)(e5,{appId:r.id,currentVersion:null!=o?o:"",messages:u,setIsContentPanelVisible:R})})}),(0,a.jsx)(ee.ZL,{children:(0,a.jsxs)(ee.UC,{className:"px-3 py-1.5 text-xs bg-black/80 backdrop-blur-xl text-white rounded-md shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 z-50",sideOffset:5,children:["Version History",(0,a.jsx)(ee.i3,{className:"fill-black/80",height:6,width:10})]})})]}),(0,a.jsx)(eJ,{content:"Tag apps",children:(0,a.jsx)(O.$n,{"aria-label":"Tag apps",size:"iconSm",type:"button",variant:"ghost",onClick:e=>{e.stopPropagation(),null==j||j()},children:(0,a.jsx)(E.A,{className:"h-4 w-4"})})})]}),m.showVersionControl&&i&&!n&&v&&(0,a.jsxs)(O.$n,{className:"gap-1 rounded-lg shadow-inner ml-1.5",size:"sm",type:"button",variant:"primary",onClick:()=>{v({versionId:null==r?void 0:r.latestVersionId,kind:"manual",clearLock:!0})},children:["Switch to v",null!=l?l:"?"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(null==r?void 0:r.id)&&m.allowShare&&(0,a.jsx)(eD,{appId:r.id,children:e=>{let{isUnlisted:t,isLoading:s,open:n}=e;return(0,a.jsx)(eJ,{content:"Share App",children:(0,a.jsx)(O.$n,{disabled:s,size:"xs",type:"button",variant:t?"outline":"default",onClick:n,children:(0,a.jsx)("span",{className:t?"":"text-transparent bg-clip-text [background-image:var(--whisper-gradient)] animate-whisper",children:"Share app"})})})}}),m.allowHideGoonbar&&!b&&(0,a.jsx)(eJ,{content:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("span",{children:"Hide editor"}),(0,a.jsxs)("div",{className:"flex items-center gap-0.5 px-1 py-0 text-[10px] font-medium rounded border border-border",children:[(0,a.jsx)(eu.A,{className:"h-2.5 w-2.5"}),(0,a.jsx)("span",{children:"/"})]})]}),children:(0,a.jsx)(O.$n,{"aria-label":"Hide editor",size:"iconSm",type:"button",variant:"ghost",onClick:()=>P(!0),children:(0,a.jsx)(em.A,{className:"h-4 w-4"})})})]})]})})}var e9=s(99561);let e7=e=>{let{isPublishing:t,latestVersionRev:s,onPublish:n,className:i,containerClassName:l}=e;return(0,a.jsx)("div",{className:(0,K.cn)("flex gap-2",l),children:(0,a.jsxs)("div",{className:(0,K.cn)("flex items-center px-3 py-2 gap-2 bg-secondary/80 backdrop-blur-xl border rounded-lg sm:rounded-2xl w-full",i),children:[(0,a.jsx)("div",{className:"flex flex-grow text-xs",children:(0,a.jsx)("div",{className:"text-xs",children:(0,a.jsx)("span",{className:"font-medium",children:"Latest changes not published"})})}),n&&(0,a.jsxs)(O.$n,{size:"sm",variant:"outline",onClick:n,children:[t?(0,a.jsx)(k.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 animate-spin"}):(0,a.jsx)(e9.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),t?"Publishing...":"Publish ".concat(s?"v".concat(s):"latest")]})]})})};var te=s(51159),tt=s(67528),ts=s(73157),ta=s(95717),tn=s(91549);function ti(e){let{message:t}=e,s=J(e=>e.openAppEditor);return(0,a.jsxs)("div",{className:"w-full flex gap-1 h-7 flex-row items-center cursor-pointer text-muted-foreground hover:text-foreground",onClick:()=>{s({versionId:t.info.versionId,tab:"db"})},children:[(0,a.jsx)(tn.A,{className:"w-4 h-4"})," ",t.info.count," ",(0,eM.td)("update",t.info.count)," made to database"]})}var tl=s(1602);function tr(e){var t;let{message:s,app:n}=e,{toast:i}=(0,O.dj)(),l=q.F.useUtils(),r=(0,u.useRouter)(),{mutateAsync:o,isLoading:d}=q.F.retryAppTasks.useMutation({onSuccess:()=>{i({title:"Restarting, please wait."}),l.getAppById.invalidate(),l.getAppChatMessages.invalidate()},onError:e=>{i({title:"Could not continue",description:e.message,variant:"destructive"})}}),c=null!==(t=q.F.getRecentAppVersions.useQuery({appId:null==n?void 0:n.id},{enabled:!!n}).data)&&void 0!==t?t:[],{switchVersion:m}=ez(),p=q.F.revertApp.useMutation({onSuccess:e=>{i({title:"Reverted to version from ".concat((0,e4.Pp)(e.createdAt))}),l.getAppById.invalidate(),l.getAppChatMessages.invalidate(),m({versionId:e.id,replace:!0,kind:"manual",clearLock:!0})},onError:e=>{let t=(0,Y.CK)(e);if(t){var s;let e=null===(s=t.info)||void 0===s?void 0:s.versionId;i({title:"Could not revert",description:t.message,variant:"destructive",action:e?(0,a.jsx)(O.Qg,{altText:"dismiss",onClick:()=>p.mutate({versionId:e,force:!0}),children:"Force"}):void 0})}else i({title:"Could not revert",description:e.message,variant:"destructive"})}});return(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-4 rounded-lg bg-destructive/30",children:[(0,a.jsx)("div",{className:"flex flex-col gap-2 text-sm font-medium",children:"error"===s.status.kind?s.status.status:"An unexpected error occurred"}),(0,a.jsxs)("div",{className:"flex flex-row gap-2",children:[s.id==tl.Cf&&"status"==s.kind&&"error"==s.status.kind&&(0,a.jsx)(O.$n,{className:"self-start",disabled:d,size:"sm",type:"button",variant:"default",onClick:()=>{o({id:null==n?void 0:n.id})},children:d?"Retrying...":"Retry"}),s.id!=tl.Cf&&"status"===s.kind&&"error"===s.status.kind&&(0,a.jsx)(a.Fragment,{children:c.length>1?(0,a.jsxs)(O.rI,{children:[(0,a.jsx)(O.ty,{asChild:!0,children:(0,a.jsxs)(O.$n,{size:"sm",type:"button",variant:"outline",children:["Revert to Version ",(0,a.jsx)(ef.A,{className:"ml-2 h-4 w-4"})]})}),(0,a.jsx)(O.SQ,{children:c.map(e=>(0,a.jsxs)(O._2,{onSelect:()=>{p.mutate({versionId:e.id})},children:["Version ",e.rev]},e.id))})]}):1===c.length&&(0,a.jsx)(O.$n,{size:"sm",type:"button",variant:"outline",onClick:()=>r.push((0,eP.$_)()),children:"Return Home"})})]})]})}var to=s(94896),td=s(87221),tc=s(22410),tu=s(63655),tm=s(41961),tp=s(26489),th=s(75869);function tx(e){let{children:t}=e,s=(0,m.useRef)(null),[n,i]=(0,m.useState)(null),[l,r]=(0,m.useState)(!1);(0,m.useEffect)(()=>{s.current&&i(s.current.clientHeight)},[t]);let o=null==n||n<128;return(0,a.jsxs)("div",{className:"relative pre-formatted",children:[!o&&(0,a.jsx)(O.$n,{className:"absolute top-1 right-1 z-20",size:"sm",onClick:()=>r(e=>!e),children:l?(0,a.jsx)(em.A,{className:"h-3 w-3"}):(0,a.jsx)(to.A,{className:"h-3 w-3"})}),(0,a.jsxs)("pre",{className:(0,K.cn)({"max-h-32":!o&&!l,"overflow-hidden":!o&&!l},"relative"),ref:s,children:[t,!o&&!l&&(0,a.jsx)("div",{className:"absolute bottom-0 w-full h-8 bg-gradient-to-t from-[var(--tw-prose-pre-bg)]"})]})]})}function tv(e){let{children:t}=e;return(0,a.jsx)(a.Fragment,{children:t})}tu.A.registerLanguage("tsx",tp.A),tu.A.registerLanguage("ts",tp.A),tu.A.registerLanguage("typescript",tp.A),tu.A.registerLanguage("css",tm.A);let tg=(0,m.memo)(e=>{let{children:t,className:s}=e,n=(0,eM.l)(t),i=(e=>{let t=e;return["analysis","request-type","diagnosis","context","internal-note","rephrased-message","call","prompt-suggestions"].forEach(e=>{let s=RegExp("<".concat(e,"[^>]*>.*?</").concat(e,">"),"gs");t=t.replace(s,"")}),t})((0,eM.Oy)(n));return(0,a.jsx)("div",{className:"prose prose-sm dark:prose-invert markdown-container relative ".concat(null!=s?s:""),children:(0,a.jsx)(tc.oz,{components:{p:e=>{let{children:t}=e,s=new URL((0,eP.$_)()),n=(0,te.A)(eP.UR+s.host),i=RegExp("https?://".concat("[a-z0-9]+").concat(n,"/cdn/").concat("[^\\s]+"),"g"),l=String(t);if(i.test(l)){let e=l.split(i);return(0,a.jsx)(a.Fragment,{children:e.map((t,s)=>{var n;let r=null===(n=l.match(i))||void 0===n?void 0:n[s];return r?(0,a.jsx)(()=>{var n,i,l,o,d;let c=q.F.getUpload.useQuery({url:r},{enabled:!r.startsWith("data:image")});if("loading"===c.status)return null;let u=null!==(o=null===(n=r.split(".").pop())||void 0===n?void 0:n.toLowerCase())&&void 0!==o?o:"";return(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("p",{children:t}),s<e.length-1&&(0,a.jsx)("a",{href:r,target:"_blank",children:(0,a.jsxs)(O.Ex,{className:"gap-1 border border-foreground/20 hover:bg-foreground/10 bg-muted rounded-sm py-1",variant:"outline",children:[eK(r)?(0,a.jsx)(td.A,{size:12}):(0,a.jsx)(e$.A,{size:12}),(null!==(d=c.error)&&void 0!==d?!d:null===(i=c.data)||void 0===i?void 0:i.originalName)?null===(l=c.data)||void 0===l?void 0:l.originalName:u?"".concat(u.toUpperCase()," Attached"):"File Attached"]})})]})},{},"Attachment-".concat(s)):null})})}return(0,a.jsx)("p",{children:t})},pre:tx,thinking:e=>{let{children:t}=e;return"string"==typeof t?(0,a.jsx)(tg,{className:"thinking",children:t}):Array.isArray(t)?t.some(e=>"object"==typeof e)?(0,a.jsx)("div",{className:"thinking",children:t}):(0,a.jsx)(tg,{className:"thinking",children:t.join("")}):(0,a.jsx)("div",{className:"thinking",children:t})},img:e=>{let{alt:t,...s}=e;return(0,a.jsx)("img",{alt:null!=t?t:"attachment",style:{maxHeight:"250px",objectFit:"cover"},...s})},code:e=>{let{className:t,children:s,node:n,...i}=e,l=/language-(\w+)/.exec(null!=t?t:"");return l?(0,a.jsx)(tu.A,{...i,children:String(s).replace(/\n$/,""),codeTagProps:{className:"prose prose-sm dark:prose-invert"},language:null==l?void 0:l[1],PreTag:tv,style:th.A,wrapLines:!0,wrapLongLines:!0}):(0,a.jsx)("code",{...i,children:s})},a:e=>{let{href:t,children:s}=e;return(0,a.jsx)("a",{href:t,rel:"noopener noreferrer",target:"_blank",children:s})},response:e=>{let{children:t}=e;return"string"==typeof t?(0,a.jsx)(tg,{children:t}):(Array.isArray(t),(0,a.jsx)("div",{children:t}))}},urlTransform:e=>{if(e.startsWith("data:image"))return e;if(e.startsWith("mnt://")||e.startsWith("attachment://")){let t=(0,c.A)(e.split("://"));return"/api/versions/".concat(t,".jpeg")}return(0,tc.Lv)(e)},children:i})})});function tf(e){var t,s,n,i;let{message:l,onSelect:r,onSubmit:c,onQuote:u,appId:p,isLoading:h,disabled:x=!1}=e,v=Object.entries(l.info.data.questions).flatMap(e=>{let[t,s]=e;return"otherMiscQuestions"===t?s:[{question:s.question,options:s.options,defaultOption:s.defaultOption}]}),g=null!==(n=l.info.interactionComplete)&&void 0!==n&&n,[f,j]=(0,m.useState)(""),[b,w]=(0,m.useState)(""),{toast:y}=(0,O.dj)(),N=q.F.useUtils(),k=J(e=>e.setQuote),A=J(e=>e.quote);(0,m.useEffect)(()=>{g||h||!A||w(A.diff)},[A,g,h]);let C=e=>{var t,s;k({source:"multipleChoice",diff:e,context:null!==(s=null===(t=v[0])||void 0===t?void 0:t.question)&&void 0!==s?s:""}),null==u||u(e)},S=e=>{h||g||("other"===e.toLowerCase()?C(e):(j(e),null==r||r(e),N.getAppChatMessages.setData({id:p},e=>e?{...e,messages:e.messages.map(e=>e.id===l.id&&"interactiveToolCall"===e.kind?{...e,info:{...e.info,interactionComplete:!0}}:e)}:e),E(e)))},E=e=>{h||g||I.mutate({toolCallId:l.info.toolCallId,response:{data:{choice:e},submitted:!0}})},I=q.F.respondToInteractiveToolCall.useMutation({onSuccess:async(e,t)=>{var s;N.getAppChatMessages.invalidate(),A||null==c||c({choice:t.response.data.choice,toolName:null!==(s=l.info.toolName)&&void 0!==s?s:""})},onError:e=>{y({title:"Failed to submit choice",description:e.message,variant:"destructive"})}});return(0,a.jsxs)(d.P.div,{animate:{opacity:1,y:0},className:"flex flex-col px-4 py-6 gap-6 bg-gradient-to-b from-background to-secondary/30 shadow-card border border-muted rounded-2xl max-w-md overflow-hidden",initial:{opacity:0,y:20},transition:{duration:.5},children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4 text-start",children:[(0,a.jsx)(tg,{className:"w-3/4 text-sm font-normal text-foreground",children:null!==(i=null===(t=v[0])||void 0===t?void 0:t.question)&&void 0!==i?i:""}),!f&&!h&&!g&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Select an option or quote it to add more details:"}),(!!h||g)&&(f||b)&&(0,a.jsx)("div",{className:"w-full h-auto bg-gradient-to-b from-secondary to-border/60 py-2 px-3 rounded-md shadow-button",children:(0,a.jsx)("h2",{className:"font-normal text-sm text-foreground",children:f||b})}),(f||!!h||g)&&(0,a.jsxs)("div",{className:"flex gap-2 justify-start items-center text-muted-foreground",children:[(0,a.jsx)(ts.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-xs",children:"Answer submitted"})]})]}),(0,a.jsx)(o.N,{mode:"wait",children:!f&&!h&&!g&&(0,a.jsx)(d.P.div,{animate:{opacity:1},className:"flex flex-col gap-6",exit:{opacity:0},initial:{opacity:0},children:(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3",children:null===(s=v[0])||void 0===s?void 0:s.options.map((e,t)=>(0,a.jsxs)("div",{className:"relative flex items-center w-full bg-secondary/40 rounded-md transition-all duration-300 transform hover:scale-[1.005] group",children:[(0,a.jsx)(O.$n,{className:"flex-grow bg-transparent text-sm font-normal text-left justify-start whitespace-normal ".concat(e===f?"bg-gradient-to-b from-secondary to-border/60 text-foreground":"bg-transparent hover:bg-secondary/70"),disabled:x,size:"lg",type:"button",variant:"ghost",onClick:()=>S(e),children:e}),!x&&(0,a.jsx)("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-fit h-fit flex items-center p-2",children:(0,a.jsx)(O.$n,{className:"bg-indigo-500 hover:bg-indigo-600 border border-indigo-400 dark:border-indigo-600 rounded-md shadow-button text-xs font-normal text-secondary dark:text-foreground hover:text-secondary hover:dark:text-foreground sm:scale-0 sm:group-hover:scale-100 transition-transform duration-200 origin-right",size:"xs",type:"button",variant:"primary",onClick:t=>{t.stopPropagation(),C(e)},children:"Quote"})})]},t))})},"questions")})]})}tg.displayName="Markdown";var tj=s(4974);function tb(e){var t;let{message:s,onSubmit:n}=e,i=J(e=>e.openAppEditor),l=s.info.data,[r,c]=(0,m.useState)(l.missingVariables.reduce((e,t)=>(e[t.key]="",e),{})),[p,h]=(0,m.useState)(!1),[x,v]=(0,m.useState)(!1),{toast:g}=(0,O.dj)(),f=q.F.useUtils(),j=null!==(t=s.info.interactionComplete)&&void 0!==t&&t,{data:b,refetch:w}=q.F.getInfraConfig.useQuery({versionId:s.info.versionId}),y=q.F.updateInfraConfig.useMutation(),N=q.F.respondToInteractiveToolCall.useMutation({onSuccess:async()=>{f.getAppChatMessages.invalidate()},onError:e=>{g({title:"Failed to submit environment variables",description:e.message,variant:"destructive"})}}),k=(0,u.useRouter)(),A=(0,u.usePathname)(),C=q.F.createNewVersion.useMutation({onError:e=>{g({title:"Failed to create new version",description:e.message,variant:"destructive"})}});(0,m.useEffect)(()=>{var e;(null==b?void 0:null===(e=b.infraConfig)||void 0===e?void 0:e.variables)&&c(e=>{var t,s;return{...e,...null!==(s=null==b?void 0:null===(t=b.infraConfig)||void 0===t?void 0:t.variables)&&void 0!==s?s:{}}})},[b]);let S=async()=>{if(!j){h(!0),v(!1);try{var e,t;let a={...null==b?void 0:b.infraConfig,variables:{...null!==(t=null==b?void 0:null===(e=b.infraConfig)||void 0===e?void 0:e.variables)&&void 0!==t?t:{},...r}};if(!b)throw Error("No infra config found");await y.mutateAsync({versionId:null==b?void 0:b.id,infraConfig:a}),await N.mutateAsync({toolCallId:s.info.toolCallId,response:{data:"The infra config has been updated. Here is the updated configuration:\n\n".concat(JSON.stringify(a,null,2)),submitted:!0}});let i=await C.mutateAsync({versionId:null==b?void 0:b.id,infraConfig:a,createForkOnBuildError:!0});k.push("".concat(A,"?_evid=").concat(i.id)),await n(r),await w(),g({title:"Environment variables set and new version created successfully!"}),v(!0)}catch(e){g({title:"Error setting environment variables and creating new version",description:e.message||"Something went wrong.",variant:"destructive"})}finally{h(!1)}}},E=Object.values(r).every(e=>""!==e.trim());return(0,a.jsx)(d.P.div,{animate:{opacity:1,y:0},className:"flex flex-col p-6 bg-gradient-to-b from-background to-secondary/30 shadow-card border border-muted rounded-2xl max-w-md mx-auto overflow-hidden",initial:{opacity:0,y:20},transition:{duration:.5},children:(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)(tg,{className:"text-sm font-medium text-foreground",children:"We need the following environment variables to get your app up and running:"}),(0,a.jsx)("div",{className:"space-y-6",children:l.missingVariables.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-semibold text-foreground",htmlFor:e.key,children:e.key}),(0,a.jsx)(O.pd,{disabled:j,id:e.key,placeholder:null!==(t=e.exampleValue)&&void 0!==t?t:"Enter value for ".concat(e.key),type:"text",value:r[e.key],onChange:t=>c(s=>({...s,[e.key]:t.target.value}))}),(0,a.jsx)(tg,{className:"text-xs text-muted-foreground mt-1",children:(0,eM.G6)(e.instructions)})]},e.key)})}),(0,a.jsxs)("div",{className:"flex justify-end items-center mt-4",children:[(0,a.jsx)(o.N,{children:!p&&!x&&!j&&(0,a.jsx)(d.P.div,{animate:{opacity:1},exit:{opacity:0},initial:{opacity:0},children:(0,a.jsx)(O.$n,{className:"px-6 py-2",disabled:!E,variant:"primary",onClick:S,children:"Save Variables"})})}),p&&(0,a.jsx)("div",{className:"flex items-center ml-2",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Saving..."})}),(x||j)&&!p&&(0,a.jsxs)(d.P.div,{animate:{opacity:1},className:"flex items-center space-x-4",initial:{opacity:0},children:[(0,a.jsxs)("div",{className:"flex items-center text-green-500",children:[(0,a.jsx)(tj.A,{className:"mr-2",size:20}),(0,a.jsx)("p",{className:"text-sm font-medium",children:"Variables Saved Successfully"})]}),(0,a.jsx)(O.$n,{className:"ml-4",size:"sm",variant:"outline",onClick:()=>i({versionId:null==b?void 0:b.id,tab:"infra"}),children:"Open App Editor"})]})]})]})})}var tw=s(18593),ty=s(70243),tN=s(71372);function tk(e){var t;let s;let{message:n,hideButtons:i}=e,[l,r]=(0,m.useState)(!1),{currentUser:o}=(0,eI.A)(),d=n.info.counts[eL.LogLevel.ERROR],c=n.info.counts[eL.LogLevel.WARN],u=n.info.counts[eL.LogLevel.INFO],p=q.F.getRuntimeLogs.useInfiniteQuery({versionId:n.info.versionId,firstLogCreatedAt:new Date(n.timestamp),lastLogCreatedAt:n.info.lastLogCreatedAt},{enabled:l||d>0,getNextPageParam:e=>e.nextCursor}),h=(0,m.useMemo)(()=>{var e,t;return null!==(t=null===(e=p.data)||void 0===e?void 0:e.pages.flatMap(e=>e.logs))&&void 0!==t?t:[]},[null===(t=p.data)||void 0===t?void 0:t.pages]);return d||c?(0,a.jsxs)("div",{className:"w-full space-y-2",children:[(0,a.jsxs)("div",{className:"h-7 flex items-center text-muted-foreground w-full",children:[c>0||d>0?(0,a.jsx)(ty.A,{className:"h-4 w-4 mr-1"}):(0,a.jsx)(tN.A,{className:"h-4 w-4 mr-1"}),(0,a.jsx)("span",{className:"text-sm flex-1 text-left",children:(d>0?d>5?"Found 5+ errors":"Found ".concat(d," ").concat((0,eM.td)("error",d)):c>0?c>99?"Had 99+ warnings":"Had ".concat(c," ").concat((0,eM.td)("warning",c)):u>99?"Logged 99+ traces":"Logged ".concat(u," ").concat((0,eM.td)("trace",u)))||"No logs available"}),!i&&(0,a.jsx)(O.$n,{size:"iconSm",variant:"ghost",onClick:()=>r(e=>!e),children:l?(0,a.jsx)(y.A,{className:"h-4 w-4"}):(0,a.jsx)(ef.A,{className:"h-4 w-4"})})]}),!i&&l&&(0,a.jsxs)("div",{className:"-mr-3.5 -ml-3.5",children:[(0,a.jsx)("div",{className:"overflow-auto max-h-40 min-h-20 bg-background/50 p-2",children:!h.length&&p.isLoading?(0,a.jsx)("div",{className:"flex justify-center items-center h-8",children:(0,a.jsx)(k.A,{className:"h-4 w-4 animate-spin"})}):h.length>0?h.map(e=>(0,a.jsxs)("pre",{className:(0,K.cn)("text-xs",e.level===eL.LogLevel.ERROR?"text-destructive/75":e.level===eL.LogLevel.WARN?"text-warning/75":"text-muted-foreground/75"),children:["[",(0,e4.Yq)(e.createdAt,null==o?void 0:o.timezone),"]"," ",e.level,": ",(0,tw.A)(e.message,{length:150})]},e.id)):(0,a.jsx)("p",{className:"text-muted-foreground/75",children:"No logs available."})}),p.hasNextPage&&(0,a.jsxs)(O.$n,{className:"w-full text-muted-foreground bg-background/50 !rounded-none",disabled:p.isFetchingNextPage,size:"sm",variant:"ghost",onClick:()=>p.fetchNextPage(),children:[p.isFetchingNextPage?(0,a.jsx)(k.A,{className:"h-4 w-4 mr-1 animate-spin"}):(0,a.jsx)(I.A,{className:"h-4 w-4 mr-1"}),"Load earlier logs"]})]})]}):null}var tA=s(23270),tC=s.n(tA),tS=s(43618),tE=s.n(tS),tI=s(79131),tL=s.n(tI),tM=s(86144),tR=s.n(tM),tF=s(8866),tz=s.n(tF),tP=s(55305),tD=s.n(tP),tT=s(66749);let tU=Object.keys(tl.zL).map(e=>({value:e,label:e.charAt(0).toUpperCase()+e.slice(1)})),tV={value:"neutral",label:"Neutral"},tO={value:"inter",label:"Inter",className:tC().className,name:"Inter"},tH=[{value:"inter",label:"Modern",className:tC().className,name:"Inter"},{value:"archivo",label:"Bold",className:tE().className,name:"Archivo"},{value:"dmSans",label:"Friendly",className:tL().className,name:"DM Sans"},{value:"spaceMono",label:"Techy",className:tR().className,name:"Space Mono"},{value:"lora",label:"Graceful",className:tz().className,name:"Lora"},{value:"bricolage",label:"Playful",className:tD().className,name:"Bricolage Grotesque"}],t_={inter:"\n    @font-face {\n      font-family: 'Inter';\n      font-style: normal;\n      font-weight: 100 900;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-inter.ttf);\n    }\n  ",archivo:"\n    @font-face {\n      font-family: 'Archivo';\n      font-style: normal;\n      font-weight: 100 900;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-archivo.ttf);\n    }\n  ",dmSans:"\n    @font-face {\n      font-family: 'DM Sans';\n      font-style: normal;\n      font-weight: 400 700;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-dmsans.ttf);\n    }\n  ",spaceMono:"\n    @font-face {\n      font-family: 'Space Mono';\n      font-style: normal;\n      font-weight: 400;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-spacemono.ttf);\n    }\n    @font-face {\n      font-family: 'Space Mono';\n      font-style: normal;\n      font-weight: 700;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-spacemono-bold.ttf);\n    }\n  ",lora:"\n    @font-face {\n      font-family: 'Lora';\n      font-style: normal;\n      font-weight: 400 700;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-lora.ttf);\n    }\n  ",bricolage:"\n    @font-face {\n      font-family: 'Bricolage Grotesque';\n      font-style: normal;\n      font-weight: 200 800;\n      font-display: swap;\n      src: url(https://static.acflare.com/font-bricolage.ttf);\n    }\n  "},t$={hidden:{opacity:0,y:10},visible:{opacity:1,y:0}};function tB(e){var t;let{versionId:s,message:n,onDismiss:i}=e,l="theme_selection_".concat(n.id),[r,o]=(0,m.useState)(()=>{var e;{let t=localStorage.getItem("".concat(l,"_theme"));return t?JSON.parse(t):null!==(e=tU[0])&&void 0!==e?e:tV}}),[c,u]=(0,m.useState)(()=>{var e;{let t=localStorage.getItem("".concat(l,"_font"));return t?JSON.parse(t):null!==(e=tH[0])&&void 0!==e?e:tO}}),[p,h]=(0,m.useState)(!1),{toast:x}=(0,O.dj)(),v=q.F.useUtils(),[g,f]=(0,m.useState)(null!==(t=n.info.interactionComplete)&&void 0!==t&&t),[j,b]=(0,m.useState)(!1);(0,m.useEffect)(()=>{localStorage.setItem("".concat(l,"_theme"),JSON.stringify(r)),localStorage.setItem("".concat(l,"_font"),JSON.stringify(c))},[r,c,l]);let w=q.F.createNewVersion.useMutation({onError:e=>{x({title:"Failed to save",description:e.message})}}),{mutate:y}=q.F.respondToInteractiveToolCall.useMutation({onSuccess:()=>{v.getAppChatMessages.invalidate(),h(!1),f(!0)},onError:e=>{h(!1),x({title:"Failed to apply theme",description:e.message,variant:"destructive"})}}),N="theme-".concat(r.value);return j?null:(0,a.jsx)(d.P.div,{animate:"visible",className:"".concat(N," ").concat(c.className),initial:"hidden",transition:{duration:.3,ease:"easeOut"},variants:t$,children:(0,a.jsx)(tT.Zp,{className:"flex flex-col w-full md:w-fit md:max-w-sm p-4 gap-4 bg-gradient-to-t from-background to-secondary/30 shadow-card",children:g?(0,a.jsxs)(tT.Wu,{className:"flex flex-col gap-4 p-0",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h3",{className:"text-base font-semibold text-foreground",children:"New look applied"}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground",children:[(0,a.jsx)(ts.A,{className:"w-4 h-4 text-green-500"}),(0,a.jsx)("span",{className:"text-sm",children:"Theme has been updated successfully."})]})]}),(0,a.jsx)("div",{className:"flex flex-col gap-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"theme-".concat(r.value),children:(0,a.jsxs)("button",{"aria-label":"".concat(r.label," theme"),className:"flex w-fit items-center gap-2 px-2 py-1 bg-secondary/60 rounded-sm border border-primary",disabled:!0,type:"button",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary"}),(0,a.jsx)("span",{className:"text-xs font-medium text-foreground",children:r.label})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-2",children:(0,a.jsx)("button",{className:"flex w-fit px-2 py-1 bg-secondary/60 rounded-sm",disabled:!0,type:"button",children:(0,a.jsx)("span",{className:"".concat(c.className," text-xs font-medium text-foreground"),children:c.label})})})]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(tT.aR,{className:"p-0 ",children:[(0,a.jsx)(tT.ZB,{className:"text-base font-semibold text-foreground",children:"Customize"}),(0,a.jsx)(tT.BT,{className:"text-xs text-muted-foreground",children:"Choose your app's visual style. Seamlessly adapts to light and dark modes."})]}),(0,a.jsxs)(tT.Wu,{className:"flex flex-col gap-4 p-0",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)("h3",{className:"text-xs font-normal text-foreground",children:"Pick a theme:"}),(0,a.jsx)("div",{className:"inline-flex flex-wrap gap-2 justify-start",children:tU.map(e=>(0,a.jsx)("div",{className:"theme-".concat(e.value),children:(0,a.jsxs)("button",{"aria-label":"Select ".concat(e.label," theme"),className:"flex w-fit items-center gap-2 px-2 py-1 bg-secondary/60 rounded-sm border border-border transition-all ".concat(r.value===e.value?"border-primary":"border-input hover:border-primary"),type:"button",onClick:()=>o(e),children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary"}),(0,a.jsx)("span",{className:"text-xs font-medium text-foreground",children:"Aa"})]})},e.value))})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)("h3",{className:"text-xs font-normal text-foreground",children:"And a font:"}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:tH.map(e=>(0,a.jsx)(e1.$,{className:"py-1 px-2 w-full bg-secondary text-foreground rounded border cursor-pointer ".concat(c.value===e.value?"border-primary":"border-muted"),size:"sm",type:"button",variant:"secondary",onClick:()=>u(e),children:(0,a.jsx)("span",{className:"".concat(e.className," text-xs"),children:e.label})},e.value))})]})]}),(0,a.jsxs)(tT.wL,{className:"flex justify-end gap-2 p-0 pt-4",children:[(0,a.jsx)(e1.$,{size:"sm",type:"button",variant:"ghost",onClick:()=>{b(!0),i()},children:"Dismiss"}),(0,a.jsx)(e1.$,{className:"flex gap-1 bg-primary text-primary-foreground shadow-button",disabled:p,size:"sm",type:"button",onClick:()=>{let e=tl.zL[r.value],t=t_[c.value],a="\n".concat(e,"\n\n@layer base {\n  ").concat(t,"\n\n  :root {\n    font-family: '").concat(c.name,"', sans-serif !important;\n  }\n}\n    ");h(!0),w.mutate({versionId:s,frontendThemeCss:a,createForkOnBuildError:!0},{onSuccess:()=>{y({toolCallId:n.info.toolCallId,response:{data:{themeApplied:!0},submitted:!0}})},onError:e=>{h(!1),x({title:"Failed to apply theme",description:e.message,variant:"destructive"})}})},children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L.A,{className:"animate-spin h-3 w-3"}),"Applying..."]}):"Apply Theme"})]})]})})})}var tW=s(86644),tJ=s(37260),tQ=s(99092),tG=s(1612);function tq(e){let{message:t,app:s,hideButtons:n,isVerbose:i=!1}=e,[r,o]=(0,m.useState)(null),d=J(e=>e.openAppEditor),c=q.F.useUtils(),{toast:u}=(0,O.dj)(),p=q.F.publishAppVersion.useMutation({onError:e=>{u({title:"Could not publish",description:e.message,variant:"destructive"})},onSuccess:e=>{let s=(0,eP.MJ)(e.subdomain).replace(/https?:\/\//,""),n=(0,eP.MJ)(e.subdomain);l()(n),u({title:"Version ".concat(t.version.rev," published"),description:(0,a.jsxs)("div",{children:["The public link (",s,") now points to version"," ",t.version.rev,".",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Link copied to clipboard!"})]})}),c.getAppById.invalidate(),c.getAppChatMessages.invalidate()}}),{currentVersionId:h,switchVersion:x}=ez(),v=q.F.revertApp.useMutation({onSuccess:e=>{u({title:"Reverted to version from ".concat((0,e4.Pp)(e.createdAt))}),c.getAppById.invalidate(),c.getAppChatMessages.invalidate(),x({versionId:e.id,replace:!0,kind:"manual",clearLock:!0})},onError:e=>{let t=(0,Y.CK)(e);if(t){var s;let e=null===(s=t.info)||void 0===s?void 0:s.versionId;u({title:"Could not revert",description:t.message,variant:"destructive",action:e?(0,a.jsx)(O.Qg,{altText:"dismiss",onClick:()=>v.mutate({versionId:e,force:!0}),children:"Force"}):void 0})}else u({title:"Could not revert",description:e.message,variant:"destructive"})}}),g=q.F.setAppVersionPath.useMutation({onSuccess:e=>{let s=t.version.siblings.findIndex(t=>t.id===e.latestVersionId)+1;u({title:"Now viewing latest from version ".concat(t.version.rev,"'s ").concat((0,eM.hS)(s)," branch of ").concat(t.version.siblings.length)}),x({versionId:e.latestVersionId,kind:"manual"}),c.getAppById.invalidate(),c.getAppChatMessages.invalidate()}});(0,m.useEffect)(()=>{r&&h===r&&(setTimeout(()=>{u({title:"Now viewing version from ".concat((0,e4.Pp)(new Date(t.timestamp)))})},500),o(null))},[h,r,t.timestamp,u]);let f=!!(null==s?void 0:s.madeUnlistedAt),j=(null==s?void 0:s.publishedVersionId)===t.version.id,b=h===t.version.id,w=q.F.remixApp.useMutation({onSuccess:e=>{let t=(0,eP.MJ)(e.subdomain);u({title:"Cloned version",description:(0,a.jsx)("div",{className:"cursor-pointer hover:underline",onClick:()=>window.open(t,"_blank"),children:"Click to open new app"})}),c.getAppById.invalidate(),window.open(t,"_blank")},onError:e=>{u({title:"Encountered error while cloning",description:e.message,variant:"destructive"})}});return"version"!==t.kind?null:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsxs)("div",{className:"h-7 flex items-center justify-between text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center text-sm",children:[(0,a.jsx)(D.A,{className:"h-4 w-4 mr-1"}),(0,a.jsxs)("span",{children:["Saved version ",t.version.rev]})]}),f&&j?(0,a.jsx)(O.Ex,{className:"cursor-default border-background",variant:"outline",children:"Published"}):null]}),(0,a.jsx)("div",{className:"flex-1"}),!n&&t.version.siblings.length>1&&(0,a.jsxs)(O.$n,{disabled:g.isLoading,size:"sm",type:"button",variant:"ghost",onClick:()=>{var e;let a=(t.version.siblings.findIndex(e=>e.id===t.version.id)+1)%t.version.siblings.length;g.mutate({appId:s.id,versionId:null===(e=t.version.siblings[a])||void 0===e?void 0:e.id})},children:[(0,a.jsx)(tW.A,{className:"h-4 w-4 mr-1 transform rotate-180"}),t.version.siblings.findIndex(e=>e.id===t.version.id)+1," ","/ ",t.version.siblings.length]}),!n&&(0,a.jsxs)(O.rI,{children:[(0,a.jsx)(O.ty,{asChild:!0,children:(0,a.jsx)(O.$n,{size:"iconSm",type:"button",variant:"ghost",children:(0,a.jsx)(tJ.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(O.SQ,{align:"end",children:[(0,a.jsxs)(O._2,{disabled:!f||j,onSelect:()=>{p.mutate({id:null==s?void 0:s.id,versionId:t.version.id})},children:[(0,a.jsx)(ex.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Publish version"})]}),(0,a.jsxs)(O._2,{disabled:b,onSelect:()=>{x({versionId:t.version.id,kind:"manual"}),c.getAppById.invalidate({id:null==s?void 0:s.id})},children:[(0,a.jsx)(tQ.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Switch to version"})]}),(0,a.jsxs)(O._2,{onSelect:()=>{d({versionId:t.version.id,tab:"App.tsx"})},children:[(0,a.jsx)(tG.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"View code"})]}),(0,a.jsx)(O._2,{disabled:w.isLoading,onSelect:e=>{e.preventDefault(),w.mutate({id:s.id,versionId:t.version.id})},children:w.isLoading?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(k.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,a.jsx)("span",{children:"Cloning..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e0.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Clone"})]})}),(0,a.jsxs)(O._2,{disabled:s.latestVersionId===t.version.id,onSelect:()=>{window.confirm("Are you sure you want to undo everything after this message? You can not undo this.")&&(u({title:"Reverting to previous version..."}),v.mutate({versionId:t.version.id}))},children:[(0,a.jsx)(eV.A,{className:"mr-2 h-4 w-4"}),(0,a.jsx)("span",{children:"Revert"})]})]})]})]}),i&&t.version.versionChangesSummary&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground pl-6 pb-1",children:t.version.versionChangesSummary})]})}var tY=s(82075),tK=s(24833);function tZ(e){var t,s,n;let{message:i,app:r,isLoading:o,isLast:d,hideButtons:c,isVerbose:p,handleChatSubmit:h,focusChatTextarea:x,className:v}=e,{toast:g}=(0,et.dj)(),f=q.F.useUtils(),j=(0,u.usePathname)(),{switchVersion:w}=ez(),[y,N]=(0,m.useState)(null),[A,C]=(0,m.useState)([]),[S,E]=(0,m.useState)(!1),[I,L]=(0,m.useState)(!1),M=(0,m.useRef)(null),R="ontouchstart"in window||navigator.maxTouchPoints>0;(0,m.useEffect)(()=>{if(I&&R)return document.addEventListener("touchstart",e),()=>document.removeEventListener("touchstart",e);function e(e){M.current&&!M.current.contains(e.target)&&L(!1)}},[I,R]);let F=q.F.revertApp.useMutation({onSuccess:e=>{g({title:"Reverted to version from ".concat((0,e4.Pp)(e.createdAt))}),f.getAppById.invalidate(),f.getAppChatMessages.invalidate(),w({versionId:e.id,replace:!0,kind:"manual",clearLock:!0})},onError:e=>{let t=(0,Y.CK)(e);if(t){var s;let e=null===(s=t.info)||void 0===s?void 0:s.versionId;g({title:"Could not revert",description:t.message,variant:"destructive",action:e?(0,a.jsx)(O.Qg,{altText:"dismiss",onClick:()=>F.mutate({versionId:e,force:!0}),children:"Force"}):void 0})}else g({title:"Could not revert",description:e.message,variant:"destructive"})}}),z=(0,m.useCallback)(()=>{h({chatInput:"The user has dismissed the theme selection tool. Please continue with the next task or ask for further instructions not related to theme selection.",isHidden:!0})},[h]);(0,m.useEffect)(()=>{if(y&&0===A.length){var e,t;let s=(0,te.A)(tY._.NEXT_PUBLIC_CDN_URL),a=/!\[.*?\]\((data:image\/[a-zA-Z]+;base64,[a-zA-Z0-9+/=]+)\)/g,n=RegExp("".concat(s,"/[a-zA-Z0-9_-]+(?:\\.[a-zA-Z0-9]+)?"),"g"),i=null!==(e=y.match(a))&&void 0!==e?e:[],l=null!==(t=y.match(n))&&void 0!==t?t:[];(i.length>0||l.length>0)&&(C([...i,...l]),N(y.replace(a,"").replace(n,"").trim()))}},[y,A]);let{currentUser:P}=(0,eI.A)();if(!(0,b.A)(y)&&"message"==i.kind)return(0,a.jsxs)("div",{className:v,children:[(0,a.jsxs)("div",{className:"max-w-100 flex flex-1 flex-col gap-2",children:[(0,a.jsx)("div",{className:"h-0 invisible",children:"-".repeat(1e3)}),(0,a.jsx)(O.TM,{autoFocus:!0,placeholder:"Your new message...",value:y,onChange:e=>N(e.target.value)}),(0,a.jsxs)("div",{className:"max-w-full flex flex-row justify-end items-center gap-1 text-muted-foreground text-xs",children:[(0,a.jsx)(O.$n,{size:"sm",type:"button",variant:"ghost",onClick:()=>{N(null)},children:"Cancel"}),(0,a.jsx)(O.$n,{size:"sm",type:"button",variant:"ghost",onClick:async()=>{N(null);let e=A.map(e=>{let t=e.match(/!\[.*?\]\((data:image\/[a-zA-Z]+;base64,[a-zA-Z0-9+/=]+)\)/);return t?t[1]:null}).filter(Boolean),t=A.filter(e=>!eK(e)),s=e.map(e=>({type:"image_url",image_url:{url:e}}));s.push(...t.map(e=>({type:"text",text:e})));let a=[{type:"text",text:y},...s],n="temp-"+Date.now();f.getAppChatMessages.setData({id:null==r?void 0:r.id},e=>{if(!e)return e;let t=e.messages.filter(e=>e.id!==i.id);return t.push({id:n,kind:"message",timestamp:Date.now(),userId:null==P?void 0:P.id,message:{id:n,role:eL.MessageRole.USER,content:a,thread:"AppDeveloperAgent",createdAt:new Date}}),{...e,messages:t.sort((e,t)=>(e.timestamp||0)-(t.timestamp||0))}});try{await F.mutateAsync({messageId:i.id}),await h({chatInput:y,context:{pathname:j,screenshots:e.filter(e=>"string"==typeof e)}})}catch(e){console.error("Error in update:",e),g({title:"Error updating message",description:"Please try again",variant:"destructive"}),await f.getAppChatMessages.invalidate({id:null==r?void 0:r.id})}},children:"Send"})]})]}),A.length>0&&(0,a.jsx)(tg,{children:A.join("\n\n")})]});if("status"==i.kind&&("tool"==i.status.kind||"message"==i.status.kind)){let e="tool"==i.status.kind?i.status.status:i.status.content;return(0,a.jsx)("div",{className:v,children:(0,a.jsxs)("div",{className:"flex flex-row h-7 items-center gap-1 text-sm ".concat(i.status.content?"cursor-pointer hover:text-primary":""),children:[d&&o?(0,a.jsx)(e3.iN,{className:"h-4 w-4 shrink-0"}):(0,a.jsx)(ts.A,{className:"h-4 w-4 shrink-0"}),(0,a.jsx)("div",{className:"flex-1 truncate text-muted-foreground ".concat(o&&d?"shimmer-text":""),children:e}),(0,a.jsx)("div",{className:"flex-shrink-0 w-[2rem]"})]})})}if("status"==i.kind&&"error"==i.status.kind)return(0,a.jsx)("div",{className:v,children:(0,a.jsx)(tr,{app:r,message:i})});if("interactiveToolCall"==i.kind){if(i.info.componentName===(0,tK.yT)("ThemeSelectionCard"))return(0,a.jsx)(tB,{message:i,versionId:i.info.versionId,onDismiss:z},i.id);if(i.info.componentName==(0,tK.yT)("MultipleChoiceCard"))return(0,a.jsxs)("div",{className:v,children:[(0,a.jsx)(tg,{children:null!==(t=i.info.message)&&void 0!==t?t:""}),(0,a.jsx)(tf,{appId:null!==(s=null==r?void 0:r.id)&&void 0!==s?s:"",disabled:!d,isLoading:o,message:i,onQuote:x,onSubmit:async e=>{let{choice:t}=e;await h({chatInput:"I've submitted my answer: ".concat(t,".").trim(),isHidden:!0})}})]});if(i.info.componentName==(0,tK.yT)("RequestEnvironmentVariables"))return(0,a.jsx)("div",{className:v,children:(0,a.jsx)(tb,{message:i,onSubmit:async()=>{await h({chatInput:"If there are remaining tasks (e.g. errors to be fixed), continue. Otherwise, request further instructions from the user.",isHidden:!0})}})})}else if("dbCommitLog"==i.kind)return(0,a.jsx)("div",{className:v,children:(0,a.jsx)(ti,{message:i})});else if("runtimeLog"==i.kind){let e=i.info.counts[eL.LogLevel.ERROR]>0,t=i.info.counts[eL.LogLevel.WARN]>0;if(!e&&!t)return null;let s=(0,a.jsx)(tk,{hideButtons:c,message:i});return s&&(0,a.jsx)("div",{className:v,children:s})}else if("version"==i.kind)return r?(0,a.jsx)("div",{className:v,children:(0,a.jsx)(tq,{app:r,hideButtons:c,isVerbose:p,message:i})}):null;else if("messageSummary"==i.kind&&(0,tt.A)(i.message.content))return(0,a.jsx)("div",{className:v,children:(0,a.jsxs)("div",{className:"flex flex-row h-7 items-center gap-1 text-muted-foreground text-sm",children:[d&&o?(0,a.jsx)(k.A,{className:"animate-spin h-4 w-4 shrink-0"}):(0,a.jsx)(ts.A,{className:"h-4 w-4 shrink-0"}),(0,a.jsx)("div",{className:"flex-1 truncate",children:i.message.content}),(0,a.jsx)("div",{className:"flex-shrink-0 w-[2rem]"})]})});else if("message"==i.kind){let e=(0,tt.A)(i.message.content)?i.message.content:null===(n=i.message.content)||void 0===n?void 0:n.map((e,t)=>{var s,a;return(0,tt.A)(e)||"text"==e.type?(0,tt.A)(e)?e:e.text:"image_url"==e.type?"![Image ".concat(t+1,"](").concat(null===(s=e.image_url)||void 0===s?void 0:s.url,")"):"pdf_url"==e.type?"![PDF ".concat(t+1,"](").concat(null===(a=e.pdf_url)||void 0===a?void 0:a.url,")"):JSON.stringify(e,null,2)}).join("\n\n");return e?(e.includes(tl.yK)&&(e=e.replace(tl.yK,"").trim()),e&&(0,a.jsxs)("div",{className:"group ".concat(v),children:[(0,a.jsx)("div",{"aria-label":"Message bubble",className:i.message.role===eL.MessageRole.USER?"px-5 py-2.5 w-auto gap-1 bg-muted rounded-l-3xl rounded-br-3xl rounded-tr-lg":"w-auto",tabIndex:0,onClick:R&&i.message.role===eL.MessageRole.USER&&!i.queued?e=>{e.stopPropagation(),L(e=>!e)}:void 0,children:(0,a.jsx)("div",{className:"relative overflow-hidden w-auto inline-block align-baseline",children:(0,a.jsx)(tg,{children:e.replace(RegExp("<(system-note|context)>.*?<\\/\\1>","gs"),"").trim()})})}),i.message.role===eL.MessageRole.USER&&!i.queued&&(0,a.jsx)(O.Bc,{children:(0,a.jsxs)("div",{className:["flex flex-row justify-end items-center px-2 text-muted-foreground text-xs transition-opacity duration-200",R?I?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none":"opacity-0 pointer-events-none group-hover:opacity-100 group-focus-within:opacity-100 group-hover:pointer-events-auto group-focus-within:pointer-events-auto"].join(" "),ref:M,children:[(0,a.jsx)(eJ,{content:"Edit message",children:(0,a.jsx)(O.$n,{size:"sm",type:"button",variant:"ghost",onClick:()=>{N(e.replace(RegExp("<(system-note|context)>.*?<\\/\\1>","gs"),"").trim()),C([])},children:(0,a.jsx)(ta.A,{className:"h-3.5 w-3.5"})})}),(0,a.jsx)(eJ,{content:"Undo sending message",children:(0,a.jsx)(O.$n,{disabled:F.isLoading,size:"sm",type:"button",variant:"ghost",onClick:()=>{window.confirm("Are you sure you want to undo everything after this message? You can not undo this.")&&F.mutate({messageId:i.id})},children:F.isLoading?(0,a.jsx)(k.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(eV.A,{className:"h-4 w-4"})})}),(0,a.jsx)(eJ,{content:S?"Copied!":"Copy message",children:(0,a.jsx)(O.$n,{size:"sm",type:"button",variant:"ghost",onClick:()=>{l()(e.replace(RegExp("<(system-note|context)>.*?<\\/\\1>","gs"),"").trim()),E(!0),setTimeout(()=>E(!1),2e3)},children:S?(0,a.jsx)(eO.A,{className:"h-3.5 w-3.5"}):(0,a.jsx)(eg.A,{className:"h-3.5 w-3.5"})})}),(0,a.jsx)(eJ,{content:"Sent ".concat(i.message.createdAt?i.message.createdAt.toLocaleString():"Sending..."),children:(0,a.jsx)("span",{className:"py-1 select-none",children:i.timestamp?(0,e4.Pp)(new Date(i.timestamp)):"Sending..."})})]})}),i.queued&&!i.message.isHidden&&(0,a.jsx)("div",{className:"text-muted-foreground text-xs text-right",children:"Queued..."})]})):null}return null}function tX(e){let{onClick:t,onMinimize:s,onUnminimize:n,className:i,barClassName:l,disabled:r}=e;return(0,a.jsx)("div",{className:(0,K.cn)("flex justify-center items-center w-full group cursor-pointer","pt-4 pb-2",r&&"cursor-default",i),onClick:e=>{r||e.target!==e.currentTarget&&e.target!==e.currentTarget.firstChild||(null==t||t(e),e.currentTarget.closest("[data-chat-minimized]")?null==n||n():null==s||s())},children:(0,a.jsx)("div",{className:(0,K.cn)("w-16 h-1 bg-secondary rounded-full transition-all duration-300",!r&&"group-hover:scale-x-90 group-hover:translate-y-0.5",l)})})}var t0=s(50405),t1=s(90720);let t2={multipleChoice:function(e){let{quotedText:t,setQuote:s}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-1 p-4 max-w-full max-h-fit bg-transparent border-b border-border/60",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)("div",{className:"w-1 shrink-0 self-stretch rounded-full bg-gray-300"}),(0,a.jsx)("div",{className:"flex-1 text-sm text-foreground/80 mask-animation whitespace-pre-wrap line-clamp-2",title:t.diff,children:t.diff})]}),(0,a.jsx)(t1.Bc,{children:(0,a.jsxs)(t1.m_,{children:[(0,a.jsx)(t1.k$,{asChild:!0,children:(0,a.jsx)(O.$n,{className:"text-muted-foreground p-[0.1875rem]",size:"iconSm",variant:"ghost",onClick:()=>s(null),children:(0,a.jsx)(t0.A,{className:"h-4 w-4"})})}),(0,a.jsx)(t1.ZI,{align:"center",className:"text-xs",side:"left",children:(0,a.jsx)("p",{children:"Dismiss Quote"})})]})})]})})}};function t4(e){let{quotedText:t,setQuote:s}=e,n=t2[t.source];return n?(0,a.jsx)(n,{quotedText:t,setQuote:s}):null}var t5=s(8808);function t3(e){let{results:t,onResultNavigate:s,onResultSelect:n,focusedIndex:i,rowsIcon:l,title:r,disable:o}=e,[d,c]=(0,m.useState)(null!=i?i:-1),u=(0,m.useRef)([]),p=null!=i?i:d;return((0,m.useEffect)(()=>{if(p>=0&&u.current[p]){var e;null===(e=u.current[p])||void 0===e||e.scrollIntoView({behavior:"smooth",block:"nearest"})}},[p]),(0,m.useEffect)(()=>{c(0),u.current=u.current.slice(0,t.length)},[t]),t.length)?(0,a.jsxs)("div",{className:"flex flex-col p-2 pb-0",tabIndex:-1,onKeyDown:e=>{if("ArrowDown"===e.key){e.preventDefault();let a=Math.min(p+1,t.length-1);c(a),null==s||s(a)}else if("ArrowUp"===e.key){e.preventDefault();let t=Math.max(p-1,0);c(t),null==s||s(t)}},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between pl-2 pb-1",children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:null!=r?r:"Search Results"}),o&&(0,a.jsx)(e1.$,{"aria-label":"Close search",className:"h-7 !rounded-xl",size:"xs",variant:"outline",onClick:()=>o(),children:"esc"})]}),t.map((e,t)=>{var i;return(0,a.jsxs)("div",{className:"group flex items-center gap-2 sm:gap-3 p-2 rounded-2xl transition-colors cursor-pointer ".concat(p===t?"bg-accent/80":""),ref:e=>{u.current[t]=e},tabIndex:0,onClick:()=>{null==n||n(e)},onKeyDown:t=>{"Enter"===t.key&&(null==n||n(e))},onMouseEnter:()=>{c(t),null==s||s(t)},children:[(0,a.jsx)("div",{className:"h-10 w-10 shrink-0 rounded-xl border bg-card overflow-hidden",children:e.iconUrl?(0,a.jsx)(t5.z,{app:{id:e.id,iconUrl:e.iconUrl},className:"w-full h-full"}):(0,a.jsx)("div",{className:"h-full w-full bg-secondary"})}),(0,a.jsxs)("div",{className:"flex flex-col min-w-0 flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,a.jsx)("h3",{className:"text-sm truncate min-w-0 flex-1",children:null!==(i=e.displayName)&&void 0!==i?i:e.name}),e.forkedFromId&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground shrink-0",children:"(fork)"})]}),e.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:e.description})]}),(0,a.jsx)("div",{className:"flex items-center gap-2 opacity-80",children:p===t&&l})]},e.id)})]}):null}let t6=e=>{let{title:t,description:s,actionLabel:n="Upgrade",onAction:i,icon:l=(0,a.jsx)(C.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),className:r,containerClassName:o}=e;return(0,a.jsx)("div",{className:(0,K.cn)("flex gap-2",o),children:(0,a.jsxs)("div",{className:(0,K.cn)("flex items-center px-3 py-2 gap-2 bg-secondary/80 backdrop-blur-xl border rounded-lg sm:rounded-2xl w-full",r),children:[(0,a.jsx)("div",{className:"flex flex-grow text-xs",children:(0,a.jsxs)("div",{className:"text-xs",children:[(0,a.jsx)("span",{className:"font-medium",children:t}),s&&(0,a.jsxs)(a.Fragment,{children:[" ",s]})]})}),i&&(0,a.jsxs)(O.$n,{size:"sm",variant:"outline",onClick:i,children:[l,n]})]})})};function t8(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";return e?new Promise(a=>{let n;n=t=>{t.source===e&&(a(t.data),window.removeEventListener("message",n,!1))},window.addEventListener("message",n,!1),e.postMessage(t,s)}):Promise.reject(Error("targetWindow is not defined"))}async function t9(e,t){if(!t)throw Error("No upload url");async function s(e){return new Promise(t=>{let s=new FileReader;s.addEventListener("load",()=>{t(s.result)}),s.readAsArrayBuffer(e)})}return(await fetch(t,{method:"PUT",body:await s(e)})).ok}function t7(e){let t=q.F.generateUploadUrl.useMutation(),[s,a]=(0,m.useState)(!1);return{uploadFile:(0,m.useCallback)(async function(s){let n=s.name;a(!0),(null==e?void 0:e.appId)||console.warn("No appId, using base cdn path");let i=await t.mutateAsync({appId:null==e?void 0:e.appId,fileName:n,size:s.size}),l=i.publicUrl,r=i.uploadUrl,o=i.fileName;if(!r||!l||!n||!o)throw Error("Failed to get signed url");let d=await t9(s,r);if(a(!1),!d)throw Error("Failed to upload");return l},[t,null==e?void 0:e.appId]),isLoading:s}}let se=e=>e.toLowerCase().replace(/[^a-z0-9]/g,""),st=e=>{let{form:t,searchableApps:s,chatInputRef:a}=e,[n,i]=(0,m.useState)(!1),[l,r]=(0,m.useState)(""),[o,d]=(0,m.useState)(-1),c=(0,m.useMemo)(()=>s.map(e=>{var t,s,a,n,i,l,r,o;return{id:e.id,name:se(null!==(s=null!==(t=e.displayName)&&void 0!==t?t:e.name)&&void 0!==s?s:""),displayName:null!==(n=null!==(a=e.displayName)&&void 0!==a?a:e.name)&&void 0!==n?n:"",iconUrl:null!==(i=e.iconUrl)&&void 0!==i?i:"",description:null!==(l=e.description)&&void 0!==l?l:"",subdomain:null!==(r=e.subdomain)&&void 0!==r?r:"",forkedFromId:null!==(o=e.forkedFromId)&&void 0!==o?o:""}}).filter(e=>{var t;let s=l.toLowerCase().trim(),a=(null===(t=e.displayName)||void 0===t?void 0:t.toLowerCase())||"",n=e.name.toLowerCase();return a.includes(s)||n.includes(s)}).slice(0,3),[s,l]);(0,m.useLayoutEffect)(()=>{n&&c.length>0&&d(c.length-1)},[n,c]);let u=(0,m.useCallback)(e=>{if(!a)return;let s=a.selectionStart,n=a.value.substring(0,s-l.length-1),r=a.value.substring(s),o=se(e.name),d="".concat(n,"@").concat(o," ").concat(r);t.setValue("chatInput",d),i(!1),setTimeout(()=>{if(a){let e=n.length+"@".concat(o," ").length;a.selectionStart=e,a.selectionEnd=e}},0)},[t,l,a]),p=(0,m.useCallback)(e=>{var s,a;let l=null!==(s=e.target.value)&&void 0!==s?s:"",o=null!==(a=e.target.selectionStart)&&void 0!==a?a:0,u=t.getValues("chatInput");t.setValue("chatInput",l);let m=l.substring(0,o),p=m.lastIndexOf("@");if(u.length>l.length&&o>0&&/\s/.test(l.charAt(o-1))){i(!1);return}p>=0&&(0===p||p>0&&/\s/.test(m.charAt(p-1)))&&!m.substring(p).match(/^@[\w\s]+\s{2}/)?(n||(i(!0),d(c.length-1)),r(m.substring(p+1))):n&&i(!1)},[t,n,c]),h=(0,m.useCallback)(()=>{if(a){let e=t.getValues("chatInput")||"",s=e.length>0&&("string"!=typeof e||!e.endsWith(" ")),n=e+(s?" @":"@");t.setValue("chatInput",n),setTimeout(()=>{a&&(a.focus(),a.selectionStart=n.length,a.selectionEnd=n.length,i(!0),r(""))},0)}},[t,a]),x=(0,m.useCallback)((e,s,a,l,r)=>{if(n&&"Escape"===e.key){e.preventDefault(),i(!1),d(0);return}if(c&&c.length>0&&n){if("ArrowDown"===e.key){e.preventDefault(),d(e=>Math.min(e+1,c.length-1));return}if("ArrowUp"===e.key){e.preventDefault(),d(e=>-1===e?c.length-1:Math.max(e-1,0));return}if("Enter"===e.key&&o>=0){e.preventDefault(),n&&(null==c?void 0:c[o])&&u(null==c?void 0:c[o]);return}}"Enter"===e.key&&!e.shiftKey&&s?(t.handleSubmit(l)(),r("default"),e.preventDefault()):s||(a(!0),setTimeout(()=>a(!1),500),e.preventDefault())},[c,t,u,n,o]);return{showMentionMenu:n,mentionQuery:l,searchFocusedIndex:o,filteredSuggestions:c,handleMentionSelect:u,handleChatInputChange:p,onTagApps:h,handleKeyDown:x,setSearchFocusedIndex:d,closeMentionMenu:()=>{i(!1),d(0)}}},ss=e=>{let t=(0,H.al)(),[s,a]=(0,m.useState)(!1),[n,i]=(0,m.useState)(0);return{isDragging:s,dragDistance:n,handleTouchStart:(0,m.useCallback)(s=>{if(!t)return;let n=s.touches[0];if(!n)return;let l=n.pageY,r=l,o=e=>{let t=e.touches[0];if(!t)return;let s=t.pageY-l;r=t.pageY,s>0&&(i(s),a(!0))},d=()=>{let t=r-l;a(!1),i(0),t>50&&e(),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",d)};document.addEventListener("touchmove",o),document.addEventListener("touchend",d)},[t,e])}},sa=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{typingSpeed:s=50,deleteSpeed:a=20,pauseDuration:n=2e3,once:i=!1,enabled:l=!0}=t,[r,o]=(0,m.useState)(""),[d,c]=(0,m.useState)(0),[u,p]=(0,m.useState)(!1),[h,x]=(0,m.useState)(!1),[v,g]=(0,m.useState)(!1),[f,j]=(0,m.useState)(!1);return(0,m.useEffect)(()=>{let e=()=>{g(!0),p(!0)};return window.addEventListener("gb-entry-complete",e),()=>{window.removeEventListener("gb-entry-complete",e)}},[]),(0,m.useEffect)(()=>{if(!v||!l)return;if(h&&0===d&&window.dispatchEvent(new Event("first-placeholder-typed")),h){let e=setTimeout(()=>{x(!1),i?j(!0):p(!1)},n);return()=>clearTimeout(e)}if(i&&f)return;let t=e[d];if(u){if(t&&r.length<t.length){let e=setTimeout(()=>{o(t.slice(0,r.length+1))},s);return()=>clearTimeout(e)}x(!0)}else if(0===r.length)c(t=>(t+1)%e.length),p(!0);else{let e=setTimeout(()=>{o(r.slice(0,-1))},a);return()=>clearTimeout(e)}},[r,u,h,d,e,s,a,n,v,i,f,l]),r};var sn=s(86123);function si(e){var t;let{messages:s,firstErrorLog:a,latestVersionId:n}=e,i=s.find(e=>{if("status"===e.kind&&"error"===e.status.kind)return!0;if("runtimeLog"===e.kind){let t=e.info.counts[eL.LogLevel.ERROR]>0,s=e.info.versionId===n;return t&&s}return!1});return{summary:null!==(t=null==a?void 0:a.summary)&&void 0!==t?t:null,error:(null==a?void 0:a.summary)?(null==i?void 0:i.kind)==="status"?"snag":(null==i?void 0:i.kind)==="runtimeLog"?"autofix":null:null}}let sl=F.z.object({chatInput:F.z.union([F.z.string(),F.z.array(F.z.any())]),context:F.z.object({pathname:F.z.string(),screenshots:F.z.array(F.z.string()).optional(),theme:F.z.enum(["light","dark"]).optional()}).optional(),isHidden:F.z.boolean().optional(),isQueued:F.z.boolean().optional()}),sr={initial:{opacity:0,y:20,scale:.98},animate:{opacity:1,y:0,scale:1,transition:{duration:.2,ease:"easeOut"}},exit:{opacity:0,y:20,scale:.98,transition:{duration:.15,ease:"easeIn"}}},so=e=>{let{isPublishing:t,hasLiveVersionWarning:s,...n}=e;return(0,a.jsx)("div",{...n})},sd={firstMessage:{maxHeight:"30px",opacity:.8,overflow:"hidden",transition:"all 0.3s ease-out",pointerEvents:"none",position:"relative"},midMessage:{maxHeight:"100%",opacity:.9,transition:"all 0.3s ease-out",transform:"translateY(0)"},lastMessage:{maxHeight:"100%",opacity:1,transition:"all 0.3s ease-out",transform:"translateY(0)"},container:{display:"flex",flexDirection:"column",gap:"0.25rem",transition:"all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)",position:"relative",maxHeight:"120px",overflow:"hidden"},expanded:{display:"flex",flexDirection:"column",gap:"0.25rem",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",position:"relative",maxHeight:"600px",overflow:"auto"}};function sc(e){let{hiddenCount:t,onExpand:s}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-1 mb-1",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground text-xs cursor-pointer hover:text-foreground transition-colors flex items-center z-10 font-semibold",onClick:s,children:"Show ".concat(t," more")})]})}function su(e){let t,{message:s,isFirstVisible:n,isLastVisible:i,isMidVisible:l,groupId:r,isHidden:o,isLastGroup:d,isLastMessage:c,isSendingMessage:u,focusChatTextarea:m,handleChatSubmit:p,app:h}=e;o&&(n?t=sd.firstMessage:l?t=sd.midMessage:i&&(t=sd.lastMessage));let x="message"===s.kind&&s.message.role===eL.MessageRole.USER||"status"===s.kind&&"message"===s.status.kind&&"user"===s.status.role;return(0,a.jsxs)("div",{className:"transition-all duration-300 ease-out",style:t,children:[x?(0,a.jsx)(eE,{avatarClassName:"h-6 w-6",className:"h-6 w-6 ml-auto !mb-2",userId:"message"===s.kind?s.userId:null}):null,(0,a.jsx)(tZ,{app:h,className:(0,K.cn)("flex flex-col gap-2 break-words rounded-lg text-sm",x?"w-fit max-w-[83%] items-end ml-auto !mt-0":"status"==s.kind&&"tool"==s.status.kind||"runtimeLog"==s.kind||"version"==s.kind?"":"max-w-[95%]"),focusChatTextarea:m,handleChatSubmit:p,hideButtons:o,isLast:d&&c,isLoading:u,isVerbose:!o,message:s})]},"".concat(r,"-").concat(s.id))}function sm(e){let{group:t,isLastGroup:s,isSendingMessage:n,focusChatTextarea:i,handleChatSubmit:l,app:r}=e,o=(0,m.useMemo)(()=>t.messages.filter(e=>("runtimeLog"!==e.kind||!!e.info.counts[eL.LogLevel.ERROR]||!!e.info.counts[eL.LogLevel.WARN])&&("messageSummary"!==e.kind||!!e.message.content)),[t.messages]),{visibleMessages:d,containerStyle:u,hasHiddenMessages:p,isExpanded:h,isTransitioning:x,hiddenCount:v,expand:g,collapse:f,shouldCollapse:j}=function(e){let t=e.length>2,[s,a]=(0,m.useState)({isExpanded:!t,isTransitioning:!1}),n=(0,m.useRef)(e.length),i=(0,m.useRef)(null);(0,m.useEffect)(()=>()=>{i.current&&clearTimeout(i.current)},[]),(0,m.useEffect)(()=>{let t=n.current,s=e.length;t<=2&&s>2&&a({isExpanded:!1,isTransitioning:!1}),n.current=s},[e.length,2]);let l=(0,m.useMemo)(()=>s.isExpanded||s.isTransitioning||!t?e:e.slice(-2),[e,s.isExpanded,s.isTransitioning,t,2]),r=(0,m.useMemo)(()=>s.isExpanded||s.isTransitioning||!t?s.isTransitioning?{...sd.expanded,maxHeight:"120px"}:s.isExpanded&&l.length>1?sd.expanded:void 0:sd.container,[s.isExpanded,s.isTransitioning,t,l.length]),o=(0,m.useCallback)(()=>{a({isExpanded:!0,isTransitioning:!1})},[]),d=(0,m.useCallback)(()=>{a({isExpanded:!1,isTransitioning:!0}),i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{a({isExpanded:!1,isTransitioning:!1})},300)},[]);return{visibleMessages:l,containerStyle:r,hasHiddenMessages:t&&!s.isExpanded&&!s.isTransitioning,isExpanded:s.isExpanded,isTransitioning:s.isTransitioning,hiddenCount:e.length-2,expand:o,collapse:d,shouldCollapse:t}}(o);if(0===o.length)return null;let b=(0,K.cn)("flex flex-col gap-1 pl-2 origin-top transition-all duration-300",h&&!x&&"animate-in fade-in-0 duration-300");return(0,a.jsxs)("div",{className:"flex flex-col gap-2 w-full relative first:mt-4",children:[(0,a.jsxs)("div",{className:b,style:u,children:[p&&(0,a.jsx)(sc,{hiddenCount:v,onExpand:g}),d.map((e,u)=>{var m;let v=e.id===(null===(m=(0,c.A)(o))||void 0===m?void 0:m.id),g=0===u,f=u===d.length-1,b=!g&&!f,w=!h&&!x&&p&&j;return(0,a.jsx)(su,{app:r,focusChatTextarea:i,groupId:t.id,handleChatSubmit:l,isFirstVisible:g,isHidden:w&&(g||b||f),isLastGroup:s,isLastMessage:v,isLastVisible:f,isMidVisible:b,isSendingMessage:n,message:e},"".concat(t.id,"-").concat(e.id))})]}),(h||x)&&j&&(0,a.jsxs)(O.$n,{className:"text-muted-foreground text-sm font-normal self-start pl-2 flex items-center group",size:"sm",type:"button",variant:"ghost",onClick:f,children:[(0,a.jsx)(y.A,{className:"h-4 w-4 group-hover:-translate-y-0.5 transition-transform"}),(0,a.jsx)("span",{className:"text-xs font-semibold",children:"Collapse"})]})]},t.id)}let sp=(0,m.forwardRef)((e,t)=>{var s,i,l,r,h,x,v;let{className:w,currentVersionId:y,isSendingMessage:F,chatLog:z,app:P,handleChatSubmit:D,allowUpload:T,allowChat:U=!0,hasRecentAppInteractions:V,hasNextPage:_,isFetchingNextPage:B,fetchNextPage:Y,initialContentPanelVisible:Z,onPositionChange:ee,onContentPanelClose:et,onVisibilityChange:es,hasLiveVersionWarning:en,isPublishing:ei,searchableApps:el,latestVersionRev:eo,firstErrorLog:ec,onPublish:eu,view:em,capabilities:ep,placeholders:eh={desktop:["You can just create things...","Recreate [insert website]","A wedding website with RSVPs and events","A reading list that I can share with friends","An internal tool for tracking support requests"],mobile:["You can just create things...","Recreate [insert website]","A personal CRM","A support request tracker","A shareable reading list"]},goonStatus:ex,showAbout:ev,...eg}=e,{isMinimized:ef,isGeneratingScreenshot:ej,setIsGeneratingScreenshot:eb,fileUploads:ew,isUploading:ey,appEditor:eN,setIsMinimized:ek,setOpenEditor:eA,setFileUploads:eC,quote:eS,setQuote:eE,attachScreenshot:eM,setAttachScreenshot:eR,isContentPanelVisible:eF,setIsContentPanelVisible:eT,draftMessage:eU,setDraftMessage:eV,closeAppEditor:eO,setIsUploading:eH,searchResults:e_,setSearchResults:e$}=J(),eB=(0,H.al)(),eW=(0,u.useRouter)(),eJ=W(eB),[eQ,eG]=(0,m.useState)("default"),{toast:eY}=(0,O.dj)(),e0=q.F.useUtils(),e1=(0,p.mN)({resolver:(0,n.u)(sl),defaultValues:{chatInput:eU}}),{resolvedTheme:e2}=(0,M.D)();(0,m.useEffect)(()=>{let e=e1.watch(e=>{"string"==typeof e.chatInput&&eV(e.chatInput)});return()=>e.unsubscribe()},[e1,eV]);let e4=q.F.deleteGoonStatus.useMutation({onSuccess:()=>{e0.getAppChatMessages.invalidate()}}),e5=q.F.getAppAccessInfo.useQuery({id:null==P?void 0:P.id},{enabled:!!P}),e6=(null===(s=e5.data)||void 0===s?void 0:s.accessLevel)==eL.AclLevel.OWNER||(null===(i=e5.data)||void 0===i?void 0:i.accessLevel)==eL.AclLevel.EDITOR,{uploadFile:e9}=t7({appId:null==P?void 0:P.id}),te=(0,u.usePathname)(),tt=null!=T?T:ew.length<3,ts=null!==(r=ep.allowScreenshot)&&void 0!==r?r:ew.length<3,[ta,tn]=(0,m.useState)(!1),{currentVersionId:ti,switchVersion:tl}=ez(),{activeWarning:tr,canSendMessages:to}=function(e){var t,s,a,n,i,l;let{getUserPreference:r,currentUser:o}=(0,eI.A)(),d=r(eL.PreferenceKind.SYS_PLANS_ENABLED,!1),c=q.F.getUserLimits.useQuery(void 0,{enabled:!!o}),u=(0,sn.E)(e=>e.open),p=q.F.getAppAccessInfo.useQuery({id:e},{enabled:!!e}),h=null!==(l=null===(t=c.data)||void 0===t?void 0:t.remaining.maxMessagesPerWeek)&&void 0!==l?l:Number.MAX_SAFE_INTEGER,x=null===(s=c.data)||void 0===s?void 0:s.limits.maxMessagesPerWeek,v=d&&h<5,g=!d||h>0,f=(null===(a=p.data)||void 0===a?void 0:a.accessLevel)===eL.AclLevel.OWNER,j=d&&(null===(n=c.data)||void 0===n?void 0:n.userMustUpgrade)&&f;return{activeWarning:(0,m.useMemo)(()=>{if(j){var e;return{title:"You have reached your plan limits",description:"",actionLabel:(null===(e=c.data)||void 0===e?void 0:e.requiredUserTier)===eL.UserTier.TWO?"Upgrade to Pro":"Upgrade to Creator",onAction:u}}return v?{title:g?"You have ".concat(h," messages remaining."):"You have reached your message limit of ".concat(x," messages per week."),description:g?"Upgrade to unlock more messages per week.":"Upgrade to unlock more messages.",onAction:u}:null},[j,v,g,h,x,null===(i=c.data)||void 0===i?void 0:i.requiredUserTier,u]),hasMessageLimitWarning:v,hasUpgradePlanWarning:j,canSendMessages:g,messagesRemaining:h,maxMessagesPerWeek:x,checkOwnership:e=>{var t;return!!e&&(null===(t=p.data)||void 0===t?void 0:t.accessLevel)===eL.AclLevel.OWNER},userLimitsQuery:c,openUpgradeDialog:u}}(null==P?void 0:P.id),td=(0,m.useRef)(null),tc=(0,m.useRef)(null),[tu,tm]=(0,m.useState)(!1),[tp,th]=(0,m.useState)(!1),[tx,tv]=(0,m.useState)(!1),{scrollContainerRef:tg,scrollToBottom:tf,scrolledFromBottom:tj}=function(e){let{isMinimized:t,isContentPanelVisible:s,chatLog:a,isUserSending:n}=e,i=(0,m.useRef)(null),[l,r]=(0,m.useState)(!1),[o,d]=(0,m.useState)(!1),u=(0,m.useRef)(!1),p=(0,m.useRef)(null),h=(0,m.useRef)([]),x=(0,m.useMemo)(()=>{var e,t,s,n;if(!(null==a?void 0:a.length))return null;let i=(0,c.A)(a);if(!i)return null;let l=a.length!==(null===(e=h.current)||void 0===e?void 0:e.length)||(null===(t=(0,c.A)(h.current))||void 0===t?void 0:t.id)!==i.id,r="message"===i.kind&&(null===(s=i.message)||void 0===s?void 0:s.role)===eL.MessageRole.USER,o="message"===i.kind&&(null===(n=i.message)||void 0===n?void 0:n.role)===eL.MessageRole.ASSISTANT,d="messageSummary"===i.kind||"status"===i.kind||"interactiveToolCall"===i.kind||"version"===i.kind||"runtimeLog"===i.kind||"dbCommitLog"===i.kind;return{lastMessage:i,hasNewMessages:l,isUserMessage:r,isAgentMessage:o,isSystemMessage:d}},[a]),v=(0,m.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"auto",t=i.current;t&&t.scrollTo({top:t.scrollHeight,behavior:e})},[]),g=(0,m.useCallback)(()=>{let e=i.current;if(!e)return!1;let t=e.scrollHeight-e.scrollTop-e.clientHeight;return d(t>80),t>50},[]),f=(0,m.useCallback)(()=>{let e=i.current;return!!e&&e.scrollHeight-e.scrollTop-e.clientHeight>50},[]);return(0,m.useEffect)(()=>{if(u.current||(u.current=!0),t||!s)return;let e=()=>{let t=i.current;if(!t){requestAnimationFrame(e);return}let s=()=>{g(),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{r(f())},150)};return t.addEventListener("scroll",s),s(),v("auto"),()=>{t.removeEventListener("scroll",s),p.current&&clearTimeout(p.current)}};return e()},[t,s,f,v,g]),(0,m.useEffect)(()=>{if(x&&(x.hasNewMessages||n))(null!=n?n:!l&&(x.isUserMessage||x.isAgentMessage||x.isSystemMessage))&&v((null!=n?n:x.isUserMessage)?"auto":"smooth")},[a,l,v,n,x]),{scrollContainerRef:i,isUserScrolling:l,scrolledFromBottom:o,scrollToBottom:v,isClient:u.current}}({isMinimized:ef,isContentPanelVisible:eF,onContentPanelClose:()=>eT(!1),onChatInputFocus:()=>{var e;return null===(e=td.current)||void 0===e?void 0:e.focus()},chatLog:z,isSendingMessage:F,isUserSending:tu,isEditorOpen:eN.isOpen}),tb=(0,m.useMemo)(()=>el.filter(e=>e.id!==(null==P?void 0:P.id)),[el,P]),{showMentionMenu:tw,searchFocusedIndex:ty,filteredSuggestions:tN,handleMentionSelect:tk,handleChatInputChange:tA,onTagApps:tC,handleKeyDown:tS,setSearchFocusedIndex:tE,closeMentionMenu:tI}=st({form:e1,searchableApps:tb,chatInputRef:null!==(h=null===(l=td.current)||void 0===l?void 0:l.textArea)&&void 0!==h?h:null}),tL=si({messages:z,latestVersionId:null==P?void 0:P.latestVersionId,firstErrorLog:ec}),{getRootProps:tM,getInputProps:tR,open:tF,isDragReject:tz,isDragActive:tP}=(0,R.VB)({disabled:!tt,noClick:!0,maxSize:0x8000000,accept:{"image/png":[".png"],"image/gif":[".gif"],"image/jpeg":[".jpeg",".jpg"],"image/webp":[".webp"],"image/svg+xml":[".svg"],"application/pdf":[".pdf"],"text/plain":[".txt"],"application/json":[".json"],"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":[".xlsx"],"application/vnd.ms-excel":[".xls"],"application/vnd.openxmlformats-officedocument.wordprocessingml.document":[".docx"],"application/msword":[".doc"],"application/vnd.openxmlformats-officedocument.presentationml.presentation":[".pptx"],"application/vnd.ms-powerpoint":[".ppt"],"text/csv":[".csv"],"text/markdown":[".md"]},onDrop:async e=>{if(e.length>0&&!ey&&ew.length<3){eH(!0),console.log("\uD83D\uDCC1 Files received:",e.map(e=>({name:e.name,type:e.type,size:e.size})));let t=e.slice(0,3-ew.length),s=await Promise.all(t.map(async e=>{if(eK(e.name)){if(console.log("\uD83D\uDDBC️ Processing image: ".concat(e.name," (").concat(e.type,")")),e.name.toLowerCase().endsWith(".svg")){let t=new FileReader;return(await new Promise(s=>{t.onloadend=()=>s(t.result),t.readAsDataURL(e)})).replace("data:application/octet-stream","data:image/svg+xml")}try{let t=new FileReader,s=await new Promise(s=>{t.onloadend=()=>s(t.result),t.readAsDataURL(e)}),a=await new Promise(t=>{let a=new Image;a.onload=()=>{let n=document.createElement("canvas"),i=n.getContext("2d");n.width=a.width,n.height=a.height,i?(i.drawImage(a,0,0),t(n.toDataURL(e.type))):t(s)},a.onerror=()=>t(s),a.src=s}),n=await eq({dataUrl:a,resize:1024,crop:!1});return console.log("✅ Image successfully processed and resized"),"data:".concat(e.type,";base64,").concat(n.toString("base64"))}catch(e){return console.error("❌ Error processing image:",e),""}}else{console.log("\uD83D\uDCC4 Processing non-image file: ".concat(e.name));try{let t=await e9(e);return console.log("✅ File uploaded successfully: ".concat(e.name)),t}catch(t){return console.error("❌ Failed to upload file ".concat(e.name,":"),t),eY({title:"Failed to upload file",description:t?t.message:"",variant:"destructive"}),""}}}));if(console.log("✅ All files processed",{uploadedUrls:s.length,failedUploads:s.filter(e=>""===e).length}),eH(!1),e.length+ew.length>3)return console.warn("⚠️ Too many files: ".concat(e.length+ew.length,"/").concat(3)),eY({title:"Cannot upload more than ".concat(3," files"),variant:"destructive"});let a=s.filter(e=>""!==e);console.log("\uD83D\uDCC1 Adding ".concat(a.length," new files to existing ").concat(ew.length," files")),eC([...ew,...a])}},onError:e=>{eY({title:"Failed to upload file",description:e.message,variant:"destructive"})}}),{handlePaste:tD,generateScreenshot:tT}=function(e,t){return{handlePaste:s=>{if(e){for(let e of s.clipboardData.items)if(-1!==e.type.indexOf("image")){let s=e.getAsFile();if(!s)return;let a=new FileReader;a.onload=async function(e){var s;t("data:image/png;base64,"+(await eq({dataUrl:null===(s=e.target)||void 0===s?void 0:s.result,resize:1024})).toString("base64"))},a.readAsDataURL(s)}}},generateScreenshot:async()=>{var s,a;if(!e){console.warn("[useChatScreenshot] Screenshot generation is disabled");return}let n=document.getElementById("appFrame"),i=await Promise.race([t8(null==n?void 0:n.contentWindow,{type:"screenshot"}),new Promise((e,t)=>setTimeout(()=>t(Error("Request timed out")),5e3))]).catch(e=>{console.warn("[useChatScreenshot] Error:",e.message)});if(!(null==i?void 0:null===(s=i.payload)||void 0===s?void 0:s.screenshot)){console.warn("[useChatScreenshot] No screenshot found");return}try{let e=await eq({dataUrl:null==i?void 0:null===(a=i.payload)||void 0===a?void 0:a.screenshot,resize:1024}),s="data:image/png;base64,"+e.toString("base64");return t(s),s}catch(e){console.error("[useChatScreenshot] Error processing image:",e)}}}}(ts,e=>{if(ew.length>=3){eY({title:"Cannot upload more files",variant:"destructive"});return}eC([...ew,e])});(0,m.useEffect)(()=>{ew.length>0&&eR(!1)},[ew,eR]);let tU=q.F.stopAppInvocations.useMutation({onMutate:()=>{e0.getAppChatMessages.cancel();let e=e0.getAppChatMessages.getData({id:null==P?void 0:P.id,cursor:null});if(e){let t=e.messages.findLastIndex(e=>"message"==e.kind&&e.message.role==eL.MessageRole.USER);if(t>0){let s=e.messages.slice(0,t);e0.getAppChatMessages.setData({id:null==P?void 0:P.id,cursor:null},{messages:s,nextCursor:null,areAgentsIdle:!0,goonStatus:null,firstErrorLog:null})}}},onSuccess:()=>{e0.getAppChatMessages.invalidate({id:null==P?void 0:P.id}),em===$.Home&&eT(!1)}}),tV=q.F.deleteSummaryFromErrorLogForVersion.useMutation({onSuccess:()=>{e0.getAppChatMessages.invalidate({id:null==P?void 0:P.id})}}),tO=(0,m.useCallback)(()=>{var e;null===(e=td.current)||void 0===e||e.focus()},[]);(0,m.useEffect)(()=>{eS&&tO()},[eS,tO]);let tH=(0,m.useCallback)(()=>{eT(!eF)},[eF,eT]),t_=async e=>{if(e.chatInput&&("string"!=typeof e.chatInput||""!==e.chatInput.trim())){tm(!0),e1.reset({chatInput:""}),tI(),eN.isOpen&&eO(),eF||(tn(!0),eT(!0));try{var t;let s;let a=ew.filter(e=>eK(e)),n=ew.filter(e=>!eK(e));if(eM){eb(!0);let e=await tT();e&&(s=e),eb(!1)}let i="string"==typeof e.chatInput?e.chatInput:(null===(t=e.chatInput.find(e=>"text"===e.type))||void 0===t?void 0:t.text)||"",l=/@([a-z0-9]+)/g,r=[...i.matchAll(l)].map(e=>e[1]),o=r.map(e=>el.find(t=>{var s;return se(null!==(s=t.displayName)&&void 0!==s?s:"")===e.toLowerCase()})).filter(Boolean),d=Array.isArray(e.chatInput)?[...e.chatInput]:[{type:"text",text:e.chatInput}];if("string"==typeof e.chatInput){let t=e.chatInput.replace(l,"**$&**");d=[{type:"text",text:t}]}else Array.isArray(e.chatInput)&&(d=e.chatInput.map(e=>"text"===e.type&&e.text?{...e,text:e.text.replace(l,"**$&**")}:e));if(o.length>0){let e="<system-note> The following apps have been tagged in the message:\n",t=new Set;o.forEach((s,a)=>{if(s&&!t.has(s.id)){var n,i;let l=null!==(n=r[a])&&void 0!==n?n:"";e+="- ".concat(null!==(i=s.displayName)&&void 0!==i?i:s.name," (@").concat(l,"): ").concat((0,eP.MJ)(s.subdomain),"\n"),t.add(s.id)}}),e+="\nThe user has tagged these apps to make you aware of other apps they have and might want to use some functionality from. To get more detailed information about these apps, you must call the `getAC1AppInfo` tool. </system-note>",d.push({type:"text",text:e})}eC([]),eA(!1);let c=eS?"Question: ".concat(eS.context,"\n\nSelected answer: ").concat(eS.diff,"\n\nMy response: "):"";await D({chatInput:[...c?[{type:"text",text:c}]:[],...a.map(e=>({type:"image_url",image_url:{url:e}})),...n.length?[{type:"text",text:"\n\n---\n\n"+n.join("\n")}]:[],...d].filter(e=>e.text||e.image_url),context:{pathname:te,screenshots:s?[s]:void 0,theme:e2},isHidden:e.isHidden}),setTimeout(()=>{var e;null===(e=td.current)||void 0===e||e.focus()},0)}finally{eE(null),tm(!1),eR(!0),requestAnimationFrame(()=>{tn(!1),tf("smooth")})}}};(0,m.useEffect)(()=>{eN.isOpen&&eG("editor")},[eN.isOpen]);let t$=async e=>{if(tw&&"Escape"===e.key){e.preventDefault(),tI();return}if("search"===eQ&&e_&&e_.length>0&&"Escape"===e.key){e.preventDefault(),e$(null),tE(0),eG("default"),eT(!1),tv(!0);return}if(tw&&tN.length>0){if("ArrowDown"===e.key){e.preventDefault(),tE(e=>Math.min(e+1,tN.length-1));return}if("ArrowUp"===e.key){e.preventDefault(),tE(e=>-1===e?tN.length-1:Math.max(e-1,0));return}if("Enter"===e.key&&ty>=0){if(e.preventDefault(),tw&&(null==tN?void 0:tN[ty]))tk(null==tN?void 0:tN[ty]);else{var t;let e=null!==(t=null==e_?void 0:e_[ty])&&void 0!==t?t:null==tN?void 0:tN[ty];e&&eW.push((0,eP.MJ)(e.subdomain))}return}}if("search"===eQ&&e_&&e_.length>0){if("ArrowDown"===e.key){e.preventDefault(),tE(e=>Math.min(e+1,e_.length-1));return}if("ArrowUp"===e.key){e.preventDefault(),tE(e=>-1===e?e_.length-1:Math.max(e-1,0));return}if("Enter"===e.key&&ty>=0){e.preventDefault();let t=e_[ty];t&&eW.push((0,eP.MJ)(t.subdomain)+"?_ogb=true");return}}tS(e,to,th,t_,eG)},tB=(0,m.useCallback)(e=>{!tx&&(0,f.A)(e=>{if(e&&e.length>2){let t=el.filter(t=>{var s,a;return(null===(s=t.name)||void 0===s?void 0:s.toLowerCase().includes(e.toLowerCase()))||(null===(a=t.displayName)||void 0===a?void 0:a.toLowerCase().includes(e.toLowerCase()))}).slice(0,5);t.length>0?(e$(t),tE(t.length>0?t.length-1:-1),eG("search"),eT(!0)):(e$(null),"search"===eQ&&(eG("default"),eT(!1)))}else e$(null),"search"===eQ&&(eG("default"),eT(!1))},300)(e)},[eQ,tx,el,eT,tE,e$]),tW=e1.watch("chatInput");(0,m.useEffect)(()=>{tW&&("string"!=typeof tW||""!==tW.trim())||tv(!1)},[tW]);let tJ=async()=>{try{if(ew.length>=3){eY({title:"Cannot upload more files",variant:"destructive"});return}eb(!0);let e=await tT();e&&(eC([...ew,e]),eR(!1),eA(!0))}catch(e){eY({title:"Failed to generate screenshot",description:e instanceof Error?e.message:"Unknown error",variant:"destructive"})}finally{eb(!1)}},tQ=(0,m.useMemo)(()=>{var e;let t=e=>"version"==e.kind||"runtimeLog"==e.kind||"messageSummary"==e.kind||"dbCommitLog"==e.kind||"status"==e.kind&&"error"!=e.status.kind,s=Object.entries((0,j.A)(z,e=>{var s;let a=z.indexOf(e);if(!t(e))return e.id;for(;a>=0&&t(z[a]);)a--;return null===(s=z[a+1])||void 0===s?void 0:s.id})).map(e=>{let[t,s]=e;return{id:t,messages:s.sort((e,t)=>e.timestamp-t.timestamp),maxTimestamp:Math.max(...s.map(e=>e.timestamp))}}).sort((e,t)=>e.maxTimestamp-t.maxTimestamp).map(e=>{let{id:t,messages:s,maxTimestamp:a}=e;return{id:t,messages:s,timestamp:a}});return null===(e=(0,c.A)(s))||void 0===e||e.id,s},[z]);(0,m.useEffect)(()=>{if(em===$.Home&&tQ.length<2){let e=e1.watch(e=>{var t;let s=null!==(t=e.chatInput)&&void 0!==t?t:"";tB("string"==typeof s?s.trim().toLowerCase():"")});return()=>e.unsubscribe()}},[em,e1,tB,tQ]);let tG=()=>{ep.allowMinimize&&(ek(!ef),eT(!1),!ef&&(null==P?void 0:P.id)&&e4.mutate({id:P.id}))};(0,m.useEffect)(()=>{if((0,b.A)(window))return;let e=e=>{"outsideClick"===e.data.type&&eF&&(eT(!1),null==et||et())};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[eF,et,eT]),(0,m.useEffect)(()=>{null==es||es(eF)},[eF,es]),(0,m.useEffect)(()=>{if(!ep.allowMinimize)return;let e=e=>{"Escape"===e.key&&(e.preventDefault(),ek(!0))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[ek,ep.allowMinimize]);let tq=async()=>{let e=e1.getValues();e.chatInput&&("string"!=typeof e.chatInput||e.chatInput.trim())&&(await D({...e,isQueued:!0}),e1.reset())},tY=em===$.Home&&z.length<=1&&!ev,tK=sa(eB?eh.mobile:eh.desktop,{typingSpeed:50,deleteSpeed:20,pauseDuration:2e3,enabled:tY}),tZ=sa(["Enter prompt to start creating..."],{once:!0,enabled:ev});(0,m.useEffect)(()=>{ep.contentPanel.initiallyVisible&&eT(!0)},[ep.contentPanel.initiallyVisible,eT]);let t0=null==P?void 0:P.latestVersionId,{data:t1}=q.F.getSuggestedPrompts.useQuery({versionId:t0},{enabled:e6&&!F&&!!t0,staleTime:1/0,cacheTime:36e5,suspense:!1}),t2=!(null==P?void 0:P.latestVersionId)||(null==P?void 0:P.latestVersionId)===y,t5="",t9=z.filter(e=>"status"===e.kind&&"object"==typeof e.status&&null!==e.status&&"kind"in e.status&&"tool"===e.status.kind&&"status"in e.status).sort((e,t)=>t.timestamp-e.timestamp);t9.length>0&&(t5=t9[0].status.status||"");let{isDragging:sd,dragDistance:sc,handleTouchStart:su}=ss(tG);return(0,m.useEffect)(()=>{function e(e){tw&&tc.current&&!tc.current.contains(e.target)&&tI(),"search"===eQ&&eF&&tc.current&&!tc.current.contains(e.target)&&(e$(null),tE(0),eG("default"),eT(!1),tv(!0))}return document.addEventListener("mousedown",e),document.addEventListener("touchstart",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("touchstart",e)}},[tw,tI,eQ,eF,e$,tE,eG,eT,tv]),(0,a.jsx)(d.P.div,{animate:ef?"minimized":"maximized",className:(0,K.cn)("flex justify-center","sm:mx-auto","w-full"),ref:tc,style:{transform:sd?"translateY(".concat(sc,"px)"):void 0},onAnimationComplete:()=>{window.dispatchEvent(new Event("gb-entry-complete"))},onClick:()=>{!ef&&"peek"!==eJ&&(null==P?void 0:P.id)&&e4.mutate({id:P.id})},children:(0,a.jsx)(o.N,{mode:"wait",children:ef&&"tools"===eJ?(0,a.jsx)(e8,{app:P,canEditApp:e6,capabilities:ep,chatLog:z,currentVersionId:y,goonStatus:ex,handleAnnotateScreenshot:tJ,isSendingMessage:F,variant:"minimized",onChatClick:()=>{(null==P?void 0:P.id)&&e4.mutate({id:P.id}),ek(!1),eT(!0),eN.isOpen&&eO(),setTimeout(()=>{var e;null===(e=td.current)||void 0===e||e.focus()},0)},onPublish:eu,onTagApps:tC}):(0,a.jsx)(so,{className:(0,K.cn)("relative flex flex-col","peek"===eJ&&ef?"px-0":"px-2 sm:px-0","transition-all duration-300 ease-in-out",(!eF||"search"===eQ)&&"max-w-md",eF&&"search"!==eQ&&!eN.isOpen&&"max-w-lg",eF&&eN.isOpen&&"sm:max-w-2xl lg:max-w-4xl","w-screen"),"data-chat-content":!0,hasLiveVersionWarning:!!eB&&en,isPublishing:!!eB&&ei,children:(0,a.jsx)(d.P.div,{animate:"animate",className:"bg-inherit space-y-4 relative h-full",exit:"exit",initial:"initial",variants:sr,onAnimationStart:()=>{!ef&&eF&&tf("auto")},onClick:()=>{ef&&"peek"===eJ&&(ek(!1),eT(!0),(null==P?void 0:P.id)&&e4.mutate({id:P.id}))},children:(0,a.jsx)("div",{...eg,ref:t,children:(0,a.jsxs)("div",{className:"bg-inherit w-full max-w-full",...tM(),children:[(0,a.jsx)("input",{...tR()}),(0,a.jsxs)(O.lV,{...e1,children:[!eF&&ep.allowMinimize&&!("peek"===eJ&&ef)&&(0,a.jsx)(tX,{barClassName:"w-16 bg-slate-400 dark:bg-slate-300",className:(0,K.cn)("p-2",!ep.allowMinimize&&"pointer-events-none opacity-50"),disabled:!ep.allowMinimize,onClick:tG}),(0,a.jsxs)("form",{className:(0,K.cn)("flex flex-col w-full bg-gradient-to-b from-card/80 to-secondary/80 backdrop-blur-2xl bottom-0 border border-border/60 z-50 overflow-hidden shadow-2xl","peek"===eJ&&ef?"rounded-2xl":"rounded-3xl",eF&&"search"!==eQ&&"h-[85dvh]",F&&"peek"===eJ&&ef&&"color-flow-glow is-loading",tz?"ring-destructive":""),onSubmit:e=>{e.preventDefault(),e.stopPropagation()},children:[eF&&(0,a.jsxs)(a.Fragment,{children:[em!==$.Home&&(0,a.jsxs)("div",{className:"flex flex-col px-2 gap-2",onTouchStart:su,children:[(0,a.jsx)(tX,{barClassName:"w-16 bg-slate-400 dark:bg-slate-300",className:(0,K.cn)(!ep.allowMinimize&&"pointer-events-none opacity-50"),disabled:!ep.allowMinimize,onClick:tG}),eF&&!(ef&&"peek"===eJ)&&(0,a.jsxs)(a.Fragment,{children:[tr&&(0,a.jsx)(t6,{actionLabel:tr.actionLabel,description:tr.description,title:tr.title,onAction:tr.onAction}),!tr&&"autofix"===tL.error&&!F&&(null==P?void 0:P.id)&&(0,a.jsx)(ea,{appId:P.id,description:null!==(x=tL.summary)&&void 0!==x?x:"We detected some issues. Let me try to fix them.",onClose:()=>{y&&tV.mutate({versionId:y})}}),!tr&&!tL.error&&en&&(0,a.jsx)(e7,{isPublishing:ei,latestVersionRev:eo,onPublish:eu})]})]}),eN.isOpen?(0,a.jsx)(X,{className:"scrollable-container overflow-y-hidden flex flex-col bg-transparent h-full",tab:eN.tab,versionId:null!==(v=eN.versionId)&&void 0!==v?v:void 0,onClose:()=>eO()}):"search"===eQ&&!tw&&e_?(0,a.jsx)(t3,{disable:()=>{var e;tv(!0),e$(null),eT(!1),null===(e=td.current)||void 0===e||e.focus()},focusedIndex:ty,results:e_,rowsIcon:(0,a.jsx)(N.A,{className:"w-4 h-4"}),onResultNavigate:e=>tE(e),onResultSelect:e=>{eW.push((0,eP.MJ)(e.subdomain)),e$(null),eT(!1),e1.reset({chatInput:""})}}):(0,a.jsxs)("div",{className:(0,K.cn)("scrollable-container flex flex-col gap-2 overflow-y-auto overflow-x-hidden px-4 relative pointer-events-auto scrollbar-show h-full"),ref:tg,onScroll:async()=>{let e=tg.current;if(e&&e.scrollTop<250&&_&&Y&&!B){let t=e.scrollTop,s=e.scrollHeight;await Y(),setTimeout(()=>{if(e){let a=e.scrollHeight;e.scrollTop=t+(a-s-250)}},0)}},children:[_&&Y&&(0,a.jsx)("div",{className:"flex flex-col items-center",children:(0,a.jsxs)(O.$n,{disabled:B,size:"sm",type:"button",variant:"ghost",onClick:async()=>{await Y()},children:[B?(0,a.jsx)(k.A,{className:"h-4 w-4 mr-1 animate-spin"}):(0,a.jsx)(A.A,{className:"h-4 w-4 mr-1"}),"Load more"]})}),tQ.map(e=>{var t;return(0,a.jsx)(sm,{app:P,focusChatTextarea:tO,group:e,handleChatSubmit:D,isLastGroup:e.id===(null===(t=(0,c.A)(tQ))||void 0===t?void 0:t.id),isSendingMessage:F},e.id)}),!F&&t1&&t1.length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-border/50",children:[(0,a.jsx)("div",{className:"flex items-center gap-2 mb-3 px-1",children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-primary/10 rounded-md",children:[(0,a.jsx)(C.A,{className:"h-3.5 w-3.5 text-primary"}),(0,a.jsx)("span",{className:"text-xs font-medium text-primary",children:"Try these prompts"})]})}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 px-1",children:t1.map(e=>(0,a.jsx)(O.$n,{className:"h-7 px-2.5 text-xs bg-secondary/50 hover:bg-secondary/80 hover:-translate-y-[1px] active:translate-y-0 transition-all duration-150",variant:"ghost",onClick:()=>{e1.setValue("chatInput",e),setTimeout(()=>{if(td.current){td.current.focus();let t=td.current;(null==t?void 0:t.textArea)&&(t.textArea.selectionStart=t.textArea.selectionEnd=e.length)}},0)},children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(S.A,{className:"h-3 w-3 text-primary/70"}),(0,a.jsx)("span",{className:"text-foreground/90",children:e})]})},e))})]})]})]}),tw&&(0,a.jsx)(t3,{disable:()=>{tE(-1),tI()},focusedIndex:ty,results:tN,rowsIcon:(0,a.jsx)(E.A,{className:"w-4 h-4"}),title:"Connect an app to use its tools or data",onResultSelect:e=>{tk(e)}}),U&&(0,a.jsx)(O.zB,{control:e1.control,name:"chatInput",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)("div",{className:"flex flex-col relative",children:[(0,a.jsx)(o.N,{children:tj&&(0,a.jsx)(d.P.div,{animate:{opacity:1,y:0,scale:1},className:"absolute flex w-fit items-center justify-center -top-10 inset-x-0 m-auto z-50",exit:{opacity:0,y:10,scale:.5},initial:{opacity:0,y:10,scale:.2},transition:{type:"spring",stiffness:350,damping:15,mass:.8},children:(0,a.jsx)("div",{className:"animate-slow-bounce",children:(0,a.jsx)(O.$n,{className:"!rounded-full items-center justify-center !shadow-xl transition-all duration-150 hover:scale-110 active:scale-95",size:"icon",variant:"outline",onClick:()=>tf("smooth"),children:(0,a.jsx)(I.A,{className:"h-3.5 w-3.5"})})})})}),tP&&(0,a.jsx)(ed,{}),!eF&&!(ef&&"peek"===eJ)&&tr&&(0,a.jsx)(t6,{actionLabel:tr.actionLabel,containerClassName:"p-2",description:tr.description,title:tr.title,onAction:tr.onAction}),!!eS&&(0,a.jsx)(t4,{quotedText:eS,setQuote:eE}),(ey||ew.length>0)&&(0,a.jsxs)("div",{className:"flex flex-row flex-nowrap items-center p-4 pb-1 gap-2 overflow-x-auto scrollbar-hide",children:[ew.map((e,t)=>(0,a.jsx)(eX,{openEditor:ej&&eK(e),url:e,onEditorClose:()=>{var e;eA(!1),ek(!1),null===(e=td.current)||void 0===e||e.focus()},onRemove:()=>{eC(e=>e.filter((e,s)=>s!==t)),ew.length-1==0&&eR(!0)},onUpdate:e=>eC(s=>(0,g.A)(s.map((s,a)=>a===t?e:s)))},"file-upload-".concat(t))),ey&&(0,a.jsx)(eZ,{})]}),(0,a.jsxs)("div",{className:"grid grid-rows-[1fr,auto] relative",children:[ef&&"peek"===eJ&&(F||ex)?(0,a.jsxs)("div",{className:"flex items-center gap-1.5 px-4 py-3",children:[F?(0,a.jsx)(e3.iN,{className:"h-4 w-4 shrink-0"}):ex?(0,a.jsxs)("div",{className:"relative flex h-2 w-2",children:[(0,a.jsx)("span",{className:(0,K.cn)("absolute inline-flex h-full w-full animate-ping rounded-full opacity-75",G[ex.kind].backgroundPing)}),(0,a.jsx)("span",{className:(0,K.cn)("relative inline-flex h-2 w-2 rounded-full",G[ex.kind].background)})]}):null,(0,a.jsx)("span",{className:(0,K.cn)("truncate max-w-[80%] text-sm text-secondary-foreground/60 leading-tight",F&&"shimmer-text"),children:F?t5:ex?Q[ex.kind]:""})]}):(0,a.jsxs)("div",{className:"relative flex",children:[(0,a.jsx)(er,{...s,autoComplete:"off",autoFocus:!eB,className:(0,K.cn)("w-full bg-transparent border-0",ef&&"peek"===eJ?"pt-2 px-4 pb-1.5 pointer-events-none pr-12":"pt-3.5 px-4 pb-1.5",F&&"pr-16 sm:pr-20","text-sm resize-none focus:ring-0 focus-visible:ring-0",tp?"animate-shake":""),disabled:!t2||ej,enterKeyHint:e_&&e_.length>0&&ty>=0?"go":"send",mentionSuggestions:tb,placeholder:em===$.Home&&ev?tZ:tY?tK:t2?F?"Type to queue a message...":(null==eS?void 0:eS.source)==="multipleChoice"?"Add more details":e6?"Type to adapt...":"Type to remix ".concat(null!==(t=null==P?void 0:P.displayName)&&void 0!==t?t:"this","..."):"Switch to latest version to chat...",ref:td,showQueueButton:F,onChange:tA,onKeyDown:t$,onPaste:tD,onQueueSubmit:tq}),ef&&"peek"===eJ&&P&&(0,a.jsx)("div",{onClick:e=>{e.stopPropagation()},children:(0,a.jsx)(eD,{appId:P.id,children:e=>{let{isUnlisted:t,isLoading:s}=e;return(0,a.jsx)(O.$n,{className:"absolute right-1.5 top-1.5 !rounded-xl",disabled:s,size:"xs",variant:t?"outline":"default",children:(0,a.jsx)("span",{className:t?"":"text-transparent bg-clip-text [background-image:var(--whisper-gradient)] animate-whisper",children:"Share app"})})}})})]}),(0,a.jsxs)("div",{className:"flex w-full gap-1 items-center justify-between p-2 pt-0",children:[(0,a.jsx)(e8,{app:P,canEditApp:e6,canSendMessages:to,capabilities:ep,chatLog:z,currentVersionId:y,dropzoneOpen:tF,handleAnnotateScreenshot:tJ,handleContentPanelToggle:tH,hasLiveVersionWarning:en,isPublishing:ei,isSendingMessage:F,isViewingLatestVersion:t2,latestVersionRev:eo,switchVersion:tl,variant:"inline",versionId:ti,onPublish:eu,onTagApps:tC}),F&&tU?(0,a.jsx)(O.$n,{size:"sm",type:"button",variant:"ghost",onClick:()=>{tU.mutate({id:null==P?void 0:P.id})},children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[tU.isLoading?(0,a.jsx)(L.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 text-primary/80 animate-spin"}):(0,a.jsx)("div",{className:"h-5 w-5 sm:h-3.5 sm:w-3.5 border border-primary/80 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"rounded-[1px] h-2 w-2 sm:h-1.5 sm:w-1.5 bg-primary/80 animate-pulse-grow"})}),(0,a.jsx)("span",{className:"hidden sm:inline text-xs font-normal",children:tU.isLoading?"Stopping...":"Stop"})]})}):s&&(0,a.jsx)(O.$n,{className:"!rounded-xl sm:rounded-xl",disabled:!t2||!to||ej||!F&&0===("string"==typeof s.value?s.value.trim():s.value).length||e_&&e_.length>0&&ty>=0||tw&&tN.length>0&&ty>=0,size:"iconSm",type:"button",variant:!t2||ej||!F&&0===("string"==typeof s.value?s.value.trim():s.value).length||e_&&e_.length>0&&ty>=0||tw&&tN.length>0&&ty>=0?"disabled":"brand",onClick:e=>{e.preventDefault(),t2&&!ej&&e1.handleSubmit(t_)()},children:(0,a.jsx)(A.A,{className:"h-4 w-4"})})]})]})]})}})]})]})]})})},"maximized")})})})});sp.displayName="GoonBar";var sh=s(48751),sx=s.n(sh),sv=s(81317);let sg={WebkitTouchCallout:"none",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"};function sf(e){var t;let{workspaceApps:s}=e,{toast:n}=(0,et.dj)(),[i,l]=(0,m.useState)(!1),[r,o]=(0,m.useState)({name:"New workspace",description:"",connectDomain:!1}),{currentUser:d}=(0,eI.A)(),[u,p]=(0,m.useState)(void 0),h=q.F.useUtils(),x=(0,c.A)(null==d?void 0:null===(t=d.email)||void 0===t?void 0:t.split("@")),v=q.F.createWorkspace.useMutation({onError(e){n({title:"Error creating workspace",description:e.message,variant:"destructive"})},onSuccess(e){n({title:e.name+" created"})}}),g=q.F.updateWorkspace.useMutation({onError(e){n({title:"Error updating workspace",description:e.message,variant:"destructive"})},onSuccess(e){n({title:e.name+" updated"})}}),f=q.F.leaveWorkspace.useMutation({onError(e){n({title:"Error leaving workspace",description:e.message,variant:"destructive"})},onSuccess(e){n({title:"Left "+e.name}),h.getAppHubContent.invalidate()}}),[j,b]=(0,m.useState)([]),w=q.F.listWorkspaceUsers.useQuery({workspaceId:u},{enabled:!!u,onSettled:e=>{var t,s;b(null!==(s=null==e?void 0:null===(t=e.users)||void 0===t?void 0:t.map(t=>{var s,a,n;return{id:null!==(s=null==t?void 0:t.id)&&void 0!==s?s:"unknown",name:null!==(a=null==t?void 0:t.name)&&void 0!==a?a:"Unknown user",handle:null!==(n=null==t?void 0:t.handle)&&void 0!==n?n:"unknown",image:null==t?void 0:t.image,workspaceAclLevel:t.id==e.owner.id?"owner":"user",kind:"user"}}))&&void 0!==s?s:[])}}),y=q.F.canUserConnectDomain.useQuery(void 0,{enabled:!!d}),N=q.F.joinDomainWorkspace.useMutation({onError(e){n({title:"Error joining workspace",description:e.message,variant:"destructive"})},onSuccess(e){n({title:"Joined "+e.name}),h.getAppHubContent.invalidate()}}),A=q.F.deleteWorkspace.useMutation({onError(e){n({title:"Error deleting workspace",description:e.message,variant:"destructive"})},onSuccess(e){n({title:"Deleted "+e.name}),p(void 0),l(!1),h.getAppHubContent.invalidate()}});async function C(){let e=await v.mutateAsync({name:"New workspace"});o({name:e.name,description:e.description,connectDomain:null!=e.emailDomain}),p(e.id),h.getAppHubContent.invalidate()}async function S(){await g.mutateAsync({workspaceId:u,name:r.name,description:r.description,userIds:j.map(e=>e.id),connectDomain:r.connectDomain}),h.getAppHubContent.invalidate()}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eb.R,{className:"max-w-lg max-h-[85vh] overflow-y-auto",description:"Organize your apps and streamline collaboration.",forceOpen:i,render:e=>(0,a.jsxs)("div",{className:"flex flex-col gap-8 mt-2",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"grid w-full items-center gap-1.5",children:[(0,a.jsx)(O.JU,{htmlFor:"name",children:"Name"}),(0,a.jsx)(O.pd,{id:"name",placeholder:"Acme Inc",value:r.name,onChange:e=>o({...r,name:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid w-full items-center gap-1.5",children:[(0,a.jsx)(O.JU,{htmlFor:"desc",children:"Description"}),(0,a.jsx)(O.pd,{id:"desc",placeholder:"A workspace for Acme Inc projects",value:r.description,onChange:e=>o({...r,description:e.target.value})})]}),y.isLoading?(0,a.jsx)(O.EA,{className:"h-6"}):x&&y.data?(0,a.jsx)("div",{className:"rounded-lg border p-4",children:(0,a.jsxs)("div",{className:"flex justify-start gap-2",children:[(0,a.jsx)(O.Sc,{checked:r.connectDomain,id:"assoc",onCheckedChange:e=>o({...r,connectDomain:!0==e})}),(0,a.jsxs)("div",{className:"grid gap-1.5 leading-none",children:[(0,a.jsx)(O.JU,{className:"font-normal",htmlFor:"assoc",children:"Associate email with this workspace"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Users with ",x," email addresses will be able to join this workspace without invitations."]})]})]})}):null,(0,a.jsx)("div",{className:"rounded-lg border p-4",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.JU,{className:"text-sm text-destructive",children:"Danger Zone"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Permanently delete this workspace. This will not delete any apps or users."})]}),(0,a.jsxs)(O.$n,{disabled:A.isLoading,size:"sm",type:"button",variant:"destructive",onClick:()=>{window.confirm("Are you sure you want to delete this workspace? This action cannot be undone.")&&A.mutate({workspaceId:u})},children:[A.isLoading?(0,a.jsx)(k.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5 animate-spin"}):(0,a.jsx)(sv.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5"}),"Delete"]})]})})]}),w.isFetching?(0,a.jsx)(O.EA,{className:"h-[126px]"}):(0,a.jsx)(eR,{setUsers:b,users:j,workspaceId:u}),(0,a.jsxs)("div",{className:"flex flex-row justify-end items-center gap-2",children:[(0,a.jsx)(O.$n,{variant:"outline",onClick:()=>{e()},children:"Cancel"}),(0,a.jsx)(O.$n,{className:"shadow-button",disabled:g.isLoading,onClick:async()=>{u&&await S(),e()},children:g.isLoading?(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"animate-spin w-4 h-4 sm:w-3.5 sm:h-3.5"}),"Saving"]}):"Save"})]})]}),title:"Manage workspace",onOpenChange:e=>{e||l(!1)}}),null==s?void 0:s.map(e=>(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"px-4 flex flex-row justify-between",children:[(0,a.jsxs)("span",{className:"text-2xl font-medium text-white text-shadow",children:[e.name,e.emailDomain&&(0,a.jsx)("span",{className:"text-lg font-normal ml-2 text-muted-foreground",children:e.emailDomain})]}),e.isOwner&&(0,a.jsx)(O.$n,{className:"bg-secondary/60 backdrop-blur-xl",size:"sm",variant:"secondary",onClick:()=>{o({name:e.name,description:e.description,connectDomain:null!=e.emailDomain}),p(e.id),l(!0)},children:"Manage"}),e.canJoin&&(0,a.jsx)(O.$n,{size:"sm",variant:"secondary",onClick:()=>{N.mutate({workspaceId:e.id})},children:"Join"}),!e.canJoin&&!e.isOwner&&(0,a.jsx)(O.$n,{size:"sm",variant:"secondary",onClick:()=>{f.mutate({workspaceId:e.id})},children:"Leave"})]}),!e.canJoin&&(0,a.jsxs)("div",{className:"flex flex-col gap-3 bg-card/60 backdrop-blur-2xl rounded-3xl border border-border/50 p-4",children:[0===e.apps.length&&(0,a.jsxs)("div",{className:"flex flex-col w-full max-w-full p-2",children:[(0,a.jsx)("h5",{className:"font-medium text-sm",children:"Workspace empty"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["You haven","'","t added any apps to this workspace yet."]})]}),e.apps.map(e=>{var t,s;return(0,a.jsxs)(sx(),{"aria-label":"Open ".concat(null!==(t=e.displayName)&&void 0!==t?t:e.name," app"),className:"flex items-center gap-3 p-2 rounded-lg hover:bg-primary/5 transition-colors",draggable:!1,href:(0,eP.MJ)(e.subdomain),style:sg,children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(t5.z,{app:{id:e.id,iconUrl:e.iconUrl},className:"w-12 h-12 rounded-xl",style:sg})}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("h5",{className:"font-medium text-sm",style:sg,children:e.displayName}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2 overflow-hidden text-ellipsis",style:sg,children:null!==(s=e.description)&&void 0!==s?s:"No description"})]})]},e.id)})]})]},e.id)),d&&(0,a.jsx)("div",{className:"flex justify-center items-center gap-2",children:(0,a.jsxs)(O.$n,{className:"w-fit !shadow-2xl",variant:"secondary",onClick:async()=>{await C(),l(!0)},children:[(0,a.jsx)(ep.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5"}),"Create a workspace"]})})]})}var sj=s(31704);let sb=e=>{let{title:t,isAppOnHomeScreen:s,apps:n}=e,i=(0,H.al)(),{toast:l}=(0,O.dj)(),r=q.F.useUtils(),[o,d]=(0,m.useState)(!1),[c,u]=(0,m.useState)(!1),p=(0,m.useRef)(null),h=q.F.addHomeScreenApp.useMutation({onSuccess:()=>{l({title:"App added to home screen",duration:1e3}),r.getHomeScreenPages.invalidate()},onError:e=>{l({title:"Failed to add app to home screen",description:e?e.message:"",variant:"destructive",duration:1e3})}}),x=async e=>{await h.mutateAsync({appId:e})},v=q.F.removeHomeScreenApp.useMutation({onSuccess:()=>{l({title:"App removed from home screen",duration:1e3}),r.getHomeScreenPages.invalidate()},onError:e=>{l({title:"Failed to remove app from home screen",description:e?e.message:"",variant:"destructive",duration:1e3})}}),g=async e=>{await v.mutateAsync({appId:e})};return((0,m.useEffect)(()=>{let e=e=>{c&&p.current&&!p.current.contains(e.target)&&!o&&u(!1)};return c&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[c,o]),n&&0!==n.length)?(0,a.jsxs)("div",{className:"flex flex-col w-full gap-4",children:[(0,a.jsx)("h2",{className:"px-4 text-2xl font-medium text-left block text-white text-shadow",style:sg,children:t}),(0,a.jsx)("div",{className:"\n          bg-card/60 backdrop-blur-xl rounded-3xl py-6 px-4\n          transition-all duration-500 ease-in-out\n          ".concat(c?"h-fit":"flex justify-between h-auto"," \n        "),ref:p,onClick:e=>{e.currentTarget===e.target&&c&&u(!1)},children:c?(0,a.jsx)("div",{className:"grid grid-cols-4 gap-4 pb-2",children:n.map(e=>{var n,l,r,o,c,u;return(0,a.jsx)("div",{className:"flex flex-col items-center justify-center",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)(sj.tz,{onOpenChange:d,children:[(0,a.jsx)(sj.Rc,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)(sx(),{"aria-label":"Open ".concat(null!==(n=e.displayName)&&void 0!==n?n:e.name," app"),className:"flex justify-center",draggable:!1,href:(0,eP.MJ)(e.subdomain),style:sg,children:(0,a.jsx)(t5.z,{app:{id:e.id,iconUrl:null!==(l=e.iconUrl)&&void 0!==l?l:null},className:"object-cover rounded-xl w-14 h-14 md:w-16 md:h-16",style:sg})},e.id),(0,a.jsx)("p",{className:"text-xs md:text-sm text-muted-foreground text-center mt-1 md:mt-2 font-medium sm:font-normal tracking-tight line-clamp-1 text-ellipsis whitespace-nowrap",style:sg,children:(null!==(r=e.displayName)&&void 0!==r?r:e.name)&&(null!==(o=e.displayName)&&void 0!==o?o:e.name).length>(i?8:18)?"".concat((null!==(c=e.displayName)&&void 0!==c?c:e.name).substring(0,i?8:18),"..."):null!==(u=e.displayName)&&void 0!==u?u:e.name})]})}),(0,a.jsxs)(sj.Ip,{children:[(0,a.jsx)(sj.kt,{disabled:s(e.id),onClick:()=>x(e.id),children:"Add to Home Screen"}),(0,a.jsx)(sj.kt,{disabled:!s(e.id),onClick:()=>g(e.id),children:"Remove from Home Screen"})]})]})},"".concat(t,"-").concat(e.id))})}):(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 w-full",children:[n.slice(0,4===n.length?4:3).map(e=>{var n,l,r,o,c,u;return(0,a.jsx)("div",{className:"flex flex-col items-center justify-center",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)(sj.tz,{onOpenChange:d,children:[(0,a.jsxs)(sj.Rc,{children:[(0,a.jsx)(sx(),{"aria-label":"Open ".concat(null!==(n=e.displayName)&&void 0!==n?n:e.name," app"),className:"flex justify-center",draggable:!1,href:(0,eP.MJ)(e.subdomain),style:sg,children:(0,a.jsx)(t5.z,{app:{id:e.id,iconUrl:null!==(l=e.iconUrl)&&void 0!==l?l:null},className:"object-cover rounded-xl w-14 h-14 md:w-16 md:h-16",style:sg})}),(0,a.jsx)("p",{className:"text-xs md:text-sm text-muted-foreground text-center mt-1 md:mt-2 font-medium sm:font-normal tracking-tight line-clamp-1 text-ellipsis whitespace-nowrap",style:sg,children:(null!==(r=e.displayName)&&void 0!==r?r:e.name)&&(null!==(o=e.displayName)&&void 0!==o?o:e.name).length>(i?8:18)?"".concat((null!==(c=e.displayName)&&void 0!==c?c:e.name).substring(0,i?8:18),"..."):null!==(u=e.displayName)&&void 0!==u?u:e.name})]}),(0,a.jsxs)(sj.Ip,{children:[(0,a.jsx)(sj.kt,{disabled:s(e.id),onClick:()=>x(e.id),children:"Add to Home Screen"}),(0,a.jsx)(sj.kt,{disabled:!s(e.id),onClick:()=>g(e.id),children:"Remove from Home Screen"})]})]})},"".concat(t,"-preview-").concat(e.id))}),n.length<4&&Array.from({length:4-n.length}).map((e,s)=>(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,a.jsx)("div",{className:"w-14 h-14 md:w-16 md:h-16 rounded-xl bg-muted/60"}),(0,a.jsx)("div",{className:"w-16 h-4 mt-2 bg-muted/20 rounded"})]},"".concat(t,"-empty-").concat(s))),n.length>4&&(0,a.jsxs)("button",{className:"flex flex-col items-center justify-center group",onClick:()=>u(!0),children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-1 w-14 h-14 md:w-16 md:h-16",children:[n.slice(3,7).map(e=>{var t;return(0,a.jsx)("div",{className:"aspect-square",children:(0,a.jsx)(t5.z,{app:{id:e.id,iconUrl:null!==(t=e.iconUrl)&&void 0!==t?t:null},className:"w-full h-full rounded-lg object-cover",style:sg})},"mini-grid-".concat(e.id))}),Array.from({length:Math.min(4,7-n.length)}).map((e,t)=>(0,a.jsx)("div",{className:"aspect-square rounded-lg bg-muted/20"},"mini-grid-empty-".concat(t)))]}),(0,a.jsx)("p",{className:"text-xs md:text-sm text-muted-foreground text-center mt-1 md:mt-2",children:"Show All"})]})]})})]}):null},sw=e=>{var t,s,n,i;let{pageIndex:l,currentPage:r,isAppOnHomeScreen:o,appHubContent:d}=e,c=(null!==(s=null==d?void 0:d.recentlyViewedApps)&&void 0!==s?s:[]).concat(null!==(n=null==d?void 0:d.sharedApps)&&void 0!==n?n:[]).concat(null!==(i=null==d?void 0:d.ownedApps)&&void 0!==i?i:[]),{currentUser:u}=(0,eI.A)();return(0,a.jsxs)("div",{className:"flex flex-col w-full h-fit max-w-xl mx-auto gap-6 p-4 pt-8 pb-32",children:[(null==c?void 0:c.length)>0&&(0,a.jsx)("div",{className:"col-span-4 row-span-1 flex flex-col md:flex-row justify-between gap-3 md:gap-2 rounded-3xl",children:(0,a.jsx)(sb,{apps:c,currentPage:r,isAppOnHomeScreen:o,pageIndex:l,title:"Your library"})}),(0,a.jsx)("div",{className:" \n          flex flex-col transition-all duration-500 col-span-4 row-span-4 flex-1 gap-2",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6 w-full h-full overflow-y-auto",children:[null==d?void 0:null===(t=d.appStoreApps)||void 0===t?void 0:t.map(e=>(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)("h4",{className:"text-2xl font-medium text-white text-shadow px-4",children:e.categoryName}),(0,a.jsx)("div",{className:"flex flex-col gap-3 bg-card/60 backdrop-blur-2xl rounded-3xl border border-border/50 p-4",children:e.apps.map(e=>{var t,s;return(0,a.jsxs)(sx(),{"aria-label":"Open ".concat(null!==(t=e.displayName)&&void 0!==t?t:e.name," app"),className:"flex items-center gap-3 p-2 rounded-xl hover:bg-primary/5 transition-colors",draggable:!1,href:(0,eP.MJ)(e.subdomain),style:sg,children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(t5.z,{app:{id:e.id,iconUrl:e.iconUrl},className:"w-12 h-12 rounded-xl",style:sg})}),(0,a.jsxs)("div",{className:"flex-grow",children:[(0,a.jsx)("h5",{className:"font-medium text-sm",style:sg,children:e.displayName}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2 overflow-hidden text-ellipsis",style:sg,children:null!==(s=e.description)&&void 0!==s?s:"No description"})]})]},e.id)})})]},e.id)),u&&(0,a.jsx)(sf,{workspaceApps:null==d?void 0:d.workspaceApps})]})})]})};var sy=s(57572),sN=s(73712);let sk={REMOVE_DELAY:500,TOAST_DURATION:1e3},sA=e=>{let{pageIndex:t,currentPage:s,page:n,allPages:i}=e,{toast:l}=(0,O.dj)(),r=q.F.useUtils(),[o,d]=(0,m.useState)([]),[c,u]=(0,m.useState)({}),p=q.F.removeHomeScreenApp.useMutation({onSuccess:(e,t)=>{l({title:"App removed from home screen",duration:sk.TOAST_DURATION}),d(e=>[...e,t.appId]),setTimeout(()=>{r.getHomeScreenPages.invalidate()},sk.REMOVE_DELAY)},onError:e=>{l({title:"Failed to remove app from home screen",description:e?e.message:"",variant:"destructive",duration:sk.TOAST_DURATION})}}),h=q.F.moveHomeScreenApp.useMutation({onSuccess:()=>{l({title:"App moved successfully",duration:sk.TOAST_DURATION}),r.getHomeScreenPages.invalidate()},onError:e=>{l({title:"Failed to move app",description:e?e.message:"",variant:"destructive",duration:sk.TOAST_DURATION})}}),x=async(e,t)=>{try{await h.mutateAsync({appId:e,destinationPage:t})}catch(e){console.error("Failed to move app to another page:",e)}},v=async e=>{try{await p.mutateAsync({appId:e})}catch(e){console.error("Failed to remove app from home screen:",e)}},g=e=>{let t=i[e];return t&&t.homeAppPlacements.length>=tl.LU};return(0,a.jsx)("div",{className:"\n        grid w-full mx-auto h-full \n        grid-cols-4 gap-2\n        items-start justify-center \n        max-w-5xl\n        pt-8 pb-6 px-4\n        xs:pt-6 xs:pb-2\n        sm:pt-12 sm:pb-4\n        auto-rows-fr \n        transition-all duration-500 ease-in-out\n        ",style:{zIndex:t===s?10:1,...sg,overflowY:"hidden",touchAction:"pan-x",position:"relative"},children:Array.from({length:tl.LU}).map((e,s)=>{var l,r,d;let m=n[s];if(!m)return(0,a.jsxs)("div",{className:"flex flex-col items-center gap-1 md:gap-2 invisible pointer-events-none",children:[(0,a.jsx)("div",{className:"flex-shrink-0 w-12 h-12 md:w-16 md:h-16 lg:w-20 lg:h-20"}),(0,a.jsx)("small",{className:"text-center block landscape:lg:block landscape:sm:hidden",children:"\xa0"})]},"page-".concat(t,"-empty-").concat(s));let p=o.includes(m.id);return(0,a.jsxs)("div",{className:"flex flex-col items-center xs:gap-1 gap-2 transition-all duration-500 ".concat(p?"opacity-0 scale-0":"opacity-100 scale-100"),children:[(0,a.jsxs)(sj.tz,{children:[(0,a.jsx)(sj.Rc,{children:(0,a.jsx)("div",{className:"shadow-xl rounded-3xl",style:sg,children:(0,a.jsx)(sx(),{"aria-label":"Open ".concat(null!==(l=null==m?void 0:m.displayName)&&void 0!==l?l:null==m?void 0:m.name),className:"group flex flex-col items-start justify-between bg-transparent border-0 rounded-3xl transition-colors duration-200 ease-in-out",draggable:!1,href:(0,eP.MJ)(m.subdomain),style:sg,children:(0,a.jsx)(t5.z,{app:{id:m.id,iconUrl:null!==(r=m.iconUrl)&&void 0!==r?r:null},className:"flex-shrink-0 w-16 h-16 xs:w-14 xs:h-14 sm:w-20 sm:h-20 md:w-20 md:h-20 lg:w-24 lg:h-24"})})})}),(0,a.jsxs)(sj.Ip,{children:[(0,a.jsx)(sj.kt,{onClick:()=>v(m.id),children:"Remove from Home Screen"}),(0,a.jsxs)(sN.rI,{open:c[m.id],onOpenChange:e=>{u(t=>({...t,[m.id]:e}))},children:[(0,a.jsx)(sN.ty,{asChild:!0,children:(0,a.jsxs)(sj.kt,{onPointerEnter:()=>{u(e=>({...e,[m.id]:!0}))},children:["Move to Another Page",(0,a.jsx)(sy.A,{className:"ml-auto h-4 w-4"})]})}),(0,a.jsxs)(sN.SQ,{className:"max-h-[300px] overflow-y-auto",children:[(0,a.jsxs)(sN._2,{className:"gap-1",disabled:i.length>=tl.JO,onClick:()=>x(m.id,i.length+1),children:[(0,a.jsx)(ep.A,{className:"h-4 w-4"}),"New Page"]}),(0,a.jsx)(sN.mB,{}),i.map((e,s)=>{let n=s===t,i=g(s);return(0,a.jsxs)(sN._2,{disabled:n||i,onClick:()=>x(m.id,s+1),children:["Page ",s+1,i?" (Full)":""]},"move-to-page-item-".concat(s,"-").concat(m.id))})]})]})]})]}),(0,a.jsx)("div",{className:" text-xs md:text-sm text-center block  landscape:md:block landscape:sm:hidden  font-medium sm:font-normal tracking-tight  whitespace-nowrap overflow-hidden text-ellipsis text-white text-shadow w-full h-6 ",style:sg,children:null!==(d=m.displayName)&&void 0!==d?d:m.name})]},"page-".concat(t,"-app-").concat(m.id,"-").concat(s))})})},sC=e=>{let{data:t,appHubContent:s}=e,n=(0,m.useRef)(null),[i,l]=(0,m.useState)(0);(0,m.useEffect)(()=>{let e=n.current;if(!e)return;let t=()=>{l(Math.round(e.scrollLeft/e.clientWidth))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[l,t.length,i]);let r=(0,m.useMemo)(()=>t.map(e=>e.homeAppPlacements.map(e=>e.app)),[t]);return(0,a.jsx)("div",{className:"flex flex-col w-full mx-auto pt-9 h-dvh",children:(0,a.jsxs)("div",{className:"flex flex-col w-full h-full gap-4",children:[(0,a.jsxs)("div",{className:"flex w-full h-full overflow-x-auto snap-x snap-mandatory scroll-smooth",ref:n,style:{scrollbarWidth:"none",msOverflowStyle:"none"},children:[r.map((e,s)=>(0,a.jsx)("div",{className:"flex-shrink-0 w-full snap-center pb-32 xs:pb-34",children:(0,a.jsx)(sA,{allPages:t,currentPage:i,page:e,pageIndex:s},"home-page-".concat(s))},"page-".concat(s))),(0,a.jsx)("div",{className:"flex-shrink-0 w-full snap-center overflow-y-auto scrollbar-hide",children:(0,a.jsx)(sw,{appHubContent:s,currentPage:i,isAppOnHomeScreen:e=>t.some(t=>t.homeAppPlacements.some(t=>t.app.id===e)),pageIndex:r.length})})]}),i!==r.length&&(0,a.jsx)("div",{className:"flex justify-center items-start absolute bottom-32 xs:bottom-30 left-0 right-0 transition-opacity duration-300 z-50",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[r.map((e,t)=>(0,a.jsx)("div",{className:"h-2 w-2 rounded-full transition-all duration-300 cursor-pointer ".concat(t===i?"bg-white":"bg-white/35"),onClick:()=>{let e=n.current;e&&e.scrollTo({left:t*e.clientWidth,behavior:"smooth"})}},"page-indicator-".concat(t))),(0,a.jsx)("div",{className:"h-2 w-2 rounded-full bg-white/35 transition-all duration-300 cursor-pointer",onClick:()=>{let e=n.current;e&&e.scrollTo({left:r.length*e.clientWidth,behavior:"smooth"})}})]})})]})})};sC.displayName="HomeScreen";var sS=s(32423),sE=s(73439),sI=s(41279),sL=s(37824),sM=s(46189),sR=s(94621),sF=s(99885);function sz(e){let{children:t,skipEntryAnimation:s=!1}=e;return(0,a.jsx)(d.P.div,{...s?{initial:{opacity:1,scale:1},animate:{opacity:1,scale:1},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:350,damping:40}}:{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1,originY:0},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:350,damping:40}},className:"mx-auto w-full",layout:!0,children:t})}let sP=m.memo(e=>{let{children:t,className:s,delay:n=1e3,initialCount:i=0,startAnimation:l=!0,...r}=e,[d,c]=(0,m.useState)(Math.max(0,i-1)),u=(0,m.useMemo)(()=>m.Children.toArray(t),[t]);(0,m.useEffect)(()=>{if(l&&d<u.length-1){let e=setTimeout(()=>{c(e=>Math.min(e+1,u.length-1))},n);return()=>clearTimeout(e)}},[l,d,n,u.length]),(0,m.useEffect)(()=>{l?l&&d<i-1&&c(Math.max(0,i-1)):c(Math.max(0,i-1))},[u.length,i,l,d]);let p=(0,m.useMemo)(()=>{let e=l?d:Math.max(0,i-1);return u.slice(0,e+1).reverse()},[d,u,i,l]);return(0,a.jsx)("div",{className:(0,K.cn)("flex flex-col items-center gap-4",s),...r,children:(0,a.jsx)(o.N,{children:p.map((e,t)=>{let s=p.length-1-t,n=!l||s<i;return(0,a.jsx)(sz,{skipEntryAnimation:n,children:e},e.key)})})})});sP.displayName="AnimatedList";let sD=e=>{let{id:t,name:s,displayName:n,description:i,iconUrl:l,className:r}=e;return(0,a.jsx)("div",{className:(0,K.cn)("relative mx-auto min-h-fit w-full max-w-[400px] overflow-hidden rounded-3xl p-4","bg-card/60 backdrop-blur-xl border transition-all duration-200 ease-in-out hover:scale-[103%]",r),children:(0,a.jsxs)("div",{className:"flex flex-row items-center gap-3",children:[(0,a.jsx)(t5.z,{app:{id:t,iconUrl:l},className:"w-10 h-10 flex-shrink-0 rounded-2xl"}),(0,a.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[(0,a.jsx)("h5",{className:"text-sm font-medium line-clamp-1 overflow-hidden text-ellipsis",children:null!=n?n:s}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-2 overflow-hidden text-ellipsis",children:null!=i?i:"No description"})]})]})})};function sT(e){let{className:t,appHubContent:s,initialCount:n=4,startAnimation:i=!1}=e,l=(0,m.useMemo)(()=>{var e,t;return null!==(t=null==s?void 0:null===(e=s.appStoreApps)||void 0===e?void 0:e.flatMap(e=>{var t;return null!==(t=e.apps)&&void 0!==t?t:[]}))&&void 0!==t?t:[]},[s]),r=(0,m.useMemo)(()=>l.filter((e,t,s)=>t===s.findIndex(t=>t.id===e.id)),[l]),o=(0,m.useMemo)(()=>Array.from({length:20}).flatMap(()=>r),[r]);return(0,a.jsxs)("div",{className:(0,K.cn)("relative flex h-96 w-full flex-col overflow-hidden px-2",t),children:[(0,a.jsx)(sP,{delay:2e3,initialCount:n,startAnimation:i,children:o.map((e,t)=>(0,a.jsx)(sD,{...e},"".concat(e.id,"-").concat(t)))}),i&&(0,a.jsx)("div",{className:(0,K.cn)("pointer-events-none absolute bottom-0 left-0 right-0 h-8","backdrop-blur-sm","[mask-image:linear-gradient(to_top,black,transparent)]")})]})}let sU=e=>{let{items:t,direction:s="left",speed:n=150}=e,i=[...t,...t,...t,...t,...t,...t];return(0,a.jsx)("div",{className:"relative overflow-hidden",children:(0,a.jsx)(d.P.div,{animate:{x:"left"===s?["0%","-".concat(50,"%")]:["-".concat(50,"%"),"0%"]},className:"flex gap-2",style:{display:"inline-flex",whiteSpace:"nowrap"},transition:{duration:n,repeat:1/0,ease:"linear",repeatType:"loop"},children:i.map((e,t)=>(0,a.jsx)("div",{className:"flex-shrink-0",children:e},t))})})};var sV=s(38815);let sO=["your next side hustle","a meme machine","interactive stories","your personal storefront","an AI crush detector","an event RSVP page","a travel scrapbook","learning adventures"],sH=["your next side hustle","your own meme machine","new interactive stories","your personal storefront","an AI crush detector","an event RSVP page","a travel scrapbook","learning adventures"],s_=["your next side hustle","a meme machine","new interactive stories","your personal storefront","an AI crush detector","an event RSVP page","a travel scrapbook","learning adventures"];function s$(){let e=(0,H.dv)(),t="xs"===e?sO:"mobile"===e?sH:s_,[s,n]=(0,m.useState)(0),[i,l]=(0,m.useState)(!0);return(0,m.useEffect)(()=>{let e=setInterval(()=>{n(e=>(e+1)%t.length)},3e3);return()=>clearInterval(e)},[t]),(0,m.useEffect)(()=>{l(!1)},[]),(0,a.jsxs)("div",{className:"flex flex-col px-2 gap-4 items-start",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-0 w-full",children:[(0,a.jsx)("h1",{className:"w-fit text-5xl sm:text-5xl md:text-6xl text-left font-medium text-transparent bg-clip-text [background-image:var(--frost-gradient)] animate-frost tracking-[-0.03em]",children:"Create"}),(0,a.jsx)("div",{className:"h-auto w-full",children:(0,a.jsx)(o.N,{mode:"wait",children:(0,a.jsx)(d.P.h1,{animate:{opacity:1,y:0},className:"text-5xl sm:text-5xl md:text-6xl text-left w-full font-medium text-white tracking-[-0.03em]",exit:{opacity:0,y:-20},initial:i?{opacity:1,y:0}:{opacity:0,y:20},transition:{duration:.5},children:t[s]},s)})})]}),(0,a.jsx)("p",{className:"h-auto text-xl sm:text-3xl font-medium text-transparent bg-clip-text [background-image:var(--whisper-gradient)]",children:"Instantly online. Instantly shareable."})]})}let sB=e=>{let{videoUrl:t,posterUrl:s}=e,n=(0,m.useRef)(null),i=(0,m.useRef)(null),[l,r]=(0,m.useState)(!0),[o,d]=(0,m.useState)(!1),[c,u]=(0,m.useState)(!1),p=(0,m.useCallback)(()=>{u(e=>e||!0)},[]);return(0,m.useEffect)(()=>{let e=i.current;if(!e)return;let t=new IntersectionObserver(e=>{let[t]=e;t&&t.isIntersecting&&n.current&&(c||(n.current.muted=!0),n.current.play().catch(()=>{}),r(!1))},{rootMargin:"0px 0px -85% 0px"});return t.observe(e),()=>{t.unobserve(e),t.disconnect()}},[c]),(0,a.jsx)("div",{className:"w-full",ref:i,children:(0,a.jsx)("div",{className:"w-full aspect-video rounded-3xl",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(o),children:(0,a.jsxs)("video",{className:"w-full h-full object-cover rounded-3xl overflow-hidden",controls:l,loop:!0,playsInline:!0,poster:s,preload:"auto",ref:n,onPause:()=>{d(!1),p()},onPlay:()=>{d(!0),p()},onVolumeChange:p,children:[(0,a.jsx)("source",{src:t,type:"video/mp4"}),"Your browser does not support the video tag."]})})})},sW=e=>{let{onDismiss:t,appHubContent:s}=e,n=(0,sn.E)(e=>e.open),{currentUser:i}=(0,eI.A)(),l=[{icon:(0,a.jsx)(sS.A,{className:"h-4 w-4"}),text:"Hosting"},{icon:(0,a.jsx)(sE.A,{className:"h-4 w-4"}),text:"Integrations"},{icon:(0,a.jsx)(sI.A,{className:"h-4 w-4"}),text:"Storage"},{icon:(0,a.jsx)(sL.A,{className:"h-4 w-4"}),text:"Emails"},{icon:(0,a.jsx)(sM.A,{className:"h-4 w-4"}),text:"Monitoring"},{icon:(0,a.jsx)(e3.i0.stripe,{className:"h-3 w-auto text-[#635BFF]"}),text:"Payments"},{icon:(0,a.jsx)(e3.i0.claude,{className:"h-4 w-4 text-[#D97757]"}),text:"AI Capabilities"}],r=[{icon:(0,a.jsx)(sR.A,{className:"h-4 w-4"}),text:"Core AI features & capabilities"},{icon:(0,a.jsx)(sR.A,{className:"h-4 w-4"}),text:"Fully managed infrastructure"},{icon:(0,a.jsx)(sR.A,{className:"h-4 w-4"}),text:"Automated maintenance & error repair"},{icon:(0,a.jsx)(sR.A,{className:"h-4 w-4"}),text:"Seamless app interconnectivity"}],o=l.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-primary-foreground rounded-lg px-4 py-2",children:[e.icon,(0,a.jsx)("span",{className:"text-xs",children:e.text})]},e.text)),c=(0,m.useRef)(null),[u,p]=(0,m.useState)(!1);return(0,m.useEffect)(()=>{let e=new window.IntersectionObserver(e=>{let[t]=e;t&&t.isIntersecting&&p(!0)},{rootMargin:"0px 0px -20% 0px"});return c.current&&e.observe(c.current),()=>e.disconnect()},[]),(0,a.jsx)(d.P.div,{className:"fixed inset-0 z-30 flex items-start justify-center p-4 pt-0 md:pt-0 bg-transparent h-[calc(100vh-var(--sidebar-height,37px))] mt-[var(--sidebar-height,37px)] overflow-y-auto",children:(0,a.jsx)("div",{className:"w-full md:max-w-2xl mb-64 sm:mb-48",children:(0,a.jsxs)("div",{className:"flex flex-col h-full gap-2 pt-12 overflow-y-auto",children:[i&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(O.$n,{className:(0,K.cn)("flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground","bg-card/60 dark:bg-card/80 rounded-lg backdrop-blur-xl"),size:"sm",variant:"secondary",onClick:t,children:[(0,a.jsx)(sF.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),"Dismiss"]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-12",children:[(0,a.jsx)(s$,{}),(0,a.jsx)(sB,{posterUrl:"https://static.acflare.com/cover-test-artist.png",videoUrl:"https://static.acflare.com/Adaptive-4x3-H264.mp4"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col h-full pb-6 sm:pb-0 px-2 gap-8 items-start justify-start",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-8 w-full",children:[(0,a.jsx)("h1",{className:"w-fit text-3xl text-left font-medium text-transparent bg-clip-text [background-image:var(--frost-gradient)] animate-frost tracking-[-0.03em]",children:"Software that adapts to your words"}),(0,a.jsx)("div",{className:"h-auto w-full",children:(0,a.jsx)("h1",{className:"text-lg text-left w-full font-semibold sm:font-medium text-white tracking-[-0.03em]",children:"Create apps that connect and talk to each other. Remix and evolve ideas."})})]}),i&&(0,a.jsx)("p",{className:"h-auto text-lg font-medium text-transparent bg-clip-text [background-image:var(--whisper-gradient)]",children:"Welcome to your adaptive computer."}),!i&&(0,a.jsx)(O.$n,{className:"!sm:h-10 w-fit gap-1 rounded-lg !bg-black !hover:bg-black/80 shadow-button",size:"lg",onClick:t,children:(0,a.jsx)("span",{className:"text-sm font-semibold sm:font-medium text-transparent bg-clip-text [background-image:var(--whisper-gradient)]",children:"Open your adaptive computer"})})]}),(0,a.jsx)("div",{className:"w-full",ref:c,children:(0,a.jsx)(sT,{appHubContent:s,startAnimation:u})}),(0,a.jsx)("div",{className:"rounded-3xl border bg-card/60",children:(0,a.jsxs)(O.Zp,{className:"flex flex-col h-full gap-8 p-10 border-0 bg-transparent dark:bg-transparent backdrop-blur-none shadow-none",children:[(0,a.jsxs)(O.aR,{className:"p-0",children:[(0,a.jsx)(O.ZB,{className:"text-base font-normal",children:"Batteries included"}),(0,a.jsx)(O.BT,{className:"text-xs",children:"Everything you need to turn ideas into reality"})]}),(0,a.jsxs)(O.Wu,{className:"flex flex-col gap-4 p-0",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)(sU,{direction:"left",items:o}),(0,a.jsx)(sU,{direction:"right",items:o}),(0,a.jsx)(sU,{direction:"left",items:[...o].reverse()})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"No code. No setup. No service integration headaches."})]})]})}),!i&&(0,a.jsx)("div",{className:"rounded-3xl border bg-card/60",children:(0,a.jsxs)(O.Zp,{className:"flex flex-col h-full gap-8 p-10 border-0 bg-transparent dark:bg-transparent backdrop-blur-none shadow-none",children:[(0,a.jsxs)(O.aR,{className:"p-0",children:[(0,a.jsx)(O.ZB,{className:"text-base font-normal",children:"Start for free"}),(0,a.jsx)(O.BT,{className:"text-xs",children:"Individuals and small teams"})]}),(0,a.jsx)(O.Wu,{className:"flex flex-col gap-4 p-0",children:(0,a.jsx)("div",{className:"flex flex-col gap-4",children:r.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[e.icon,(0,a.jsx)("span",{className:"text-xs",children:e.text})]},e.text))})})]})}),i&&(0,a.jsx)("div",{className:"rounded-3xl border bg-gradient-to-br from-yellow-100/80 to-pink-200/80 dark:from-emerald-400/80 dark:to-sky-400/80",children:(0,a.jsxs)(O.Zp,{className:"flex flex-col h-full gap-8 p-10 border-0 bg-transparent dark:bg-transparent backdrop-blur-none shadow-none rounded-3xl",children:[(0,a.jsx)(O.aR,{className:"p-0",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(O.ZB,{className:"text-base font-normal",children:"Creator"}),(0,a.jsx)(O.BT,{className:"text-xs dark:text-foreground",children:"Creators and entrepreneurs"})]}),(0,a.jsxs)("div",{className:"flex items-baseline justify-end",children:[(0,a.jsx)("div",{className:"text-2xl font-medium",children:"$20"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"/mo"})]})]})}),(0,a.jsx)(O.Wu,{className:"flex flex-col gap-4 p-0",children:(0,a.jsx)("p",{className:"text-xs",children:"Upgrade as you grow and build unlimited apps plus get access to pro app features"})}),(0,a.jsx)(O.wL,{className:"flex justify-end gap-2 p-0",children:(0,a.jsx)(O.$n,{size:"sm",onClick:n,children:"Upgrade"})})]})})]}),(0,a.jsx)(sV.w,{className:"w-full"})]})]})})})};var sJ=s(33534),sQ=s(26298),sG=s(47236),sq=s(34528),sY=s(88500),sK=s(9683),sZ=s(32925),sX=s(38408),s0=s(36628),s1=s(21975);let s2=F.z.object({isPublic:F.z.boolean().nullish(),isPaid:F.z.boolean().nullish(),displayName:F.z.string().nullish(),description:F.z.string().nullish(),iconUrl:F.z.string().nullish(),isForkable:F.z.boolean().nullish(),customDomain:F.z.string().or(F.z.null())});function s4(e){var t,s,i,r,o,d,c,h,x,v,g,f;let{appId:j,onClose:b}=e,w=(0,u.useRouter)(),{toast:y}=(0,O.dj)(),N=(0,H.al)(),A=q.F.useUtils(),C=q.F.getAppAccessInfo.useQuery({id:j}),S=(null===(t=C.data)||void 0===t?void 0:t.accessLevel)==eL.AclLevel.OWNER||(null===(s=C.data)||void 0===s?void 0:s.accessLevel)==eL.AclLevel.EDITOR,E=q.F.generateAppIcon.useMutation({onSuccess:e=>{let{iconUrl:t}=e;F.setValue("iconUrl",t,{shouldDirty:!0}),F.trigger()}}),{uploadFile:I,isLoading:L}=t7({appId:j}),M=(0,m.useRef)(null);async function R(e){var t;let s=(null===(t=e.target)||void 0===t?void 0:t.files)?e.target.files[0]:null;if(s){let e=await I(s);F.setValue("iconUrl",e,{shouldDirty:!0}),F.trigger()}}let F=(0,p.mN)({resolver:(0,n.u)(s2),defaultValues:{displayName:"",description:"",iconUrl:"",isPublic:!1,isForkable:!0,customDomain:null}}),z=q.F.getAppUsageStats.useQuery({appId:j},{enabled:!!S}),[P,D]=(0,m.useState)(!1),{data:T,isLoading:U}=q.F.getCustomDomainStatus.useQuery({appId:j},{refetchInterval:5e3,enabled:!!S&&e.isOpen,onSuccess:e=>{if(!F.getFieldState("customDomain").isDirty&&!P){var t;D(!!(null==e?void 0:e.customDomain)),F.setValue("customDomain",null!==(t=null==e?void 0:e.customDomain)&&void 0!==t?t:null,{shouldDirty:!1})}}}),V=q.F.setCustomDomain.useMutation({onSuccess:()=>{A.getAppById.invalidate(),A.getCustomDomainStatus.invalidate()},onError:e=>{y({title:"Could not update custom domain",description:e.message,variant:"destructive"})}}),_=q.F.getAppSettings.useQuery({id:j},{enabled:!!S}),$=q.F.updateAppSettings.useMutation({onSuccess:()=>{A.getAppSettings.invalidate(),A.getAppById.invalidate()},onError:e=>{y({title:"Could not update settings",description:e.message,variant:"destructive"})}});(0,m.useEffect)(()=>{if(_.data){var e;F.reset({...null!==(e=_.data)&&void 0!==e?e:{}})}},[F,_.data]);let B=q.F.deleteApp.useMutation({onSuccess:()=>{e.onOpenChange(!1),w.push((0,eP.$_)()),y({title:"App deleted"})},onError:e=>{y({title:"Could not delete app",description:e.message,variant:"destructive"})}});async function W(t){await $.mutateAsync({id:j,...(0,sZ.A)(t,["displayName","description","iconUrl","isPublic","isForkable"])}),await V.mutateAsync({appId:j,domain:P?t.customDomain:null}),e.onOpenChange(!1),null==b||b(),y({title:"Updated app"})}let J=(0,s1.qg)("http://"+F.getValues("customDomain")).subdomain,[Q,G]=(0,m.useState)(!1),{getUserPreference:Y}=(0,eI.A)(),Z=Y(eL.PreferenceKind.SYS_PLANS_ENABLED,!1),X=null===(i=z.data)||void 0===i?void 0:i.proFeatures.map(e=>{switch(e){case"EMAIL":return"email sending";case"DOMAIN":return"custom domain";case"PAYMENTS":return"payment processing";case"ACU":return"high compute (ACUs)"}}).join(", "),ee=t=>{if(!t&&F.formState.isDirty){G(!0);return}e.onOpenChange(t),t||null==b||b()},et=async()=>{await F.handleSubmit(W)(),G(!1),e.onOpenChange(!1),null==b||b()},es=(0,a.jsx)(a.Fragment,{children:_.isLoading?(0,a.jsxs)("div",{className:"space-y-8 mt-8",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.EA,{className:"h-6 w-24"})," ",(0,a.jsx)(O.EA,{className:"h-24 w-24"})," "]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.EA,{className:"h-6 w-24"})," ",(0,a.jsx)(O.EA,{className:"h-10 w-full"})," "]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.EA,{className:"h-6 w-24"})," ",(0,a.jsx)(O.EA,{className:"h-10 w-full"})," ",(0,a.jsx)(O.EA,{className:"h-4 w-3/4"})," "]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.EA,{className:"h-6 w-24"})," ",(0,a.jsx)(O.EA,{className:"h-4 w-48"})," "]}),(0,a.jsx)(O.EA,{className:"h-6 w-12"})," "]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.EA,{className:"h-6 w-24"})," ",(0,a.jsx)(O.EA,{className:"h-4 w-48"})," "]}),(0,a.jsx)(O.EA,{className:"h-6 w-12"})," "]}),(0,a.jsx)("div",{className:"flex flex-col gap-2 rounded-lg border p-4",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.EA,{className:"h-6 w-32"})," ",(0,a.jsx)(O.EA,{className:"h-4 w-48"})," "]}),(0,a.jsx)(O.EA,{className:"h-6 w-12"})," "]})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.EA,{className:"h-6 w-24"})," ",(0,a.jsx)(O.EA,{className:"h-4 w-48"})," "]}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.EA,{className:"h-4 w-24"}),(0,a.jsx)(O.EA,{className:"h-4 w-24"}),(0,a.jsx)(O.EA,{className:"h-4 w-24"})]})})]})]}),(0,a.jsx)("div",{className:"space-y-4 mt-8",children:(0,a.jsx)("div",{className:"flex flex-col gap-2 rounded-lg border p-4",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.EA,{className:"h-6 w-32"})," ",(0,a.jsx)(O.EA,{className:"h-4 w-48"})," "]}),(0,a.jsx)(O.EA,{className:"h-9 w-24"})," "]})})})]}):(0,a.jsx)(O.lV,{...F,children:(0,a.jsxs)("form",{className:"flex flex-col flex-1",onSubmit:F.handleSubmit(W),children:[(0,a.jsxs)("div",{className:"space-y-8 flex-1 pb-8",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(O.zB,{control:F.control,name:"iconUrl",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Icon"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)("div",{className:"flex flex-row gap-2 overflow-x-auto whitespace-nowrap",children:(0,a.jsxs)(t5.z,{app:{id:"hello",iconUrl:null!==(t=s.value)&&void 0!==t?t:null},className:"".concat(E.isLoading?"animate-pulse":""," w-24 h-24 flex-none cursor-pointer group"),children:[(0,a.jsx)(O.$n,{className:"absolute top-2 right-2 z-50 sm:opacity-0 group-hover:opacity-100 transition-opacity",disabled:E.isLoading,size:"iconSm",type:"button",variant:"secondary",onClick:async()=>{E.isLoading||E.mutate({id:j})},children:(0,a.jsx)(sX.A,{className:"h-3 w-3 ".concat(E.isLoading?"animate-spin":"")})}),(0,a.jsx)(O.$n,{className:"absolute top-10 right-2 z-50 sm:opacity-0 group-hover:opacity-100 transition-opacity",disabled:L,size:"iconSm",type:"button",variant:"secondary",onClick:()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.click()},children:L?(0,a.jsx)(k.A,{className:"h-3 w-3 animate-spin"}):(0,a.jsx)(s0.A,{className:"h-3 w-3"})}),(0,a.jsx)(O.pd,{accept:"image/*",className:"hidden",disabled:L,id:"image",name:"image",ref:M,type:"file",onChange:R})]},s.value)})}),(0,a.jsx)(O.C5,{})]})}}),(0,a.jsx)(O.zB,{control:F.control,name:"displayName",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Display name"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",placeholder:"Laundry Buddy",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.C5,{})]})}}),(0,a.jsx)(O.zB,{control:F.control,name:"description",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Description"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",placeholder:"A laundry app that helps you do your laundry",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.Rr,{children:"The name and description for this app that will be displayed publicly across the platform."}),(0,a.jsx)(O.C5,{})]})}})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(O.zB,{control:F.control,name:"isPublic",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-4 space-x-2",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.lR,{children:"Explore"}),(0,a.jsx)(O.Rr,{children:"List this app on the public app directory."})]}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.dO,{checked:null!==(t=s.value)&&void 0!==t&&t,onChange:s.onChange})})]})}}),(0,a.jsx)(O.zB,{control:F.control,name:"isForkable",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.lR,{children:"Remixing"}),(0,a.jsx)(O.Rr,{children:"Allow others with access to remix this app."})]}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.dO,{checked:null!==(t=s.value)&&void 0!==t&&t,onChange:s.onChange})})]})}}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsxs)(O.lR,{className:"flex flex-row items-center gap-2",children:["Custom domain"," ",(0,a.jsx)("a",{href:(0,eP.$_)()+"/docs/domains",target:"_blank",children:(0,a.jsx)(ej.A,{className:"w-4 h-4 text-muted-foreground"})})]}),(0,a.jsx)(O.Rr,{children:"Assign a personalized domain to your app."})]}),(0,a.jsx)(O.MJ,{children:U?(0,a.jsx)(O.EA,{className:"w-24 h-6"}):(0,a.jsx)(O.dO,{checked:P,onChange:()=>{P&&F.setValue("customDomain","",{shouldDirty:!0,shouldValidate:!0}),D(!P)}})})]}),P&&U?(0,a.jsx)(O.EA,{className:"w-24 h-6"}):P&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.zB,{control:F.control,name:"customDomain",render:e=>{var t,s;let{field:n}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.pd,{placeholder:"example.com",value:null!==(s=n.value)&&void 0!==s?s:"",onChange:n.onChange}),(null===(t=n.value)||void 0===t?void 0:t.startsWith("*"))&&(0,a.jsx)(O.C5,{children:"Wildcard domains are not supported."})]})}}),(null==T?void 0:T.cname)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(O.Rr,{children:["Create a CNAME record"," ",(0,a.jsx)("code",{className:"text-foreground",children:J||"@"})," ","in your DNS settings:"]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)("code",{className:"text-sm truncate",children:null==T?void 0:T.cname}),(null==T?void 0:T.status)&&(0,a.jsx)(O.Bc,{children:(0,a.jsxs)(O.m_,{children:[(0,a.jsx)(O.k$,{children:(0,a.jsx)("div",{className:(0,K.cn)("h-2 w-2 rounded-full cursor-pointer",{"bg-warning":(null==T?void 0:T.status)!="active","bg-green-500":(null==T?void 0:T.status)=="active"})})}),(0,a.jsx)(O.ZI,{children:(0,sK.A)(null!==(v=null==T?void 0:T.status)&&void 0!==v?v:"pending").replace("_"," ")})]})}),(0,a.jsx)(O.$n,{size:"sm",variant:"outline",onClick:e=>{e.preventDefault(),l()(null==T?void 0:T.cname),y({title:"Copied to clipboard"})},children:(0,a.jsx)(eg.A,{className:"w-3 h-3"})})]}),!!(null===(r=F.getValues("customDomain"))||void 0===r?void 0:r.length)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(O.Rr,{children:["Create a CNAME record"," ",(0,a.jsxs)("code",{className:"text-foreground",children:["_acme-challenge",J?"."+J:""]})," ","for verification:"]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between",children:[(0,a.jsx)("code",{className:"text-sm truncate",children:F.getValues("customDomain")+".ccc402cae2fcbd25.dcv.cloudflare.com"}),(0,a.jsx)(O.$n,{size:"sm",variant:"outline",onClick:e=>{e.preventDefault(),l()(F.getValues("customDomain")+".ccc402cae2fcbd25.dcv.cloudflare.com"),y({title:"Copied to clipboard"})},children:(0,a.jsx)(eg.A,{className:"w-3 h-3"})})]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 rounded-lg border p-4",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsxs)(O.lR,{className:"flex flex-row items-center justify-between",onClick:e=>{e.stopPropagation(),e.preventDefault()},children:[(0,a.jsx)("span",{children:"Usage"}),Z&&z.data&&(0,a.jsx)(O.Ex,{children:(null===(o=z.data)||void 0===o?void 0:o.appTier)==eL.AppTier.FREE?"Standard":"Premium"})]}),(0,a.jsxs)(O.Rr,{children:["This apps platform usage for ",(0,sY.GP)(new Date,"MMMM")," ","is"," ",(0,a.jsxs)("strong",{children:[null===(d=z.data)||void 0===d?void 0:d.total.toFixed()," /"," ",Z&&(null!==(g=null===(c=z.data)||void 0===c?void 0:c.limit)&&void 0!==g?g:0)!=Number.MAX_SAFE_INTEGER?null!==(f=null===(h=z.data)||void 0===h?void 0:h.limit.toFixed())&&void 0!==f?f:100:"∞"]})," ","ACUs."]})]}),Z&&z.data&&(0,a.jsx)(O.ke,{className:z.data.total>z.data.limit?"bg-warning":"",value:(z.data.total>z.data.limit?z.data.limit/z.data.total:z.data.total/z.data.limit)*100}),Z&&X&&(0,a.jsxs)(O.Rr,{children:["Premium features: ",X,"."]}),z.data&&z.data.overage>0&&z.data.appTier==eL.AppTier.CUSTOM&&(0,a.jsxs)(O.Rr,{className:"text-warning",children:["You are ",null===(x=z.data)||void 0===x?void 0:x.overage.toFixed()," ACUs over your limit. Please contact support to enable usage based billing."]})]})]}),(0,a.jsx)("div",{className:"space-y-4 mt-8",children:(0,a.jsx)("div",{className:"flex flex-col rounded-lg border p-4",children:(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"space-y-0.5",children:[(0,a.jsx)(O.lR,{className:"text-destructive",children:"Danger Zone"}),(0,a.jsx)(O.Rr,{children:"Permanently delete this app and all its data."})]}),(0,a.jsxs)(O.$n,{disabled:B.isLoading,size:"sm",type:"button",variant:"destructive",onClick:()=>{window.confirm("Are you sure you want to delete this app? This action cannot be undone.")&&B.mutate({id:j})},children:[B.isLoading?(0,a.jsx)(k.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5 animate-spin"}):(0,a.jsx)(sv.A,{className:"w-4 h-4 sm:w-3.5 sm:h-3.5"}),"Delete app"]})]})})})]}),F.formState.isDirty&&(0,a.jsx)("div",{className:"sticky bottom-0 bg-background/80 backdrop-blur-lg py-4 border-t mt-8 -mx-4 px-4",children:(0,a.jsx)(O.$n,{className:"w-full",type:"submit",children:"Save Changes"})})]})})});return(0,a.jsxs)(a.Fragment,{children:[N?(0,a.jsxs)(O._s,{open:e.isOpen,onOpenChange:ee,children:[(0,a.jsx)(O.$n,{size:"sm",variant:"ghost",onClick:()=>e.onOpenChange(!0),children:"Settings"}),(0,a.jsxs)(O.zj,{className:"h-svh overflow-auto",children:[(0,a.jsxs)(O.BE,{className:"text-left",children:[(0,a.jsx)(O.gk,{children:"App settings"}),(0,a.jsx)(O.I6,{children:"Customize your app's name and appearance and manage who can access it."})]}),(0,a.jsx)("div",{className:"px-4",children:es})]})]}):(0,a.jsxs)(O.cj,{open:e.isOpen,onOpenChange:ee,children:[(0,a.jsx)(O.CG,{asChild:!0,children:(0,a.jsx)(O.$n,{size:"sm",variant:"ghost",children:"Settings"})}),(0,a.jsxs)(O.h,{className:"h-svh overflow-auto flex flex-col p-6 pb-0",children:[(0,a.jsxs)(O.Fm,{children:[(0,a.jsx)(O.qp,{children:"App settings"}),(0,a.jsx)(O.Qs,{children:"Customize your app's name and appearance and manage who can access it."})]}),es]})]}),(0,a.jsx)(O.Lt,{open:Q,onOpenChange:G,children:(0,a.jsxs)(O.EO,{children:[(0,a.jsxs)(O.wd,{children:[(0,a.jsx)(O.r7,{children:"You have unsaved changes"}),(0,a.jsx)(O.$v,{children:"Would you like to save your changes before closing?"})]}),(0,a.jsxs)(O.ck,{children:[(0,a.jsx)(O.Zr,{onClick:()=>{G(!1),F.reset(),e.onOpenChange(!1),null==b||b()},children:"Discard changes"}),(0,a.jsx)(O.Rx,{onClick:et,children:"Save changes"})]})]})})]})}var s5=s(9966);let s3=F.z.object({name:F.z.string(),handle:F.z.string(),image:F.z.string().nullish(),email:F.z.string().nullish(),emailCode:F.z.string().optional(),phoneNumber:F.z.string().nullish(),phoneCode:F.z.string().optional()});function s6(e){var t,s,i,l,r,o,d,c,u,h;let{className:x,avatarClassName:v,userId:g,isOpen:f,onOpenChange:j,disabled:b}=e,{toast:w}=(0,O.dj)(),y=(0,H.al)(),[N,A]=(0,m.useState)(null!=f&&f),C=q.F.useUtils(),{currentUser:S,logout:E,getUserPreference:I,setUserPreference:L}=(0,eI.A)(),M=(0,sn.E)(e=>e.open),R=q.F.sendPhoneVerification.useMutation({onSuccess:()=>{w({title:"Sent verification code"})},onError:e=>{w({title:"Failed to send verification code",description:e?e.message:"",variant:"destructive"})}}),F=q.F.sendEmailVerification.useMutation({onSuccess:()=>{w({title:"Sent verification code"})},onError:e=>{w({title:"Failed to send verification code",description:e?e.message:"",variant:"destructive"})}}),z=q.F.updateUserProfile.useMutation({onSuccess:async e=>{var t,s;await C.getUser.invalidate({id:e.id}),U.reset(e),R.reset(),F.reset(),(null===(t=e.mergedUser)||void 0===t?void 0:t.email)?w({title:"Updated profile & merged account",description:"This account was successfully merged with another account with the email "+e.mergedUser.email}):(null===(s=e.mergedUser)||void 0===s?void 0:s.phoneNumber)?w({title:"Updated profile & merged account",description:"This account was successfully merged with another account with the phone number "+e.mergedUser.phoneNumber}):w({title:"Updated profile"})},onError:e=>{w({title:"Failed to update profile",description:e?e.message:"",variant:"destructive"})}}),P=I(eL.PreferenceKind.FORCE_DARKMODE,!1),D=I(eL.PreferenceKind.FORCE_LIGHTMODE,!1),T=async e=>{"dark"==e?(await L(eL.PreferenceKind.FORCE_DARKMODE,!0),L(eL.PreferenceKind.FORCE_LIGHTMODE,!1)):"light"==e?(await L(eL.PreferenceKind.FORCE_LIGHTMODE,!0),L(eL.PreferenceKind.FORCE_DARKMODE,!1)):(await L(eL.PreferenceKind.FORCE_DARKMODE,!1),L(eL.PreferenceKind.FORCE_LIGHTMODE,!1)),w({title:"Updated theme preference please refresh the page"})},U=(0,p.mN)({resolver:(0,n.u)(s3)}),V=q.F.getUser.useQuery({id:null!=g?g:S?S.id:void 0}),_=V.data,$=S&&_&&S.id==_.id,{uploadFile:B,isLoading:W}=t7(),J=(0,m.useRef)(null),Q=q.F.getPaymentAccount.useQuery(void 0,{enabled:N}),G=q.F.getPaymentAccountSetupLink.useMutation(),Y=null===(t=G.data)||void 0===t?void 0:t.url,K=q.F.getPurchases.useQuery(void 0,{enabled:N}),Z=q.F.getUserLimits.useQuery(void 0,{enabled:N}),X=I(eL.PreferenceKind.SYS_PLANS_ENABLED,!1);async function ee(e){await z.mutateAsync(e),A(!1)}async function et(e){var t;let s=(null===(t=e.target)||void 0===t?void 0:t.files)?e.target.files[0]:null;if(s)try{let e=await B(s);await z.mutateAsync({image:e}),w({title:"Uploaded profile photo"})}catch(e){w({title:"Failed to upload profile photo",description:e?e.message:"",variant:"destructive"})}}(0,m.useEffect)(()=>{N&&V.data&&(U.reset(V.data),R.reset(),F.reset())},[N]),(0,m.useEffect)(()=>{G.isIdle&&!Q.isLoading&&G.mutate({returnUrl:window.location.href})},[null===(s=Q.data)||void 0===s?void 0:s.enabled,Q.isLoading,G]),(0,m.useEffect)(()=>{void 0!==f&&A(f)},[f]);let es=q.F.generateUserProfileImage.useMutation();async function ea(){try{var e;let{imageUrl:t}=await es.mutateAsync({id:null!==(e=null!=g?g:null==S?void 0:S.id)&&void 0!==e?e:""});await z.mutateAsync({image:t}),w({title:"Created new profile photo"})}catch(e){w({title:"Failed to create new profile photo",description:e?e.message:"",variant:"destructive"})}}if(V.isLoading||b)return(0,a.jsx)("div",{className:x,children:(0,a.jsxs)(O.$n,{className:"flex h-9 w-9 sm:h-7 sm:w-auto gap-1 rounded-xl sm:rounded-lg hover:bg-accent/80",disabled:!0,size:"sm",variant:"ghost",children:[(0,a.jsx)(sJ.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 md:hidden"}),(0,a.jsx)("span",{className:"hidden sm:hidden md:inline",children:"Profile"})]})});if(!$)return(0,a.jsx)("div",{className:x,children:(0,a.jsx)(eE,{avatarClassName:v,user:_})});let en=(0,a.jsx)(O.lV,{...U,children:(0,a.jsxs)("form",{className:"space-y-8 mt-0 sm:mt-8",onKeyDown:e=>{"Enter"===e.key&&!e.shiftKey&&U.formState.isDirty&&U.formState.isValid&&(e.preventDefault(),U.handleSubmit(ee)())},onSubmit:U.handleSubmit(ee),children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex flex-row gap-2 overflow-x-auto whitespace-nowrap",children:(0,a.jsxs)("div",{className:"".concat(es.isLoading?"animate-pulse":""," w-24 h-24 flex-none relative cursor-pointer group"),children:[(0,a.jsx)(eE,{avatarClassName:"h-24 w-24 rounded-3xl",user:_}),(0,a.jsx)(O.$n,{className:"absolute top-2 right-2 z-50 sm:opacity-0 group-hover:opacity-100 transition-opacity",disabled:es.isLoading,size:"iconSm",type:"button",variant:"secondary",onClick:ea,children:(0,a.jsx)(sX.A,{className:"h-3 w-3 ".concat(es.isLoading?"animate-spin":"")})}),(0,a.jsx)(O.$n,{className:"absolute top-10 right-2 z-50 sm:opacity-0 group-hover:opacity-100 transition-opacity",disabled:W,size:"iconSm",type:"button",variant:"secondary",onClick:()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.click()},children:W?(0,a.jsx)(k.A,{className:"h-3 w-3 animate-spin"}):(0,a.jsx)(s0.A,{className:"h-3 w-3"})}),(0,a.jsx)(O.pd,{accept:"image/*",className:"hidden",disabled:W,id:"image",name:"image",ref:J,type:"file",onChange:et})]})}),(0,a.jsx)(O.zB,{control:U.control,name:"name",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Name"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",placeholder:"Steely Dan",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.C5,{})]})}}),(0,a.jsx)(O.zB,{control:U.control,name:"handle",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Handle"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",placeholder:"@dan",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.Rr,{children:"This is how people will find you on adaptive.ai"}),(0,a.jsx)(O.C5,{})]})}}),(0,a.jsx)(O.zB,{control:U.control,name:"email",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Email address"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",placeholder:"vivian@example.com",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.C5,{})]})}}),U.formState.dirtyFields.email&&U.getValues().email&&(0,a.jsx)(O.zB,{control:U.control,name:"emailCode",render:e=>{var t;let{field:s}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(O.eI,{className:"flex flex-row gap-2 space-y-0",children:[F.isSuccess&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",className:"flex-1",placeholder:"Your verification code",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.C5,{})]}),!F.isSuccess&&(0,a.jsxs)(O.$n,{type:"button",variant:"outline",onClick:()=>{U.getValues().email&&F.mutate({email:U.getValues().email})},children:[(0,a.jsx)(s5.A,{className:"h-4 w-4 mr-2"})," Send code"]})]})})}}),(0,a.jsx)(O.zB,{control:U.control,name:"phoneNumber",render:e=>{var t;let{field:s}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"Phone number"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",placeholder:"+1 (234) 567 8901",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:"",onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),s.value&&R.mutate({phoneNumber:s.value}))}})}),(0,a.jsx)(O.C5,{})]})}}),U.formState.dirtyFields.phoneNumber&&U.getValues().phoneNumber&&(0,a.jsx)(O.zB,{control:U.control,name:"phoneCode",render:e=>{var t;let{field:s}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(O.eI,{className:"flex flex-row gap-2 space-y-0",children:[R.isSuccess&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.MJ,{children:(0,a.jsx)(O.pd,{autoComplete:"off",className:"flex-1",placeholder:"Your verification code",type:"text",...s,value:null!==(t=s.value)&&void 0!==t?t:""})}),(0,a.jsx)(O.C5,{})]}),!R.isSuccess&&(0,a.jsxs)(O.$n,{type:"button",variant:"outline",onClick:()=>{U.getValues().phoneNumber&&R.mutate({phoneNumber:U.getValues().phoneNumber})},children:[(0,a.jsx)(s5.A,{className:"h-4 w-4 mr-2"})," Send code"]})]})})}}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Enter your phone number to chat with apps via SMS. You can opt out at any time by replying STOP or removing your phone number from your profile. Rates may apply."}),(0,a.jsx)("div",{className:"h-4"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm mb-3 font-medium",children:"Theme"}),(0,a.jsxs)(O.l6,{defaultValue:P?"dark":D?"light":"system",onValueChange:e=>void T(e),children:[(0,a.jsx)(O.bq,{children:(0,a.jsx)(O.yv,{placeholder:"Theme"})}),(0,a.jsxs)(O.gC,{children:[(0,a.jsx)(O.eb,{value:"light",children:"Light"}),(0,a.jsx)(O.eb,{value:"dark",children:"Dark"}),(0,a.jsx)(O.eb,{value:"system",children:"System"})]})]})]}),(0,a.jsx)("div",{className:"h-4"}),(0,a.jsx)("div",{className:"text-sm mb-3 font-medium",children:"Purchases"}),(0,a.jsxs)("div",{className:"flex flex-col rounded-lg border",children:[K.isLoading&&(0,a.jsx)(O.EA,{className:"h-[54px] rounded-md"}),!K.isLoading&&!(null===(i=K.data)||void 0===i?void 0:i.length)&&(0,a.jsxs)("div",{className:"p-8 text-center text-xs text-muted-foreground",children:["You haven","'","t purchased any in-app products yet"]}),(null===(l=K.data)||void 0===l?void 0:l.length)?(0,a.jsx)(a.Fragment,{children:K.data.map(e=>{var t,s;return(0,a.jsxs)("a",{className:"flex flex-1 flex-row gap-2 items-center border-b last:border-b-0 px-3 py-2 hover:underline",href:"/purchase/".concat(e.product.id),target:"_blank",children:[(0,a.jsx)("img",{alt:e.product.app.name,className:"h-4 w-4 rounded-sm",src:null!==(t=e.product.app.iconUrl)&&void 0!==t?t:""}),(0,a.jsxs)("div",{className:"text-sm",children:[null!==(s=e.product.app.displayName)&&void 0!==s?s:e.product.app.name,":"]}),(0,a.jsx)("div",{className:"flex-1 text-muted-foreground text-sm truncate",children:e.product.name}),(0,a.jsxs)(O.Ex,{variant:"outline",children:["$",(e.product.price/100).toFixed(2),e.product.kind==eL.ProductKind.SUBSCRIPTION?"/m":""]})]},e.id)})}):null]}),X&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-4"}),(0,a.jsxs)("div",{className:"flex flex-col items-start",children:[(0,a.jsx)("div",{className:"text-sm mb-3 font-medium",children:"Platform plans"}),(0,a.jsx)(O.$n,{variant:"outline",onClick:async e=>{e.preventDefault(),e.stopPropagation(),A(!1),M()},children:(null===(r=Z.data)||void 0===r?void 0:r.tier)==eL.UserTier.FREE?"Upgrade your plan":"Manage your plan"}),(0,a.jsxs)("div",{className:"text-sm mt-2 text-muted-foreground",children:[(null===(o=Z.data)||void 0===o?void 0:o.tier)==eL.UserTier.FREE?"You are on the free plan.":(null===(d=Z.data)||void 0===d?void 0:d.tier)==eL.UserTier.ONE?"You are on the Creator plan.":"You are on the Pro plan."," ",(null===(c=Z.data)||void 0===c?void 0:c.tier)==eL.UserTier.FREE?"Unlock more features with a paid plan.":(null===(u=Z.data)||void 0===u?void 0:u.tier)==eL.UserTier.ONE?"Get unlimited apps and messages with the Pro plan.":"You have access to all features."]})]})]}),(0,a.jsx)("div",{className:"h-4"}),(0,a.jsxs)("div",{className:"flex flex-col items-start justify-between",children:[(0,a.jsx)("div",{className:"text-sm mb-3 font-medium",children:"Creator monetization"}),(null===(h=Q.data)||void 0===h?void 0:h.enabled)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.$n,{variant:"outline",onClick:e=>{e.preventDefault(),e.stopPropagation(),Y&&window.open(Y,"_blank")},children:"Manage payment account"}),(0,a.jsx)("div",{className:"text-sm mt-2 text-muted-foreground",children:"Monetize your apps with subscriptions and in-app purchases."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(O.$n,{variant:"outline",onClick:e=>{e.preventDefault(),e.stopPropagation(),Y&&(window.location.href=Y)},children:"Setup payment account"}),(0,a.jsx)("div",{className:"text-xs mt-2 text-muted-foreground",children:"Accept payments in your apps via subscriptions and in-app purchases."})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-start gap-2 mt-8",children:[(0,a.jsx)(O.$n,{className:"",type:"button",variant:"outline",onClick:()=>window.confirm("Are you sure you want to log out?")&&E(),children:"Log Out"}),(0,a.jsx)(O.$n,{disabled:!U.formState.isDirty||!U.formState.isValid||V.isLoading,type:"submit",onClick:()=>{U.handleSubmit(ee)(),A(!1)},children:"Save Changes"})]})]})});return(0,a.jsx)("div",{className:x,children:y?(0,a.jsxs)(O._s,{open:N,onOpenChange:e=>{A(e),null==j||j(e)},children:[(0,a.jsxs)(O.$n,{"data-user-profile-trigger":!0,size:"sm",variant:"ghost",onClick:()=>{A(!0),null==j||j(!0)},children:[(0,a.jsx)(sJ.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 md:hidden"}),(0,a.jsx)("span",{className:"hidden sm:hidden md:inline",children:"Profile"})]}),(0,a.jsxs)(O.zj,{className:"h-svh overflow-auto",children:[(0,a.jsxs)(O.BE,{className:"text-left",children:[(0,a.jsx)(O.gk,{children:"Edit profile"}),(0,a.jsx)(O.I6,{children:"Update your info, and upload a profile picture."})]}),(0,a.jsx)("div",{className:"px-4",children:en})]})]}):(0,a.jsxs)(O.cj,{open:N,onOpenChange:e=>{A(e),null==j||j(e)},children:[(0,a.jsx)(O.CG,{asChild:!0,children:(0,a.jsxs)(O.$n,{size:"sm",variant:"ghost",children:[(0,a.jsx)(sJ.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5 md:hidden"}),(0,a.jsx)("span",{className:"hidden sm:hidden md:inline",children:"Profile"})]})}),(0,a.jsxs)(O.h,{className:"h-svh overflow-auto",children:[(0,a.jsxs)(O.Fm,{children:[(0,a.jsx)(O.qp,{children:"Edit profile"}),(0,a.jsx)(O.Qs,{children:"Update your info, and upload a profile picture."})]}),en]})]})})}var s8=s(85275),s9=s(72641);function s7(e){var t,s,n,i,l,r,o,c,u,p;let{view:h,currentUser:x,onAboutClick:v,isSendingMessage:g=!1,chatLog:f=[],goonStatus:j,isLanding:b=!1,disableOptions:w=!1,...y}=e,{toast:N}=(0,O.dj)(),{isGoonbarHidden:k,showOpenGoonbarButton:A,setIsGoonbarHidden:C,setShowOpenGoonbarButton:S}=J(),E=q.F.deleteGoonStatus.useMutation({onSuccess:()=>{P.getAppChatMessages.invalidate()}}),[I,L]=(0,m.useState)(!1),[M,R]=(0,m.useState)(!1),[F,z]=(0,m.useState)(!1),P=q.F.useUtils(),{autoRepair:D}=es({appId:null!==(c=y.appId)&&void 0!==c?c:null}),T=q.F.getAppById.useQuery({id:y.appId},{keepPreviousData:!0,onError:e=>{N({title:"Error",description:e.message,variant:"destructive"})},refetchInterval:5e3,enabled:!!y.appId}),U=T.data,V=q.F.getAppAccessInfo.useQuery({id:y.appId},{enabled:!!y.appId}),H=(null===(t=V.data)||void 0===t?void 0:t.accessLevel)==eL.AclLevel.OWNER||(null===(s=V.data)||void 0===s?void 0:s.accessLevel)==eL.AclLevel.EDITOR,_=(null===(n=V.data)||void 0===n?void 0:n.accessLevel)==eL.AclLevel.VIEWER;(0,m.useEffect)(()=>{let e=e=>{"autoRepair"===e.data.type&&D()};return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[D]);let{currentVersionId:B,switchVersion:W}=ez(),Y=!(null==U?void 0:U.latestVersionId)||!B||U.latestVersionId===B;(0,m.useEffect)(()=>{(null==U?void 0:U.latestVersionId)&&!y.hasRecentAppInteractions&&!Y&&W({versionId:null==U?void 0:U.latestVersionId,replace:!0,kind:"auto"})},[y.hasRecentAppInteractions,Y,null==U?void 0:U.latestVersionId,W]);let Z=q.F.exportApp.useMutation({onSuccess(e){(0,s9.I)(e,"".concat(e.name,"-").concat(B,".ac1"))}});(0,m.useEffect)(()=>{let e=()=>{S(!0)};window.addEventListener("goonbar-exit-complete",e);let t=()=>{S(!1)};return window.addEventListener("goonbar-entry-complete",t),()=>{window.removeEventListener("goonbar-exit-complete",e),window.removeEventListener("goonbar-entry-complete",t)}},[S]),(0,m.useEffect)(()=>{k||S(!1)},[k,S]);let X="",ee=f.filter(e=>"status"===e.kind&&"object"==typeof e.status&&null!==e.status&&"kind"in e.status&&"tool"===e.status.kind&&"status"in e.status).sort((e,t)=>t.timestamp-e.timestamp);ee.length>0&&(X=ee[0].status.status||"");let et=g&&X;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex flex-col h-auto w-full top-0 z-50",ref:e=>{if(e){let t=e.getBoundingClientRect().height;e.style.setProperty("--computed-height","".concat(t,"px"))}},style:{"--topbar-height":"var(--computed-height)"},children:(0,a.jsx)("div",{className:"flex w-full bg-background/80 backdrop-blur-xl border-b border-border/60 px-2 py-1",children:(0,a.jsxs)("div",{className:"grid grid-cols-3 w-full gap-2",children:[(0,a.jsx)("div",{className:"flex gap-2 items-center justify-start",children:h===$.Home?(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("div",{className:"flex items-center gap-1.5 px-2",children:[(0,a.jsx)(sq.F,{size:14}),(0,a.jsx)("div",{className:"text-sm inline",children:(0,a.jsx)("span",{className:"brand-type-italic",children:"adaptive"})})]})}):(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(O.$n,{asChild:!0,className:"flex h-7 w-auto gap-1.5 rounded-xl sm:rounded-lg hover:bg-accent/80",size:"sm",variant:"ghost",children:(0,a.jsxs)(sx(),{href:(0,eP.$_)(),children:[(0,a.jsx)(sq.F,{size:14}),"Home"]})}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"•"}),(0,a.jsx)("div",{className:"flex items-center gap-2 px-2",children:T.isLoading?(0,a.jsx)(O.EA,{className:"w-24 h-5 rounded-lg"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t5.z,{app:null!=U?U:{id:"hello",iconUrl:null},className:"flex-shrink-0 w-5 h-5"}),(0,a.jsx)("div",{className:"hidden sm:inline text-xs font-medium truncate max-w-32",title:null!==(u=null==U?void 0:U.displayName)&&void 0!==u?u:null==U?void 0:U.name,children:null!==(p=null==U?void 0:U.displayName)&&void 0!==p?p:null==U?void 0:U.name}),(0,a.jsx)(O.Bc,{children:(0,a.jsxs)(O.m_,{children:[(0,a.jsx)(O.k$,{children:(0,a.jsx)(O.Ex,{className:"flex-shrink-0 flex gap-1 font-normal cursor-default",variant:"outline",children:(null===(i=T.data)||void 0===i?void 0:i.madeUnlistedAt)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ex.A,{className:"w-2.5 h-2.5"}),"Public"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ev.A,{className:"w-2.5 h-2.5"}),"Private"]})})}),(0,a.jsx)(O.ZI,{align:"center",className:"text-xs font-normal",side:"bottom",children:(null===(l=T.data)||void 0===l?void 0:l.madeUnlistedAt)?"Anyone with the link can see this app":"Only you can see this app"})]})})]})})]})}),(H||_||h===$.Home)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex items-center justify-center",children:k&&h===$.App&&(0,a.jsx)(d.P.div,{animate:A?{scale:1,opacity:1}:{scale:.8,opacity:0},initial:{scale:.8,opacity:0},transition:{type:"spring",stiffness:400,damping:15,delay:.1},children:(0,a.jsx)(O.$n,{className:(0,K.cn)("flex flex-row items-center p-2 gap-0","color-flow-glow",g&&"is-loading"),"data-access-level":(null===(r=V.data)||void 0===r?void 0:r.accessLevel)===eL.AclLevel.VIEWER?"viewer":"editor",size:"sm",variant:"outline",onClick:()=>{C(!1),y.appId&&E.mutate({id:y.appId})},children:(0,a.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,a.jsx)("div",{className:"flex items-center",children:et?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-primary/90 compact-shimmer-text",children:[(0,a.jsx)(e3.iN,{className:"h-3.5 w-3.5 shrink-0"}),(0,a.jsx)("span",{className:"truncate max-w-[80px] text-xs font-medium shimmer-text",children:X})]}):j?(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-primary/90",children:[(0,a.jsxs)("div",{className:"relative flex h-2 w-2",children:[(0,a.jsx)("span",{className:(0,K.cn)("absolute inline-flex h-full w-full animate-ping rounded-full opacity-75",G[j.kind].backgroundPing)}),(0,a.jsx)("span",{className:(0,K.cn)("relative inline-flex h-2 w-2 rounded-full",G[j.kind].background)})]}),(0,a.jsx)("span",{className:"truncate max-w-[80px] text-xs font-medium",children:Q[j.kind]})]}):(0,a.jsx)("span",{children:(null===(o=V.data)||void 0===o?void 0:o.accessLevel)===eL.AclLevel.VIEWER?"Remix app":"Open editor"})}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-0.5 px-1 py-1 leading-[10px] text-[10px] font-medium text-muted-foreground bg-muted/60 rounded border border-border ml-1.5",children:[(0,a.jsx)(eu.A,{className:"h-2.5 w-2.5"}),(0,a.jsx)("span",{className:"align-top",children:"/"})]})]})})})}),(0,a.jsx)("div",{className:"flex items-center justify-end gap-0",children:h===$.Home?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"hidden md:flex items-center gap-0",children:[(!b||(null==x?void 0:x.id))&&(0,a.jsx)(O.$n,{"aria-label":"About adaptive.ai",disabled:w,size:"sm",variant:"ghost",onClick:()=>null==v?void 0:v(),children:"About"}),(0,a.jsx)(O.$n,{"aria-label":"Join community",disabled:w,size:"sm",variant:"ghost",onClick:()=>{(0,s8.u4)(s8.XN.NavigateToCommunity,{}),window.open("https://discord.gg/xYX6uC5Syc","_blank")},children:"Community"}),(null==x?void 0:x.id)?(0,a.jsx)(s6,{disabled:w,userId:x.id}):(0,a.jsx)(O.$n,{"aria-label":"Sign in",asChild:!0,size:"sm",variant:"ghost",children:(0,a.jsx)(sx(),{href:"/start",children:"Sign in"})})]}),(0,a.jsxs)("div",{className:"flex md:hidden items-center",children:[!(null==x?void 0:x.id)&&(0,a.jsx)(O.$n,{"aria-label":"Sign in",asChild:!0,size:"sm",variant:"ghost",children:(0,a.jsx)(sx(),{href:"/start",children:"Sign in"})}),(0,a.jsxs)(O.rI,{children:[(0,a.jsx)(O.ty,{asChild:!0,children:(0,a.jsx)(O.$n,{size:"sm",variant:"ghost",children:"Menu"})}),(0,a.jsxs)(O.SQ,{align:"end",className:"flex flex-col gap-2",children:[(!b||(null==x?void 0:x.id))&&(0,a.jsxs)(O._2,{className:"flex flex-row justify-start",onClick:()=>null==v?void 0:v(),children:[(0,a.jsx)(ej.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"About"})]}),(0,a.jsxs)(O._2,{className:"flex flex-row justify-start",onClick:()=>{(0,s8.u4)(s8.XN.NavigateToCommunity,{}),window.open("https://discord.gg/xYX6uC5Syc","_blank")},children:[(0,a.jsx)(e3.i0.discord,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Community"})]}),(null==x?void 0:x.id)&&(0,a.jsxs)(O._2,{className:"flex flex-row justify-start",onClick:()=>{z(!0)},children:[(0,a.jsx)(sJ.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Account"})]})]})]})]})]}):(0,a.jsxs)(a.Fragment,{children:[H&&(0,a.jsx)(s4,{appId:y.appId,isOpen:M,onOpenChange:R}),(null==x?void 0:x.isAdmin)&&(null==U?void 0:U.id)&&(0,a.jsxs)(O.rI,{onOpenChange:L,children:[(0,a.jsx)(O.ty,{asChild:!0,children:(0,a.jsxs)(O.$n,{className:"p-1 sm:px-2",size:"sm",variant:"ghost",children:[(0,a.jsx)(tJ.A,{className:"h-3.5 w-3.5 md:hidden"}),(0,a.jsx)("span",{className:"hidden sm:hidden md:inline",children:"Admin"})]})}),(0,a.jsxs)(O.SQ,{align:"end",children:[(0,a.jsxs)(O._2,{className:"flex flex-row justify-start",onClick:e=>{e.preventDefault(),window.open("".concat((0,eP.$_)(),"/admin-panel/debug/").concat(U.id),"_blank"),L(!1)},children:[(0,a.jsx)(sQ.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),(0,a.jsx)("span",{className:"text-sm sm:text-xs",children:"Admin Panel"})]}),(0,a.jsxs)(O._2,{className:"flex flex-row justify-start",onClick:e=>{e.preventDefault(),Z.mutate({id:U.id,versionId:B}),N({title:"Exporting app...",description:"Your download will start shortly."}),L(!1)},children:[(0,a.jsx)(sG.A,{className:"h-4 w-4 sm:h-3.5 sm:w-3.5"}),(0,a.jsx)("span",{className:"text-sm sm:text-xs",children:"Export .ac1"})]})]})]})]})})]})]})})}),(null==x?void 0:x.id)&&(0,a.jsx)("div",{className:"hidden",children:(0,a.jsx)(s6,{isOpen:F,userId:x.id,onOpenChange:z})})]})}function ae(e){var t,s,n;let{id:i,initialVersionId:l,isSending:r}=e,{currentVersionId:c,switchVersion:u}=ez(),p=(0,H.al)(),h=q.F.useUtils(),x=q.F.deleteGoonStatus.useMutation({onSuccess:()=>{h.getAppChatMessages.invalidate()}}),v=W(p),g=J(e=>e.isMinimized),f=J(e=>e.setIsMinimized),j=J(e=>e.isContentPanelVisible),w=J(e=>e.setIsContentPanelVisible),y=J(e=>e.setContentPanelVisibilityFromViewType),N=J(e=>e.setIsGoonbarHidden),k=null!=c?c:l,A=q.F.getAppAccessInfo.useQuery({id:i}),C=(null===(t=A.data)||void 0===t?void 0:t.accessLevel)==eL.AclLevel.OWNER||(null===(s=A.data)||void 0===s?void 0:s.accessLevel)==eL.AclLevel.EDITOR,{data:S}=q.F.getVersionRevFromId.useQuery({versionId:k}),E=(0,m.useRef)(null);(0,m.useEffect)(()=>{c||u({versionId:k,replace:!0,kind:"auto",clearLock:!0})},[c,u,k]);let I=(0,m.useCallback)(e=>{var t,s;if((null===(t=e.data)||void 0===t?void 0:t.source)==="iframe")switch(e.data.type){case"toggleMinimize":f(e=>!e);break;case"toggleGoonbarVisibility":N(e=>!e);break;case"minimize":f(!0),w(!1);break;case"getStatus":(null===(s=E.current)||void 0===s?void 0:s.contentWindow)&&t8(E.current.contentWindow,{type:"status",payload:{status:r?"GENERATING":"IDLE",appId:i}});break;default:"development"===tY._.NEXT_PUBLIC_NODE_ENV&&console.warn("Unknown message type:",e.data.type)}},[f,w,N,r,i]),L=(0,m.useCallback)(e=>{(e.metaKey||e.ctrlKey)&&"/"===e.key&&(e.preventDefault(),N(e=>(e&&x.mutate({id:i}),!e)))},[N,x,i]);(0,m.useEffect)(()=>(document.addEventListener("keydown",L,!0),()=>{document.removeEventListener("keydown",L,!0)}),[L]),(0,m.useEffect)(()=>(window.addEventListener("message",I),()=>{window.removeEventListener("message",I)}),[I]),(0,m.useEffect)(()=>{C&&y($.App)},[y,C,null===(n=A.data)||void 0===n?void 0:n.accessLevel]);let[M,R]=(0,m.useState)(""),[F,z]=(0,m.useState)(!1);(0,m.useEffect)(()=>{z(!0);let e=setTimeout(()=>{z(!1)},5e3);return()=>clearTimeout(e)},[k]),(0,m.useEffect)(()=>{var e,t;if((0,b.A)(window))return;let s=new URL(window.location.href);s.searchParams.set("_vid",k),s.searchParams.delete("_evid"),s.searchParams.delete("_ogb"),R((0,eP.vz)(s.toString())),r?t8(null===(e=E.current)||void 0===e?void 0:e.contentWindow,{type:"status",payload:{status:"GENERATING",appId:i}}):t8(null===(t=E.current)||void 0===t?void 0:t.contentWindow,{type:"status",payload:{status:"IDLE",appId:i}})},[k,r,i]);let[P,D]=(0,m.useState)(!1);(0,m.useEffect)(()=>{D(!1)},[M]);let T=q.F.reportFrontendLog.useMutation();return(0,m.useEffect)(()=>{let e=e=>{e.blockedURI&&T.mutate({level:eL.LogLevel.ERROR,versionId:k,message:"App.tsx: can't navigate to external resource ".concat(e.blockedURI,' use target="_blank" instead or open new window.')})};return window.addEventListener("securitypolicyviolation",e),()=>{window.removeEventListener("securitypolicyviolation",e)}},[T,k]),(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("div",{className:"h-svh pt-[var(--sidebar-height,37px)] overflow-hidden flex",children:[j&&!g&&(0,a.jsx)("div",{className:"fixed inset-0 z-30",onClick:()=>{f(!0),p&&w(!1)},onScroll:()=>{f(!0),p&&w(!1)},onTouchMove:()=>{f(!0),p&&w(!1)},onWheel:()=>{f(!0),p&&w(!1)}}),(0,a.jsxs)("div",{className:"flex-grow relative",children:[(0,a.jsx)("iframe",{allow:"fullscreen; camera; microphone; gyroscope; accelerometer; clipboard-write; clipboard-read; autoplay; geolocation; display-capture; picture-in-picture; payment; midi; bluetooth; web-share; screen-wake-lock; xr-spatial-tracking; encrypted-media; idle-detection; hid; serial",className:(0,K.cn)("w-full border-0 overflow-hidden",{"opacity-0 pointer-events-none":!P,"h-full":!(g&&"peek"===v),"h-[calc(100%-28px)]":g&&"peek"===v}),id:"appFrame",loading:"eager",name:"appFrame",ref:E,referrerPolicy:"unsafe-url",src:M||void 0,onErrorCapture:e=>{console.error("Error loading iframe",e)},onLoad:()=>{D(!0)}},k),(0,a.jsx)(o.N,{mode:"wait",children:C&&F&&S?(0,a.jsx)(d.P.div,{animate:{opacity:1,y:0},className:"absolute top-2 sm:top-2 left-0 right-0 mx-auto flex justify-center z-50",exit:{opacity:0,y:-20},initial:{opacity:0,y:-20},transition:{duration:.3},children:(0,a.jsx)("div",{className:"flex items-center gap-2 rounded-lg border bg-popover/80 backdrop-blur-md px-3 py-1.5 text-sm text-popover-foreground shadow-card pointer-events-none",children:(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Now viewing version ",S]})})}):null})]})]})})}var at=s(66655);let as={initial:{opacity:0,scale:.92,y:40},peek:{opacity:1,scale:1,y:"calc(100% - 32px)"},visible:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.96,y:40,rotateX:8,transformOrigin:"center bottom",transition:{type:"spring",stiffness:350,damping:25,mass:.5,opacity:{duration:.25,ease:"easeOut"}}}},aa={type:"spring",stiffness:100,damping:20,mass:1,opacity:{duration:.2}};function an(e){var t,s,i,g,f,j;let{currentUser:b,appId:w,initialVersionId:y,showAbout:N,homeScreenPages:k,appHubContent:A}=e,[C,S]=(0,m.useState)(0),E=w?$.App:$.Home,[I,L]=(0,m.useState)(null),[R,F]=(0,m.useState)(!1),{toast:z}=(0,et.dj)(),P=q.F.useUtils(),D=q.F.createApp.useMutation(),[T,U]=(0,m.useState)(null),V=(0,u.useRouter)(),[_,Q,G]=(0,h.Mj)("storedInput",""),{getUserPreference:Y,setUserPreference:K}=(0,eI.A)(),Z=null==b?void 0:b.id,X=(0,m.useRef)(!1),[ee,es]=(0,m.useState)(!1),ea=(0,H.al)(),en=J(e=>e.isMinimized),ei=J(e=>e.isGoonbarHidden),el=J(e=>e.setShowOpenGoonbarButton),er=J(e=>e.setIsGoonbarHidden),eo=J(e=>e.setIsMinimized),ed=W(ea),ec=J(e=>e.setIsContentPanelVisible),eu=J(e=>e.setContentPanelVisibilityFromViewType);(0,m.useEffect)(()=>{eu(E)},[E,eu]);let em=(0,m.useMemo)(()=>!!I&&30>(0,r.O)(new Date,I),[I]),ep=(0,m.useMemo)(()=>E===$.Home?[{id:"initial-agent-msg-id",kind:"message",message:{role:eL.MessageRole.ASSISTANT,content:B[$.Home].initialMessage},timestamp:Date.now()}]:[],[E]),eh=(0,m.useCallback)(e=>{let t=null!=T?T:w;(null==e?void 0:e.app)&&t&&t!=e.app.id&&(z({title:"Made a copy",description:"Switching to new app where changes are being made"}),V.push((0,eP.MJ)(e.app.subdomain)+"?_ogb=true"))},[w,T,V,z]),{messages:ex,goonStatus:ev,firstErrorLog:eg,sendMessage:ef,hasNextPage:ej,fetchNextPage:eb,isFetchingNextPage:ew,isSending:ey}=function(e){var t,s;let{appId:a,enabled:n,onSend:i,initialOptimisticMessages:l=[]}=e,r=q.F.useUtils(),{resolvedTheme:o}=(0,M.D)(),{currentUser:d}=(0,eI.A)(),[u,p]=(0,m.useState)([]),[h,x]=(0,m.useState)(!1),[v,g]=(0,m.useState)(1e4),{toast:f}=(0,O.dj)(),{mutate:j,isLoading:b}=q.F.sendAppChatMessage.useMutation({onSuccess:async e=>{var t,s;r.getAppChatMessages.invalidate({id:null===(t=e.app)||void 0===t?void 0:t.id}),r.getAppById.invalidate({id:null===(s=e.app)||void 0===s?void 0:s.id}),null==i||i(e),x(!0)},onError:e=>{f({title:"Failed to send message",description:e.message}),r.getAppChatMessages.invalidate(),x(!0)},onMutate:async e=>{var t;r.getAppChatMessages.cancel(),!e.isHidden&&p([...l,{id:"optimistic-user-msg-id",userId:null!==(t=null==d?void 0:d.id)&&void 0!==t?t:"optimistic-id",kind:"message",message:{role:eL.MessageRole.USER,content:e.message},timestamp:Date.now()-10}])}});(0,m.useEffect)(()=>{a||(p([]),x(!1))},[a]);let w=q.F.getAppChatMessages.useInfiniteQuery({id:a},{refetchInterval:v,enabled:n&&!!a,staleTime:1e4,initialCursor:null,getNextPageParam:e=>e.nextCursor,onSuccess:()=>{h&&(p([]),x(!1))}}),y=(0,m.useMemo)(()=>{var e;let t=null===(e=w.data)||void 0===e?void 0:e.pages.flatMap(e=>e.messages),s=(0,c.A)(null!=t?t:[]),a=u.filter(e=>{var t;return e.timestamp>(null!==(t=null==s?void 0:s.timestamp)&&void 0!==t?t:0)&&e.timestamp>Date.now()-24e4});return(null!=t?t:[]).concat(a).sort((e,t)=>e.timestamp-t.timestamp)},[null===(t=w.data)||void 0===t?void 0:t.pages,u]),N=(0,at.A)(null===(s=w.data)||void 0===s?void 0:s.pages),k=b||!!N&&!(null==N?void 0:N.areAgentsIdle)||u.length>0;return(0,m.useEffect)(()=>{g(k?1e3:1e4)},[k]),{sendMessage:(e,t)=>{var s,a,n;j({...e,context:{pathname:null!==(n=null===(s=e.context)||void 0===s?void 0:s.pathname)&&void 0!==n?n:"/",theme:null!=o?o:"light",screenshots:null===(a=e.context)||void 0===a?void 0:a.screenshots}},t)},isSending:k,hasNextPage:w.hasNextPage,fetchNextPage:w.fetchNextPage,isFetchingNextPage:w.isFetchingNextPage,goonStatus:null==N?void 0:N.goonStatus,firstErrorLog:null==N?void 0:N.firstErrorLog,messages:y,isLoading:w.isLoading}}({appId:E===$.App?null!=w?w:null:T,enabled:E===$.Home||E===$.App&&!!w,initialOptimisticMessages:ep,onSend:eh}),eN=(0,m.useMemo)(()=>{var e;let t=["Thinking","Reviewing your request","Identifying next steps"],s=[...ex],a=(0,c.A)(s);return ey&&((null==a?void 0:a.kind)!="status"||(null==a?void 0:a.status.kind)!="message"||(null==a?void 0:a.status.role)!="assistant")&&((null==a?void 0:a.kind)!="status"||(null==a?void 0:null===(e=a.status)||void 0===e?void 0:e.kind)!="tool")&&(s=[...s,{kind:"status",id:"temp-id",timestamp:Date.now(),status:{kind:"tool",status:t[Math.floor(Date.now()/5e3%t.length)]}}]),s},[ex,ey]),{data:ek}=q.F.getAppById.useQuery({id:w},{keepPreviousData:!0,enabled:E===$.App&&!!w}),eA=q.F.publishAppVersion.useMutation({onSuccess:e=>{var t,s;F(!0);let n=(0,eP.MJ)(e.subdomain).replace(/https?:\/\//,""),i=(0,eP.MJ)(e.subdomain);l()(i),z({title:"Version ".concat(null==ek?void 0:null===(t=ek.latestVersion)||void 0===t?void 0:t.rev," published"),description:(0,a.jsxs)("div",{children:["The public link (",n,") now points to version"," ",null==ek?void 0:null===(s=ek.latestVersion)||void 0===s?void 0:s.rev,".",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Link copied to clipboard!"})]})}),P.getAppById.invalidate(),setTimeout(()=>F(!1),1e3)},onError:e=>{F(!1),z({title:"Could not update public link",description:e.message,variant:"destructive"})}}),eC=q.F.getAppById.useQuery({id:null!=T?T:""},{keepPreviousData:!0,refetchInterval:3e3,enabled:E===$.Home&&!!T});(0,m.useEffect)(()=>{var e,t,s,a;T&&(null===(t=eC.data)||void 0===t?void 0:null===(e=t.latestVersion)||void 0===e?void 0:e.isStable)&&(V.push((0,eP.MJ)(null===(s=eC.data)||void 0===s?void 0:s.subdomain)+"?_ogb=true"),z({title:"Now viewing "+(null===(a=eC.data)||void 0===a?void 0:a.displayName),description:"We're still working on your app, but you can view it now!"}))},[T,V,eC.data,z]),(0,m.useEffect)(()=>{var e,t,s,a;E===$.Home&&T&&(null===(t=eC.data)||void 0===t?void 0:null===(e=t.latestVersion)||void 0===e?void 0:e.isStable)&&(window.location.replace((0,eP.MJ)(null===(s=eC.data)||void 0===s?void 0:s.subdomain)+"?_ogb=true"),z({title:"Now viewing "+(null===(a=eC.data)||void 0===a?void 0:a.displayName),description:"We're still working on your app, but you can view it now!"}))},[E,T,eC.data,z]),(0,m.useEffect)(()=>{"true"===new URLSearchParams(window.location.search).get("_ogb")&&(eo(!1),ec(!0))},[eo,ec]);let eS=(0,m.useCallback)(async e=>{if(E===$.Home){if(null==Z){Q("string"==typeof e.chatInput?e.chatInput:JSON.stringify(e.chatInput)),V.push("/start");return}if((null==b?void 0:b.isCreator)===!1){z({title:"You are not a creator",description:"You need to be a creator to build apps"});return}let t=T;if(!t){let e=await D.mutateAsync(void 0,{onError:()=>{z({title:"Error creating app",description:"Unable to create app, please try again later",variant:"destructive"})}});if(!e)return;U(t=e.id)}ef({id:t,isHidden:e.isHidden,message:e.chatInput})}else E===$.App&&w&&ef({id:w,isHidden:e.isHidden,message:e.chatInput,context:e.context})},[T,E,Z,Q,V,w,D,ef,null==b?void 0:b.isCreator,z]),eE=(0,p.mN)({resolver:(0,n.u)(sl),defaultValues:{chatInput:null!=_?_:""}});(0,m.useEffect)(()=>{var e;if(X.current)return;let t=null===(e=new URLSearchParams(window.location.search).get("prompt"))||void 0===e?void 0:e.trim();t&&(window.history.replaceState({},"",window.location.pathname),X.current=!0,(null==b?void 0:b.id)?(es(!0),eS({chatInput:t}).finally(()=>{es(!1)})):(Q(t),V.push("/start")))},[null==b?void 0:b.id,V,Q,eS]),(0,m.useEffect)(()=>{(async()=>{if(_){es(!0);let e=_;try{e=JSON.parse(_)}catch(e){}eE.setValue("chatInput",e),G(),(null==b?void 0:b.id)&&(await eS({chatInput:e}),ec(!0),es(!1))}})()},[null==b?void 0:b.id]);let[eM,eR]=(0,m.useState)(N),eF=b?!Y(eL.PreferenceKind.HIDE_PLANS_POPUP,!N):eM,ez=(0,m.useCallback)(e=>{b?K(eL.PreferenceKind.HIDE_PLANS_POPUP,!e):eR(e)},[b,K]),eD=q.F.getAppAccessInfo.useQuery({id:null==ek?void 0:ek.id},{enabled:!!ek}),eT=!!((null==b?void 0:b.isCreator)&&(null===(t=eD.data)||void 0===t?void 0:t.accessLevel)&&(eD.data.accessLevel.includes(eL.AclLevel.OWNER)||eD.data.accessLevel.includes(eL.AclLevel.EDITOR))),eU=!!(E===$.App&&(null==ek?void 0:ek.publishedVersionId)&&ek.publishedVersionId!==y&&!R&&eT);(0,m.useEffect)(()=>{if(eD.data){var e;E===$.App&&(null===(e=eD.data)||void 0===e?void 0:e.accessLevel)===eL.AclLevel.OWNER?"true"===new URLSearchParams(window.location.search).get("_ogb")?(er(!1,{preserveContentPanelState:!1}),eo(!1),ec(!0)):ea?(el(!1),er(!1),eo(!0)):(el(!0),er(!0),ec(!0),eo(!1,{preserveContentPanelState:!0})):(er(!1,{preserveContentPanelState:!0}),ec(!1),ea?(el(!1),eo(!0)):(el(!0),eo(!1,{preserveContentPanelState:!0})))}},[eD.data,E,ec,er,eo,el,ea]);let eV=si({messages:eN,latestVersionId:null==ek?void 0:ek.latestVersionId,firstErrorLog:eg}),eO=(0,m.useMemo)(()=>{if(ev)return ev;if(eV.error){var e;return{id:"error-status",summary:null!==(e=eV.summary)&&void 0!==e?e:"",kind:eV.error,timestamp:Date.now()}}return null},[ev,eV]),eH=q.F.getHomeScreenPages.useQuery(void 0,{enabled:!!b}),e_=eH.data&&eH.data.length>0?eH.data:k;return(null==b?void 0:b.id)&&ee?(0,a.jsx)("div",{className:"min-h-svh flex items-center justify-center",children:(0,a.jsx)(x,{})}):(0,a.jsxs)("div",{className:"relative min-h-svh",children:[(0,a.jsx)("div",{className:"fixed top-0 left-0 right-0 h-fit border-b border-border z-40",children:(0,a.jsx)(s7,{appId:w,chatLog:eN,currentUser:b,disableOptions:eN.length>0,goonStatus:eO,hasRecentAppInteractions:em,isLanding:eF,isSendingMessage:ey,view:E,...E===$.App&&{hasLiveVersionWarning:eU,isPublishing:eA.isLoading,latestVersionRev:null==ek?void 0:null===(s=ek.latestVersion)||void 0===s?void 0:s.rev,onPublish:()=>{w&&y&&eA.mutate({id:w,versionId:y})}},onAboutClick:()=>ez(!eF)})}),E===$.Home?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.o,{className:eF?"filter blur-xl brightness-90 dark:brightness-100":""}),(0,a.jsx)(o.N,{children:eF&&(0,a.jsx)(sW,{appHubContent:A,onDismiss:()=>ez(!eF)})}),!eN.length&&!eF&&(0,a.jsx)(sC,{appHubContent:A,data:e_})]}):(0,a.jsx)(ae,{id:w,initialVersionId:y,isSending:ey}),(0,a.jsx)(o.N,{onExitComplete:()=>{window.dispatchEvent(new CustomEvent("goonbar-exit-complete"))},children:!ei&&(0,a.jsx)(d.P.div,{animate:en&&"peek"===ed?"peek":"visible",className:"fixed bottom-2 sm:bottom-4 left-0 right-0 mx-auto z-50 w-fit overflow-visible",exit:"exit",initial:"initial",transition:{...aa,delay:.1},variants:as,onClick:()=>{en&&"peek"===ed&&(eo(!1),ec(!0))},children:(0,a.jsx)(sp,{allowChat:null==b?void 0:b.isCreator,app:null!=ek?ek:T?{id:T,madeUnlistedAt:null,latestVersionId:null,publishedVersionId:null,displayName:null}:void 0,capabilities:B[E],chatLog:eN,fetchNextPage:eb,firstErrorLog:eg,goonStatus:eO,handleChatSubmit:eS,hasNextPage:ej,hasRecentAppInteractions:em,isFetchingNextPage:ew,isSendingMessage:ey,latestVersionRev:null==ek?void 0:null===(i=ek.latestVersion)||void 0===i?void 0:i.rev,position:C,searchableApps:(null!==(g=null==A?void 0:A.recentlyViewedApps)&&void 0!==g?g:[]).concat(null!==(f=null==A?void 0:A.sharedApps)&&void 0!==f?f:[]).concat(null!==(j=null==A?void 0:A.ownedApps)&&void 0!==j?j:[]),showAbout:eF,view:E,onPositionChange:S,...E===$.App&&{currentVersionId:y,allowUpload:!0,isPublishing:eA.isLoading,hasLiveVersionWarning:eU,onPublish:()=>{w&&y&&eA.mutate({id:w,versionId:y})}}})})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1393,9680,987,8935,2125,4743,7301,9466,8897,3698,7943,3292,8235,8135,7221,9401,6123,6797,9589,4195,71,8244,7358],()=>t(64210)),_N_E=e.O()}]);