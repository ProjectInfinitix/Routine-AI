try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="b8c4dd69-3960-41ce-8cc0-6bc49bf711ff",e._sentryDebugIdIdentifier="sentry-dbid-b8c4dd69-3960-41ce-8cc0-6bc49bf711ff")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9401],{10094:(e,t,s)=>{s.d(t,{nl:()=>A});var n=s(31218),r=s(35712),l=s(15387),a=s.n(l),i=s(22613),o=s(81449),c=s(95717),d=s(23782),u=s(51338),m=s(83328),h=s(88218),x=s(59133),f=s(50192),p=s(34528),j=s(28235),g=s(44430);let v=f.z.object({cron:f.z.string().refine(e=>{try{return(0,g.g)(e),!0}catch(e){return!1}},{message:"[CronJobSchema] Invalid cron expression"}).refine(e=>{let t=(0,g.g)(e);return 1===t.seconds.length&&t.minutes.length<=4},{message:"[CronJobSchema] Cron is too frequent. Maximum allowed frequency is 4 times per hour."}),handler:f.z.string().refine(e=>/^[a-zA-Z0-9_]+$/.test(e),{message:"[CronJobSchema] Handler must be a valid identifier (letters, numbers, and underscores only)."})});f.z.object({crons:f.z.array(v).optional().nullish(),variables:f.z.record(f.z.string(),f.z.string()).optional().nullish()});var y=s(87998),b=s(75569);function N(e){let{name:t,value:s,afterEdit:r,onDelete:l}=e,[a,u]=(0,h.useState)(!1),[m,x]=(0,h.useState)(!1),[f,p]=(0,h.useState)(s),g=()=>{r(t,f),x(!1)};return(0,n.jsxs)(j.Hj,{children:[(0,n.jsx)(j.nA,{children:t}),(0,n.jsx)(j.nA,{children:m?(0,n.jsx)(j.pd,{autoComplete:"off",value:f,onChange:e=>p(e.target.value),onKeyDown:e=>{"Enter"===e.key&&g(),"Escape"===e.key&&x(!1)}}):(0,n.jsx)("p",{className:"font-mono",children:a?s:"*****"})}),(0,n.jsx)(j.nA,{children:(0,n.jsxs)("div",{className:"flex items-start justify-end gap-2",children:[!m&&(0,n.jsxs)(n.Fragment,{children:[a?(0,n.jsx)(j.$n,{size:"sm",variant:"ghost",onClick:()=>u(!1),children:(0,n.jsx)(i.A,{className:"h-3 w-3 text-muted-foreground"})}):(0,n.jsx)(j.$n,{size:"sm",variant:"ghost",onClick:()=>u(!0),children:(0,n.jsx)(o.A,{className:"h-3 w-3 text-muted-foreground"})}),(0,n.jsx)(j.$n,{size:"sm",variant:"ghost",onClick:()=>x(!0),children:(0,n.jsx)(c.A,{className:"h-3 w-3 text-muted-foreground"})}),(0,n.jsx)(j.$n,{size:"sm",variant:"destructive",onClick:l,children:(0,n.jsx)(d.A,{className:"h-3 w-3"})})]}),m&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.$n,{size:"sm",variant:"primary",onClick:g,children:"Save"}),(0,n.jsx)(j.$n,{size:"sm",variant:"ghost",onClick:()=>x(!1),children:"Cancel"})]})]})})]})}function w(e){let{cron:t,handlers:s,afterEdit:r,onDelete:l}=e,[i,o]=(0,h.useState)(!1),[x,f]=(0,h.useState)(t),[p,g]=(0,h.useState)(a().toString(t.cron));return(0,n.jsxs)("div",{className:"flex my-2 justify-between rounded-lg border bg-card text-card-foreground shadow-sm p-4",children:[(0,n.jsxs)("div",{className:"flex flex-col w-full",children:[(0,n.jsxs)("div",{className:"flex items-center text-muted-foreground",children:[(0,n.jsx)(u.A,{className:"h-4 w-4 mr-1"}),"Schedule"]}),i?(0,n.jsx)(j.pd,{autoComplete:"off",value:x.cron,onChange:e=>{f({...x,cron:e.target.value});try{g(a().toString(e.target.value))}catch(e){g("")}}}):(0,n.jsx)("p",{children:p}),(0,n.jsxs)("div",{className:"flex items-center mt-2 text-muted-foreground",children:[(0,n.jsx)(m.A,{className:"h-4 w-4 mr-1"}),"Handler"]}),i?(0,n.jsxs)(j.l6,{value:x.handler,onValueChange:e=>f({...x,handler:e}),children:[(0,n.jsx)(j.bq,{children:(0,n.jsx)(j.yv,{placeholder:"Select handler"})}),(0,n.jsx)(j.gC,{children:null==s?void 0:s.map(e=>(0,n.jsx)(j.eb,{value:e,children:e},e))})]}):(0,n.jsx)("p",{children:t.handler})]}),(0,n.jsx)("div",{className:"flex items-start justify-end gap-2",children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.$n,{size:"sm",variant:"primary",onClick:()=>{r(x),o(!1)},children:"Save"}),(0,n.jsx)(j.$n,{size:"sm",variant:"ghost",onClick:()=>o(!1),children:"Cancel"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.$n,{size:"sm",variant:"ghost",onClick:()=>o(!0),children:(0,n.jsx)(c.A,{className:"h-3 w-3 text-muted-foreground"})}),(0,n.jsx)(j.$n,{size:"sm",variant:"destructive",onClick:l,children:(0,n.jsx)(d.A,{className:"h-3 w-3"})})]})})]})}function C(e){let{afterSubmit:t,onCancel:s}=e,l=(0,x.mN)({defaultValues:{name:"",value:""},resolver:(0,r.u)(f.z.object({name:f.z.string().min(1),value:f.z.string().min(1)}))});return(0,n.jsx)(j.lV,{...l,children:(0,n.jsxs)("form",{className:"flex flex-col mt-4 gap-4",onSubmit:l.handleSubmit(e=>{t(e),l.reset()}),children:[(0,n.jsx)(j.zB,{control:l.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(j.eI,{children:[(0,n.jsx)(j.lR,{children:"Name"}),(0,n.jsx)(j.MJ,{children:(0,n.jsx)(j.pd,{autoComplete:"off",placeholder:"e.g. GITHUB_TOKEN",type:"text",...t})})]})}}),(0,n.jsx)(j.zB,{control:l.control,name:"value",render:e=>{let{field:t}=e;return(0,n.jsxs)(j.eI,{children:[(0,n.jsx)(j.lR,{children:"Value"}),(0,n.jsx)(j.MJ,{children:(0,n.jsx)(j.pd,{autoComplete:"off",placeholder:"e.g. GT1234",type:"text",...t})})]})}}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(j.$n,{type:"submit",variant:"primary",children:"Save"}),(0,n.jsx)(j.$n,{type:"button",variant:"ghost",onClick:s,children:"Cancel"})]})]})})}function S(e){let{handlers:t,afterSubmit:s,onCancel:r}=e,[l,i]=(0,h.useState)(""),o=(0,x.mN)({defaultValues:{cron:"",handler:""}});return(0,n.jsx)(j.lV,{...o,children:(0,n.jsxs)("form",{className:"flex flex-col mt-4 gap-4",onSubmit:o.handleSubmit(e=>{try{v.parse(e),s(e),o.reset(),i("")}catch(e){e instanceof Error&&o.setError("root",{message:e.message.includes("handler")?"Invalid handler":e.message})}}),children:[(0,n.jsx)(j.zB,{control:o.control,name:"cron",render:e=>{let{field:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(j.eI,{children:[(0,n.jsx)(j.lR,{children:"Schedule"}),(0,n.jsx)(j.MJ,{children:(0,n.jsx)(j.pd,{autoComplete:"off",placeholder:"e.g. * * * * *",type:"text",...t,onChange:e=>{t.onChange(e.target.value);try{i(a().toString(e.target.value))}catch(e){i("")}}})})]}),l&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:l})]})}}),(0,n.jsx)(j.zB,{control:o.control,name:"handler",render:e=>{let{field:s}=e;return(0,n.jsxs)(j.eI,{children:[(0,n.jsx)(j.lR,{children:"Handler"}),(0,n.jsx)(j.MJ,{children:(0,n.jsxs)(j.l6,{name:s.name,value:s.value,onValueChange:s.onChange,children:[(0,n.jsx)(j.bq,{children:(0,n.jsx)(j.yv,{placeholder:"Please select the handler function"})}),(0,n.jsx)(j.gC,{children:null==t?void 0:t.map(e=>(0,n.jsx)(j.eb,{value:e,children:e},e))})]})})]})}}),o.formState.errors.root&&(0,n.jsx)("div",{className:"my-2 text-sm text-red-400",role:"alert",children:o.formState.errors.root.message}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(j.$n,{type:"submit",variant:"primary",children:"Save"}),(0,n.jsx)(j.$n,{type:"button",variant:"ghost",onClick:r,children:"Cancel"})]})]})})}function k(e){let{logs:t}=e;return(0,n.jsxs)(j.XI,{children:[(0,n.jsx)(j.A0,{children:(0,n.jsxs)(j.Hj,{children:[(0,n.jsx)(j.nd,{children:"Id"}),(0,n.jsx)(j.nd,{children:"Function Name"}),(0,n.jsx)(j.nd,{className:"text-right",children:"Created"})]})}),(0,n.jsxs)(j.BF,{children:[(null==t?void 0:t.length)===0&&(0,n.jsx)(j.Hj,{children:(0,n.jsx)(j.nA,{colSpan:3,children:"No logs found"})}),null==t?void 0:t.map(e=>(0,n.jsxs)(j.Hj,{children:[(0,n.jsx)(j.nA,{className:"max-w-16 text-ellipsis whitespace-nowrap overflow-hidden",title:e.id,children:e.id}),(0,n.jsx)(j.nA,{className:"whitespace-nowrap",children:e.cronName}),(0,n.jsx)(j.nA,{className:"whitespace-nowrap text-right",children:(0,b.Pp)(e.createdAt)})]},e.id))]})]})}function A(e){var t;let{versionId:s,displayRunTick:r=!1}=e,l=y.F.getInfraConfig.useQuery({versionId:s}),[a,i]=(0,h.useState)([]),[o,c]=(0,h.useState)({}),[d,u]=(0,h.useState)(!1),[m,x]=(0,h.useState)(!1),[f,g]=(0,h.useState)({});(0,h.useEffect)(()=>{var e,t;let s=null!==(t=null===(e=l.data)||void 0===e?void 0:e.infraConfig)&&void 0!==t?t:{};s.variables&&c(s.variables),s.crons&&i(s.crons)},[l.data]);let{appId:v,cronLogs:b}=null!==(t=l.data)&&void 0!==t?t:{},{data:A,isLoading:I,error:E,refetch:z}=y.F.getMissingEnvVariablesForVersion.useQuery({versionId:s,appId:v},{enabled:!!l.data}),[F,T]=(0,h.useState)({}),$=y.F.updateInfraConfig.useMutation({onSuccess:()=>{q({title:"Successfully updated the configuration"}),z(),B.getInfraConfig.invalidate({versionId:s}),B.getAppChatMessages.invalidate(),g({})},onError:e=>{q({title:"Error",description:e.message}),g({})}});(0,h.useEffect)(()=>{A&&T(A.reduce((e,t)=>(e[t]="",e),{}))},[A]);let R={...o,...f},{data:M}=y.F.getAppEndpoints.useQuery({versionId:s}),{toast:q}=(0,j.dj)(),B=y.F.useUtils(),V=y.F.debugRunInfraTick.useMutation({onSuccess:()=>{B.getInfraConfig.invalidate({versionId:s}),q({title:"Infra tick started"})}});return l.error?(0,n.jsx)("div",{className:"bg-destructive text-destructive-foreground",children:l.error.message}):l.isLoading?(0,n.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,n.jsx)(p.F,{morphing:!0,size:64})}):(0,n.jsxs)("div",{className:"flex flex-col px-4 py-4 space-y-8 flex-grow overflow-y-auto",children:[I?(0,n.jsx)("section",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:(0,n.jsx)("div",{className:"flex items-center justify-center",children:(0,n.jsx)("p",{children:"Loading missing environment variables..."})})}):A&&A.length>0?(0,n.jsxs)("section",{className:"bg-warning/30 border border-warning-foreground/20 rounded-md p-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:"Missing Required Environment Variables"}),(0,n.jsx)("p",{className:"text-sm text-warning-foreground/80 mb-4",children:"Please provide values for the following environment variables:"}),(0,n.jsx)("div",{className:"space-y-4",children:A.map(e=>{var t;return(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-2",children:[(0,n.jsx)("label",{className:"w-full sm:w-1/3 font-medium mb-1 sm:mb-0",htmlFor:e,children:e}),(0,n.jsx)(j.pd,{className:"w-full sm:w-2/3",id:e,placeholder:"Enter value for ".concat(e),type:"text",value:null!==(t=F[e])&&void 0!==t?t:"",onChange:t=>T(s=>({...s,[e]:t.target.value}))})]},e)})}),(0,n.jsx)(j.$n,{className:"mt-6 w-full sm:w-auto",variant:"primary",onClick:()=>{var e;let t={...o,...F};g(t),$.mutate({versionId:s,infraConfig:{...null===(e=l.data)||void 0===e?void 0:e.infraConfig,variables:t}}),T({})},children:"Save Missing Variables"})]}):null,(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Environment variables"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Environment variables are like secret settings for your app. They store important information like API keys, keeping them separate from your code for better security."}),0!==Object.entries(R).length||d?(0,n.jsxs)(j.XI,{children:[(0,n.jsx)(j.A0,{children:(0,n.jsxs)(j.Hj,{children:[(0,n.jsx)(j.nd,{children:"Name"}),(0,n.jsx)(j.nd,{children:"Value"}),(0,n.jsx)(j.nd,{})]})}),(0,n.jsxs)(j.BF,{children:[Object.entries(R).map((e,t)=>{let[r,l]=e;return(0,n.jsx)(N,{afterEdit:(e,t)=>{$.mutate({versionId:s,infraConfig:{crons:a,variables:{...o,[e]:t}}}),c({...o,[e]:t})},name:r,value:l,onDelete:()=>{if(window.confirm("Are you sure you want to delete the environment variable ".concat(r,"?"))){let e={...o};delete e[r],$.mutate({versionId:s,infraConfig:{crons:a,variables:e}}),c(e)}}},t)}),d&&(0,n.jsx)(j.Hj,{children:(0,n.jsx)(j.nA,{colSpan:3,children:(0,n.jsx)(C,{afterSubmit:e=>{e.name&&e.value&&($.mutate({versionId:s,infraConfig:{crons:a,variables:{...o,[e.name]:e.value}}}),c({...o,[e.name]:e.value}),u(!1))},onCancel:()=>u(!1)})})})]})]}):(0,n.jsx)("div",{className:"bg-muted p-4 rounded-md text-muted-foreground text-sm",children:"No environment variables configured yet."}),!d&&(0,n.jsx)(j.$n,{className:"self-start mt-4",variant:"primary",onClick:()=>u(!0),children:"Add environment variable"})]}),(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Scheduled Tasks (Crons)"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Scheduled tasks, also known as crons, are like automatic reminders for your app. They help your app perform specific actions at set times, like sending daily reports or cleaning up old data."}),0!==a.length||m?(0,n.jsxs)(n.Fragment,{children:[a.map((e,t)=>(0,n.jsx)(w,{afterEdit:e=>{let n=a.map((s,n)=>n===t?e:s);$.mutate({versionId:s,infraConfig:{crons:n,variables:o}}),i(n)},cron:e,handlers:M,onDelete:()=>{if(window.confirm("Are you sure you want to delete this cron?")){let e=a.filter((e,s)=>s!==t);$.mutate({versionId:s,infraConfig:{crons:e,variables:o}}),i(e)}}},t)),m&&(0,n.jsx)(S,{afterSubmit:e=>{$.mutate({versionId:s,infraConfig:{crons:[...a,e],variables:o}}),i([...a,e]),x(!1)},handlers:M,onCancel:()=>x(!1)})]}):(0,n.jsx)("div",{className:"bg-muted p-4 rounded-md text-muted-foreground text-sm",children:"No scheduled tasks configured yet."}),!m&&(0,n.jsx)(j.$n,{className:"self-start mt-4",variant:"primary",onClick:()=>x(!0),children:"Create scheduled task"})]}),b&&b.length>0&&(0,n.jsxs)("section",{children:[(0,n.jsx)("h2",{className:"text-xl font-bold mb-2",children:"Task History (Cron logs)"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Task history, or cron logs, shows a record of when your scheduled tasks ran. This helps you keep track of what your app has been doing automatically and when it happened."}),(0,n.jsx)(k,{logs:b})]}),r&&v&&(0,n.jsx)(j.$n,{className:"self-start mt-4",disabled:V.isLoading,variant:"outline",onClick:()=>{V.mutate({appId:v})},children:"Run tick"}),E&&(0,n.jsx)("div",{className:"bg-destructive text-destructive-foreground p-4 mt-4 rounded",children:E.message})]})}},24833:(e,t,s)=>{s.d(t,{Uf:()=>i,yT:()=>o});var n=s(82075);let r=e=>({type:"system-note",content:e}),l=e=>{var t;return{content:{type:"user-content",parts:Array.isArray(e.content)?e.content:[{type:"text",text:String(null!==(t=e.content)&&void 0!==t?t:"")}]},systemNotes:[]}},a=e=>[...e.content.parts,...e.systemNotes.map(e=>({type:"text",text:"\n\n<system-note>".concat(e.content,"</system-note>")}))];function i(e){return e}function o(e){return e}[].push(e=>{let t=/(?:https?:\/\/)?(?:www\.)?[a-zA-Z0-9-]+(?:\.[a-zA-Z]{2,})+(?:\/\S*)?/;return e.map(e=>{let s=l(e),i=s.content.parts.map(e=>"text"in e?e.text:"").join(" ");return i&&t.test(i)&&!i.includes(n._.APP_DOMAIN)&&s.systemNotes.push(r("If you need to interact with the provided URL, please use the `openAndInteractWithUrl` tool.")),{...e,content:a(s)}})})},34528:(e,t,s)=>{s.d(t,{F:()=>r});var n=s(31218);function r(e){let{size:t=32,morphing:s=!1,...r}=e;return(0,n.jsxs)("div",{...r,className:"relative ".concat(r.className),style:{width:t+"px",height:t+"px"},children:[(0,n.jsx)("img",{alt:"Adaptive Computer",height:t,src:"/assets/logo.webp",style:{animation:s?"2s rainbow-growing ease-in-out 4s infinite":""},width:t}),r.children,(0,n.jsx)("div",{className:"logo-rainbow",style:{width:t+"px",height:t+"px",transition:"opacity 0.3s ease-in-out",opacity:+!!s,top:0,left:0}}),(0,n.jsx)("img",{alt:"Adaptive Computer",height:t,src:"/assets/logo.webp",style:{position:"absolute",top:0,right:0,maskImage:"url(/assets/logo-mask.svg)",transition:"opacity 0.3s ease-in-out",opacity:.8*!!s,animation:"rainbow-growing ease-in-out 5s infinite",maskSize:"cover"},width:t})]})}},40673:(e,t,s)=>{s.d(t,{G6:()=>h,Ns:()=>u,Oy:()=>c,hS:()=>o,l:()=>d,td:()=>i,xf:()=>m});var n=s(82997);s(60129);var r=s(50192),l=s(64388),a=s(1602);function i(e,t){return e?1===t?e:e.endsWith("s")?e+"es":e+"s":""}function o(e){return[0,4,5,6,7,8,9].includes(e%10)?"".concat(e,"th"):e%10==1?"".concat(e,"st"):e%10==2?"".concat(e,"nd"):e%10==3?"".concat(e,"rd"):void 0}function c(e){let t=e.split("\n"),s=(0,n.A)(t);s&&(s.startsWith(a.jW.slice(0,5))||s.startsWith(a.Gu.slice(0,5)))&&t.pop();let r=t.filter(e=>e===a.jW||e===a.Gu).length,i=t.filter(e=>e===a.xN||e===a.GI).length;if(r>i){let e=Math.max(t.lastIndexOf(a.jW),t.lastIndexOf(a.Gu));e>=0&&t.splice(e),t.push('<div className="markdown-change-chip">Specifying changes...</div>')}else if(r===i)return t.join("\n").replace(RegExp("(?:".concat(a.jW,"|").concat(a.Gu,")([\\s\\S]*?)(?:").concat(a.xN,"|").concat(a.GI,")"),"gs"),e=>{let t=l.Qd.filter(t=>e.includes(t));return'<div className="markdown-change-chip-finished">Code changes specified to '.concat(t.join(", "),"</div>")});return t.join("\n").replace(RegExp("(?:".concat(a.jW,"|").concat(a.Gu,")([\\s\\S]*?)(?:").concat(a.xN,"|").concat(a.GI,")"),"gs"),e=>{let t=l.Qd.filter(t=>e.includes(t));return'<div className="markdown-change-chip">Specifying changes to '.concat(t.join(", "),"</div>")})}function d(e){let t=e.split("\n```").length-1;return e.startsWith("```")&&t++,t%2==1?e+"\n```":e}function u(e){return e.split(RegExp("[^\\p{L}]","u")).map(e=>e.trim().charAt(0).toUpperCase()+e.trim().slice(1)).filter(Boolean).join(" ")}function m(e){return r.z.string().email().safeParse(e).success}function h(e){return/\[([^\]]+)\]\(([^\)]+)\)/g.test(e)?e:e.replace(/(\b(?:https?:\/\/|www\.)[^\s<>'"()]+(?:\([^\s<>'"()]*\))?)/gi,e=>{let t=e.replace(/^['"]|['"]$/g,"");return"[".concat(t,"](").concat(t,")")})}},72641:(e,t,s)=>{s.d(t,{I:()=>n});function n(e,t){try{let s=window.URL.createObjectURL(new Blob([JSON.stringify(e)])),n=document.createElement("a");n.href=s,n.setAttribute("download",t),document.body.appendChild(n),n.click(),n.remove()}catch(e){console.error("[downloadTextAsFile] Failed to download: ",e)}}},87826:(e,t,s)=>{s.d(t,{J:()=>k});var n=s(31218),r=s(35712),l=s(66655),a=s(58807),i=s(91632),o=s(95717),c=s(23782),d=s(88218),u=s(59133),m=s(6300),h=s(50192),x=s(28235),f=s(87998),p=s(75569),j=s(40673);function g(e){let{field:t,value:s,onChange:r}=e;if(t.primaryKey)return(0,n.jsx)(x.pd,{disabled:!0,required:t.rules.required,type:"text",value:s});switch(t.type){case"INTEGER":case"REAL":return(0,n.jsx)(x.pd,{disabled:t.rules.disabled,placeholder:t.label+"...",required:t.rules.required,type:"number",value:s,onChange:r});case"TEXT":return(0,n.jsx)(x.TM,{disabled:t.rules.disabled,placeholder:t.label+"...",required:t.rules.required,value:s,onChange:r});case"DATETIME":return(0,n.jsx)(x.pd,{disabled:t.rules.disabled,placeholder:t.label+"...",required:t.rules.required,type:"datetime-local",value:s?(0,p.Yq)(new Date(s),(0,p.C7)(),"yyyy-MM-dd'T'HH:mm"):"",onChange:r});case"BOOLEAN":return(0,n.jsx)("div",{children:(0,n.jsx)(x.dO,{checked:s,onCheckedChange:r})});case"BLOB":return(0,n.jsx)(x.pd,{disabled:t.rules.disabled,placeholder:t.label+"...",required:t.rules.required,type:"file",value:s,onChange:r});default:return null}}function v(e){let{fields:t,onEditSuccess:s,row:r,versionId:l,tableName:a}=e,i=(0,u.mN)(),{toast:o}=(0,x.dj)(),c=f.F.updateRecord.useMutation({onSuccess:()=>{s()},onError:e=>{o({title:"Could not update the record",description:e.message})}}),d=e=>{let s=t.find(e=>e.primaryKey);if(!s)return;let n=e[s.label];delete e[s.label],c.mutate({versionId:l,tableName:a,primaryKey:n,record:e})};return(0,n.jsx)(x.lV,{...i,children:(0,n.jsxs)("form",{className:"flex flex-col gap-4",onSubmit:i.handleSubmit(e=>d(e)),children:[t.map((e,t)=>(0,n.jsx)(x.zB,{control:i.control,defaultValue:r[t],name:e.label,render:t=>{let{field:s}=t;return(0,n.jsxs)(x.eI,{children:[(0,n.jsx)(x.lR,{children:(0,j.Ns)(e.label)}),(0,n.jsx)(g,{field:e,value:s.value,onChange:s.onChange})]})}},e.label)),(0,n.jsx)(x.$n,{className:"self-end",type:"submit",variant:"primary",children:"Update"})]})})}function y(e){let{tables:t,onTableSelect:s,activeTable:r}=e;return(0,n.jsxs)("div",{className:"flex flex-col border-r min-w-40 p-4 gap-2",children:[(0,n.jsxs)(x.$n,{className:"flex flex-row justify-start items-center",size:"sm",variant:""===r?"secondary":"ghost",onClick:()=>s(""),children:[(0,n.jsx)(a.A,{className:"h-4 w-4 mr-2 text-muted-foreground"})," Ask"]}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:t.map(e=>(0,n.jsxs)(x.$n,{className:"flex flex-row justify-start items-center gap-2",size:"sm",variant:r===e.tableName?"secondary":"ghost",onClick:()=>s(e.tableName),children:[(0,n.jsx)(i.A,{className:"h-4 w-4 text-muted-foreground"}),(0,j.td)(e.tableName,2),(0,n.jsx)("div",{className:"flex-1"}),(0,n.jsx)(x.Ex,{className:"py-0 px-1",children:e.recordCount})]},e.tableName))})]})}function b(e){let{fields:t,result:s,versionId:r,tableName:l,initialEditOpen:a,onEditSheetOpenChange:i}=e,u=f.F.deleteRecord.useMutation({onSuccess:()=>{m({title:"Successfully deleted the record"}),h.getRecords.invalidate()},onError:e=>{m({title:"Could not delete the record",description:e.message})}}),{toast:m}=(0,x.dj)(),h=f.F.useUtils(),[p,g]=(0,d.useState)([]),y=e=>{u.mutate({versionId:r,tableName:l,key:e})};if((0,d.useEffect)(()=>{a&&(null==s?void 0:s.rows.length)&&(g([!0]),null==i||i(!0))},[a,null==s?void 0:s.rows.length,i]),!s)return null;if(!s)return(0,n.jsxs)("div",{className:"flex flex-col h-80 items-center justify-center text-center p-4 gap-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"No search results"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"It looks like there is no data to display for your query."})]});let b=s.columnTypes;return(0,n.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(auto-fit, minmax(min(100%, 275px), 1fr))"},children:null==s?void 0:s.rows.map((e,a)=>{var i,d;return(0,n.jsx)(x.Zp,{className:"flex flex-col",children:(0,n.jsxs)(x.Wu,{className:"flex flex-col gap-4 p-4 flex-grow",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center gap-2 mb-2",children:[(0,n.jsx)(x.Ex,{className:"truncate max-w-[70%] text-sm",variant:"secondary",children:null!==(d=null===(i=e[0])||void 0===i?void 0:i.toString())&&void 0!==d?d:"-"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)(x.cj,{open:p[a],onOpenChange:()=>{g(e=>{let t=[...e];return t[a]=!t[a],t})},children:[(0,n.jsx)(x.CG,{asChild:!0,children:(0,n.jsx)(x.$n,{size:"sm",variant:"ghost",children:(0,n.jsx)(o.A,{className:"h-4 w-4"})})}),(0,n.jsx)(x.h,{className:"flex flex-col overflow-auto gap-4",children:(0,n.jsx)(v,{fields:t,row:e,tableName:l,versionId:r,onEditSuccess:()=>{g(e=>{let t=[...e];return t[a]=!1,t}),m({title:"Successfully updated the record"}),h.getRecords.invalidate()}})})]},a),(0,n.jsx)(x.$n,{size:"sm",variant:"destructive",onClick:()=>{window.confirm("Are you sure you want to delete this record?")&&y(e[0])},children:(0,n.jsx)(c.A,{className:"h-4 w-4"})})]})]}),s.columns.slice(1).map((t,s)=>(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:(0,j.Ns)(t)}),(0,n.jsx)("p",{className:"text-sm break-words",children:e[s+1]&&(null==b?void 0:b[s+1])=="DATETIME"?new Date(e[s+1]).toLocaleString():e[s+1]?e[s+1]:"-"})]},t))]})},a)})})}let N=h.z.object({searchInput:h.z.string()});function w(e){let{result:t}=e;return t?(0,n.jsxs)(x.XI,{children:[(0,n.jsx)(x.A0,{children:(0,n.jsx)(x.Hj,{children:t.columns.map((e,s)=>(0,n.jsxs)(x.nd,{children:[e," (",t.columnTypes[s],")"]},e))})}),(0,n.jsx)(x.BF,{children:t.rows.map((e,s)=>(0,n.jsx)(x.Hj,{children:t.columns.map((t,s)=>(0,n.jsx)(x.nA,{children:e[s]},t))},s))})]}):(0,n.jsxs)("div",{className:"flex flex-col h-80 items-center justify-center text-center p-4 gap-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"No results"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"It looks like there is no data to display for your query."})]})}function C(e){var t;let{versionId:s}=e,[l,a]=(0,d.useState)(void 0),{toast:i}=(0,x.dj)(),{data:o,error:c}=f.F.getRecords.useQuery({versionId:s,searchTerm:l},{enabled:!!l,onError:e=>{i({title:"Could not fetch data",description:e.message})}}),m=(0,u.mN)({resolver:(0,r.u)(N),defaultValues:{searchInput:""}});return(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)(x.lV,{...m,children:(0,n.jsxs)("form",{className:"flex items-center gap-4",onSubmit:m.handleSubmit(e=>{e.searchInput&&e.searchInput.length>0&&a(e.searchInput)}),children:[(0,n.jsx)(x.zB,{control:m.control,name:"searchInput",render:e=>{let{field:t}=e;return(0,n.jsx)(x.pd,{...t,autoFocus:!0,placeholder:"Blog posts published last week..."})}}),(0,n.jsx)(x.$n,{className:"",type:"submit",variant:"secondary",children:"Ask"})]})}),l&&!c&&(0,n.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Resolved query: ",null!==(t=null==o?void 0:o.generatedQuery)&&void 0!==t?t:"Thinking..."]}),o&&(0,n.jsx)(w,{result:o})]})}let S=h.z.object({idFilter:h.z.string().optional()});function k(e){var t;let{versionId:s,editingItem:a}=e,[i,o]=(0,d.useState)(""),[c,h]=(0,d.useState)([]),[p,j]=(0,d.useState)(void 0),[g,v]=(0,d.useState)(!1),N=(0,u.mN)({resolver:(0,r.u)(S),defaultValues:{idFilter:""}}),{data:w,isLoading:k}=f.F.getDbOverview.useQuery({versionId:s},{staleTime:6e5,retry:!1}),{data:A,fetchNextPage:I,isLoading:E,hasNextPage:z}=f.F.getRecords.useInfiniteQuery({versionId:s,tableName:i,id:p},{enabled:!!i,getNextPageParam:e=>e.nextCursor,retry:!1});f.F.getTableSchema.useQuery({versionId:s,tableName:i},{enabled:!!i,staleTime:6e5,retry:!1,onSuccess:e=>{h(e.rows.map(e=>({label:e[1],type:e[2],primaryKey:1===e[5],rules:{disabled:1===e[5],required:1===e[3]}})))}});let{isIntersecting:F,ref:T}=(0,m.BL)({threshold:.1});return((0,d.useEffect)(()=>{F&&!E&&z&&I()},[I,z,F,E]),(0,d.useEffect)(()=>{a&&(o(a.tableName),j(a.id),v(!0))},[a]),k)?null:w&&0!==w.length?(0,n.jsxs)("div",{className:"flex h-[calc(100%-4rem)] w-full",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(y,{activeTable:i,tables:w,onTableSelect:e=>{o(e)}})}),(0,n.jsx)("div",{className:"flex-grow overflow-auto",children:(0,n.jsx)("div",{className:"p-4 w-full h-full",children:i?(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)(x.lV,{...N,children:(0,n.jsxs)("form",{className:"flex items-center gap-4",onSubmit:N.handleSubmit(e=>{j(e.idFilter)}),children:[(0,n.jsx)(x.zB,{control:N.control,name:"idFilter",render:e=>{let{field:t}=e;return(0,n.jsx)(x.pd,{...t,placeholder:"Search by id..."})}}),(0,n.jsx)(x.$n,{className:"",type:"submit",variant:"secondary",children:"Search"})]})}),(0,n.jsx)(b,{fields:c,initialEditOpen:g,result:{...(0,l.A)(null==A?void 0:A.pages),rows:null!==(t=null==A?void 0:A.pages.flatMap(e=>e.rows))&&void 0!==t?t:[]},tableName:i,versionId:s,onEditSheetOpenChange:v}),(0,n.jsx)("div",{className:"flex justify-center items-center",ref:T,children:E&&(0,n.jsx)("div",{className:"flex justify-center items-center",children:(0,n.jsx)("p",{className:"text-muted-foreground",children:"Loading more..."})})})]}):(0,n.jsx)(C,{versionId:s})})})]}):(0,n.jsxs)("div",{className:"flex flex-col h-80 items-center justify-center text-center p-4 gap-4",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:"No data available"}),(0,n.jsx)("p",{className:"text-muted-foreground",children:"It looks like there is no data to display at the moment."})]})}}}]);